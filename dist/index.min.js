!function(){"use strict";var e,t={exports:{}};self,e=()=>(()=>{var e={566:function(e,t){!function(e){function t(e){return!Number.isNaN(e)&&"number"==typeof e}function r(e){return t(e)&&Number.isFinite(e)}function n(e){return r(e)&&e%1==0}function o(e){return t(e)&&e>0}function i(e){return n(e)&&e>0}function a(e){return t(e)&&e<0}function c(e){return n(e)&&e<0}function s(e){return t(e)&&e>=0}function u(e){return n(e)&&e>=0}function l(e){return t(e)&&e<=0}function p(e){return n(e)&&e<=0}function _(e,r,n){return t(e)&&e>=r&&e<=n}function f(e,t,r){return n(e)&&e>=t&&e<=r}function d(e){return"string"==typeof e}function m(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function v(e){return Array.isArray(e)||m(e)}function h(e){return!("object"!=typeof e||v(e)||null===e||e instanceof ArrayBuffer||e instanceof DataView)}function g(e){return"boolean"==typeof e}e.isArray=v,e.isBoolean=g,e.isFiniteNumber=r,e.isInteger=n,e.isIntegerInRange=f,e.isNegativeInteger=c,e.isNegativeNumber=a,e.isNonNegativeInteger=u,e.isNonNegativeNumber=s,e.isNonPositiveInteger=p,e.isNonPositiveNumber=l,e.isNumber=t,e.isNumberInRange=_,e.isObject=h,e.isPositiveInteger=i,e.isPositiveNumber=o,e.isString=d,e.isTypedArray=m,Object.defineProperty(e,"__esModule",{value:!0})}(t)},809:(e,t)=>{function r(e){var t=-1;n||(n=function(){for(var e=new Int32Array(256),t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return e}());for(var r=0;r<e.length;r++)t=n[255&(t^e[r])]^t>>>8;return-1^t}Object.defineProperty(t,"__esModule",{value:!0}),t.changeDpiBlob=function(e,t){var r=e.slice(0,33);return new Promise((function(n,o){var i=new FileReader;i.onload=function(){var r=new Uint8Array(i.result),o=e.slice(33),a=f(r,t,e.type);n(new Blob([a,o],{type:e.type}))},i.readAsArrayBuffer(r)}))},t.changeDpiDataUrl=function(e,t){var r,n,u=e.split(","),l=u[0],p=u[1],_=void 0,d=void 0,m=!1;if(-1!==l.indexOf(o)){_=o;var v=(-1===(n=(r=p).indexOf(a))&&(n=r.indexOf(c)),-1===n&&(n=r.indexOf(s)),n);v>=0?(d=4*Math.ceil((v+28)/3),m=!0):d=44}-1!==l.indexOf(i)&&(_=i,d=24);for(var h=p.substring(0,d),g=p.substring(d),y=atob(h),T=new Uint8Array(y.length),E=0;E<T.length;E++)T[E]=y.charCodeAt(E);var A=f(T,t,_,m),O=btoa(String.fromCharCode.apply(String,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(A)));return[l,",",O,g].join("")};var n=void 0,o="image/png",i="image/jpeg",a="AAlwSFlz",c="AAAJcEhZ",s="AAAACXBI",u="p".charCodeAt(0),l="H".charCodeAt(0),p="Y".charCodeAt(0),_="s".charCodeAt(0);function f(e,t,n,a){if(n===i)return e[13]=1,e[14]=t>>8,e[15]=255&t,e[16]=t>>8,e[17]=255&t,e;if(n===o){var c=new Uint8Array(13);t*=39.3701,c[0]=u,c[1]=l,c[2]=p,c[3]=_,c[4]=t>>>24,c[5]=t>>>16,c[6]=t>>>8,c[7]=255&t,c[8]=c[4],c[9]=c[5],c[10]=c[6],c[11]=c[7],c[12]=1;var s=r(c),f=new Uint8Array(4);if(f[0]=s>>>24,f[1]=s>>>16,f[2]=s>>>8,f[3]=255&s,a){var d=function(e){for(var t=e.length-1;t>=4;t--)if(9===e[t-4]&&e[t-3]===u&&e[t-2]===l&&e[t-1]===p&&e[t]===_)return t-3}(e);return e.set(c,d),e.set(f,d+13),e}var m=new Uint8Array(4);m[0]=0,m[1]=0,m[2]=0,m[3]=9;var v=new Uint8Array(54);return v.set(e,0),v.set(m,33),v.set(c,37),v.set(f,50),v}}},162:function(e,t,r){var n,o,i;o=[],n=function(){function t(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function n(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){s(n.response,t,r)},n.onerror=function(){console.error("could not download file")},n.send()}function o(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function i(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(r){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof r.g&&r.g.global===r.g?r.g:void 0,c=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=a.saveAs||("object"!=typeof window||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!c?function(e,t,r){var c=a.URL||a.webkitURL,s=document.createElement("a");t=t||e.name||"download",s.download=t,s.rel="noopener","string"==typeof e?(s.href=e,s.origin===location.origin?i(s):o(s.href)?n(e,t,r):i(s,s.target="_blank")):(s.href=c.createObjectURL(e),setTimeout((function(){c.revokeObjectURL(s.href)}),4e4),setTimeout((function(){i(s)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,r,a){if(r=r||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,a),r);else if(o(e))n(e,r,a);else{var c=document.createElement("a");c.href=e,c.target="_blank",setTimeout((function(){i(c)}))}}:function(e,t,r,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof e)return n(e,t,r);var i="application/octet-stream"===e.type,s=/constructor/i.test(a.HTMLElement)||a.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||i&&s||c)&&"undefined"!=typeof FileReader){var l=new FileReader;l.onloadend=function(){var e=l.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},l.readAsDataURL(e)}else{var p=a.URL||a.webkitURL,_=p.createObjectURL(e);o?o.location=_:location.href=_,o=null,setTimeout((function(){p.revokeObjectURL(_)}),4e4)}});a.saveAs=s.saveAs=s,e.exports=s},void 0===(i="function"==typeof n?n.apply(t,o):n)||(e.exports=i)},484:function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.GPUComposer=void 0;var i=r(809),a=r(566),c=r(355);r(191);var s=r(601),u=r(404),l=r(593),p=r(651),_=r(567),f=r(946),d=r(929),m=r(634),v=r(380),h=r(690),g=r(579),y=r(707),T=r(798),E=r(581),A=function(){function e(e){var t;this._errorState=!1,this._circlePositionsBuffer={},this._vertexAttributeLocations={},this._enabledVertexAttributes={},this._extensions={},this._copyPrograms={},this._setValuePrograms={},this._vertexShaders=((t={})[s.DEFAULT_PROGRAM_NAME]={src:p.DEFAULT_VERT_SHADER_SOURCE,compiledShaders:{}},t[s.SEGMENT_PROGRAM_NAME]={src:f.SEGMENT_VERTEX_SHADER_SOURCE,compiledShaders:{}},t[s.LAYER_POINTS_PROGRAM_NAME]={src:d.LAYER_POINTS_VERTEX_SHADER_SOURCE,compiledShaders:{}},t[s.LAYER_VECTOR_FIELD_PROGRAM_NAME]={src:m.LAYER_VECTOR_FIELD_VERTEX_SHADER_SOURCE,compiledShaders:{}},t[s.LAYER_LINES_PROGRAM_NAME]={src:_.LAYER_LINES_VERTEX_SHADER_SOURCE,compiledShaders:{}},t[s.LAYER_MESH_PROGRAM_NAME]={src:v.LAYER_MESH_VERTEX_SHADER_SOURCE,compiledShaders:{}},t),this.verboseLogging=!1,this._numTicks=0;var r=Object.keys(e);(0,y.checkValidKeys)(r,["canvas","context","contextID","contextAttributes","glslVersion","intPrecision","floatPrecision","verboseLogging","errorCallback"],"GPUComposer(params)"),(0,y.checkRequiredKeys)(r,["canvas"],"GPUComposer(params)"),void 0!==e.verboseLogging&&(this.verboseLogging=e.verboseLogging);var n=this;this._errorCallback=function(t){n._errorState||(n._errorState=!0,e.errorCallback?e.errorCallback(t):(0,s.DEFAULT_ERROR_CALLBACK)(t))};var o,i=e.canvas,a=e.context;if(a||(e.contextID&&((o=i.getContext(e.contextID,e.contextAttributes))?a=o:console.warn("Unable to initialize WebGL context with contextID: ".concat(e.contextID,"."))),a||(o=i.getContext(s.WEBGL2,e.contextAttributes)||i.getContext(s.WEBGL1,e.contextAttributes)||i.getContext(s.EXPERIMENTAL_WEBGL2,e.contextAttributes)||i.getContext(s.EXPERIMENTAL_WEBGL,e.contextAttributes))&&(a=o),a)){this.isWebGL2=(0,l.isWebGL2)(a),this.isWebGL2?this.verboseLogging&&console.log("Using WebGL 2.0 context."):this.verboseLogging&&console.log("Using WebGL 1.0 context."),this.gl=a;var c=e.glslVersion||(this.isWebGL2?s.GLSL3:s.GLSL1);this.isWebGL2||c!==s.GLSL3||(console.warn("GLSL3.x is incompatible with WebGL1.0 contexts, falling back to GLSL1."),c=s.GLSL1),this.glslVersion=c,this.intPrecision=e.intPrecision||s.PRECISION_HIGH_P,this.floatPrecision=e.floatPrecision||s.PRECISION_HIGH_P,a.disable(a.DEPTH_TEST),a.pixelStorei(a.UNPACK_ALIGNMENT,1),this.isWebGL2?a.bindVertexArray(null):(0,E.getExtension)(this,E.OES_VERTEX_ARRAY_OBJECT,!0).bindVertexArrayOES(null),a.bindBuffer(a.ARRAY_BUFFER,null),this.resize([i.clientWidth,i.clientHeight]),this.verboseLogging&&console.log("".concat(this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)," textures max."))}else this._errorCallback("Unable to initialize WebGL context.")}return e.initWithThreeRenderer=function(t,r){var o=new e(n(n({floatPrecision:t.capabilities.precision,intPrecision:t.capabilities.precision},r),{canvas:t.domElement,context:t.getContext()}));return o._threeRenderer=t,o},Object.defineProperty(e.prototype,"canvas",{get:function(){return this.gl.canvas},enumerable:!1,configurable:!0}),e.prototype._setValueProgramForType=function(e){var t=this._setValuePrograms,r=(0,h.uniformTypeForType)(e,this.glslVersion);return void 0===t[r]&&(t[r]=(0,g.setValueProgram)(this,{type:e,value:[0,0,0,0]})),t[r]},e.prototype._copyProgramForType=function(e){var t=this._copyPrograms,r=(0,h.uniformTypeForType)(e,this.glslVersion);return void 0===t[r]&&(t[r]=(0,g.copyProgram)(this,{type:e})),t[r]},e.prototype._initVertexBuffer=function(e){var t=this,r=t._errorCallback,n=t.gl;t.isWebGL2?n.bindVertexArray(null):(0,E.getExtension)(this,E.OES_VERTEX_ARRAY_OBJECT,!0).bindVertexArrayOES(null);var o=n.createBuffer();if(o)return n.bindBuffer(n.ARRAY_BUFFER,o),n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW),o;r("Unable to allocate gl buffer.")},e.prototype._getQuadPositionsBuffer=function(){if(void 0===this._quadPositionsBuffer){var e=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this._quadPositionsBuffer=this._initVertexBuffer(e)}return this._quadPositionsBuffer},e.prototype._getBoundaryPositionsBuffer=function(){if(void 0===this._boundaryPositionsBuffer){var e=new Float32Array([-1,-1,1,-1,1,1,-1,1,-1,-1]);this._boundaryPositionsBuffer=this._initVertexBuffer(e)}return this._boundaryPositionsBuffer},e.prototype._getCirclePositionsBuffer=function(e){var t=this._circlePositionsBuffer;if(null==t[e]){for(var r=[0,0],n=0;n<e;n++)r.push(Math.cos(2*Math.PI*n/e),Math.sin(2*Math.PI*n/e));r.push(Math.cos(0),Math.sin(0));var o=new Float32Array(r),i=this._initVertexBuffer(o);t[e]=i}return t[e]},e.prototype._cloneGPULayer=function(e,t){for(var r=e.is1D()?e.length:[e.width,e.height],n=new c.GPULayer(this,{name:t||"".concat(e.name,"-clone"),dimensions:r,type:e.type,numComponents:e.numComponents,filter:e.filter,wrapX:e.wrapX,wrapY:e.wrapY,numBuffers:e.numBuffers,clearValue:e.clearValue}),o=this._copyProgramForType(e.type),i=0;i<e.numBuffers-1;i++)n.incrementBufferIndex();for(i=0;i<e.numBuffers;i++)this.step({program:o,input:e.getStateAtIndex(i),output:n});for(i=-1;i<e.bufferIndex;i++)n.incrementBufferIndex();return n},e.prototype._getVertexShader=function(e,t,r,n){var o=this,i=o._errorCallback,a=o._vertexShaders,c=o.gl,s=o.glslVersion,u=o.intPrecision,p=o.floatPrecision,_=a[e],f=_.compiledShaders,d=_.src;if(""===t&&(t="_default"),void 0===f[t]){if(""===d)throw new Error('Error compiling GPUProgram "'.concat(n,'": no source for vertex shader with name "').concat(e,'".'));var m=(0,l.preprocessVertexShader)(d,s),v=(0,l.compileShader)(c,s,u,p,m,c.VERTEX_SHADER,n,i,r,void 0,!0);if(!v)return void i('Unable to compile "'.concat(e).concat(t,'" vertex shader for GPUProgram "').concat(n,'".'));f[t]=v}return f[t]},e.prototype.resize=function(e){var t=this.canvas,r=e[0],n=e[1];t.width=r,t.height=n,this._width=r,this._height=n},e.prototype._drawSetup=function(e,t,r,n,o,i){var a=this.gl,s=[];if(o)if(o.layer)s.push(o);else if(o.constructor===c.GPULayer)s.push(o.currentState);else for(var u=0;u<o.length;u++){var l=o[u];s.push(l.currentState?l.currentState:l)}var p=e._getProgramWithName(t,r,s);for(this._setOutputLayer(e.name,n,o,i),a.useProgram(p),u=0;u<s.length;u++)a.activeTexture(a.TEXTURE0+u),a.bindTexture(a.TEXTURE_2D,s[u].texture);return e._setInternalFragmentUniforms(p,s),p},e.prototype._setBlendMode=function(e){var t=this.gl;e&&(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA))},e.prototype._addLayerToInputs=function(e,t){return void 0===t?[e]:(0,a.isArray)(t)?(0,l.indexOfLayerInArray)(e,t)>=0?t:o(o([],t,!0),[e],!1):t===e||t.layer===e?[t]:[t,e]},e.prototype._passThroughLayerDataFromInputToOutput=function(e){var t=this._copyProgramForType(e._internalType);this.step({program:t,input:e,output:e})},e.prototype._setOutputLayer=function(e,t,r,n){var o=this.gl,i=this.isWebGL2;if(n){for(var c=(0,a.isArray)(n)?n:[n],s=0,u=c.length;s<u;s++){var p=c[s];if(r&&(r===n||r.layer===n||(0,a.isArray)(r)&&(0,l.indexOfLayerInArray)(p,r)>=0)){if(1===p.numBuffers)throw new Error("Cannot use same buffer for input and output of a program. Try increasing the number of buffers in your output layer to at least 2 so you can render to nextState using currentState as an input.");t?p._prepareForWrite(!0):(this._passThroughLayerDataFromInputToOutput(p),p._prepareForWrite(!1))}else t?p._prepareForWrite(!0):(p._usingTextureOverrideForCurrentBuffer()&&this._passThroughLayerDataFromInputToOutput(p),p._prepareForWrite(!1))}var _=c[0],f=void 0,d=[o.COLOR_ATTACHMENT0];if(c.length>1)for(f=[],s=1,u=c.length;s<u;s++)f.push(c[s]._currentTexture),d.push(o.COLOR_ATTACHMENT0+s);(0,T.bindFrameBuffer)(this,_,_._currentTexture,f),i&&o.drawBuffers(d);var m=this._widthHeightForOutput(e,n),v=m.width,h=m.height;o.viewport(0,0,v,h)}else{o.bindFramebuffer(o.FRAMEBUFFER,null);var g=this._width,y=this._height;o.viewport(0,0,g,y)}},e.prototype._setVertexAttribute=function(e,t,r,n){var o,i=this,a=i.gl,c=i._vertexAttributeLocations,s=i._enabledVertexAttributes,u=c[t];if(u||(u=new WeakMap,c[t]=u),void 0===o){if((o=a.getAttribLocation(e,t))<0)throw new Error('Unable to find vertex attribute "'.concat(t,'" in program "').concat(n,'".'));u.set(e,o)}a.vertexAttribPointer(o,r,a.FLOAT,!1,0,0),a.enableVertexAttribArray(o),s[o]=!0},e.prototype._disableVertexAttributes=function(){for(var e=this._enabledVertexAttributes,t=this.gl,r=Object.keys(e),n=0,o=r.length;n<o;n++){var i=r[n];e[i]&&(t.disableVertexAttribArray(i),delete e[i])}},e.prototype._setPositionAttribute=function(e,t){this._setVertexAttribute(e,"a_gpuio_position",2,t)},e.prototype._setIndexAttribute=function(e,t){this._setVertexAttribute(e,"a_gpuio_index",1,t)},e.prototype._setUVAttribute=function(e,t){this._setVertexAttribute(e,"a_gpuio_uv",2,t)},e.prototype._widthHeightForOutput=function(e,t){if((0,a.isArray)(t)){for(var r=t[0],n=r?r.width:this._width,o=r?r.height:this._height,i=1,c=t.length;i<c;i++){var s=t[i];if(s.width!==n||s.height!==o)throw new Error("Output GPULayers must have the same dimensions, got dimensions [".concat(n,", ").concat(o,"] and [").concat(s.width,", ").concat(s.height,'] for program "').concat(e,'".'))}return{width:n,height:o}}return{width:t?t.width:this._width,height:t?t.height:this._height}},e.prototype._iterateOverOutputsIfNeeded=function(e,t){if(e.output&&(0,a.isArray)(e.output)&&this.glslVersion===s.GLSL1){for(var r=0,o=e.output.length;r<o;r++)this[t](n(n({},e),{program:0===r?e.program:e.program._childPrograms[r-1],output:e.output[r]}));return!0}return!1},e.prototype._drawFinish=function(e){var t=this.gl;e.blendAlpha&&t.disable(t.BLEND)},e.prototype.step=function(e){var t=Object.keys(e);if((0,y.checkValidKeys)(t,["program","input","output","blendAlpha"],"GPUComposer.step(params)"),(0,y.checkRequiredKeys)(t,["program"],"GPUComposer.step(params)"),!this._iterateOverOutputsIfNeeded(e,"step")){var r=this.gl,n=this._errorState,o=e.program,i=e.input,a=e.output;if(!n){var c=this._drawSetup(o,s.DEFAULT_PROGRAM_NAME,{},!0,i,a);o._setVertexUniform(c,"u_gpuio_scale",[1,1],s.FLOAT),o._setVertexUniform(c,"u_gpuio_translation",[0,0],s.FLOAT),r.bindBuffer(r.ARRAY_BUFFER,this._getQuadPositionsBuffer()),this._setPositionAttribute(c,o.name),this._setBlendMode(e.blendAlpha),r.drawArrays(r.TRIANGLE_STRIP,0,4),this._drawFinish(e)}}},e.prototype.stepBoundary=function(e){var t=Object.keys(e);if((0,y.checkValidKeys)(t,["program","input","output","edges","blendAlpha"],"GPUComposer.stepBoundary(params)"),(0,y.checkRequiredKeys)(t,["program"],"GPUComposer.stepBoundary(params)"),!this._iterateOverOutputsIfNeeded(e,"stepBoundary")){var r=this.gl,n=this._errorState,o=e.program,i=e.input,c=e.output;if(!n){var u=this._widthHeightForOutput(o.name,c),l=u.width,p=u.height,_=this._drawSetup(o,s.DEFAULT_PROGRAM_NAME,{},!1,i,c),f=[1/l,1/p];if(o._setVertexUniform(_,"u_gpuio_scale",[1-f[0],1-f[1]],s.FLOAT),o._setVertexUniform(_,"u_gpuio_translation",f,s.FLOAT),r.bindBuffer(r.ARRAY_BUFFER,this._getBoundaryPositionsBuffer()),this._setPositionAttribute(_,o.name),this._setBlendMode(e.blendAlpha),e.edges){var d=e.edges;(0,a.isArray)(d)||(d=[d]);for(var m=0,v=d.length;m<v;m++){var h=d[m];h===s.BOUNDARY_LEFT&&r.drawArrays(r.LINES,3,2),h===s.BOUNDARY_RIGHT&&r.drawArrays(r.LINES,1,2),h===s.BOUNDARY_TOP&&r.drawArrays(r.LINES,2,2),h===s.BOUNDARY_BOTTOM&&r.drawArrays(r.LINES,0,2)}}else r.drawArrays(r.LINE_LOOP,0,4);this._drawFinish(e)}}},e.prototype.stepNonBoundary=function(e){var t=Object.keys(e);if((0,y.checkValidKeys)(t,["program","input","output","blendAlpha"],"GPUComposer.stepNonBoundary(params)"),(0,y.checkRequiredKeys)(t,["program"],"GPUComposer.stepNonBoundary(params)"),!this._iterateOverOutputsIfNeeded(e,"stepNonBoundary")){var r=this.gl,n=this._errorState,o=e.program,i=e.input,a=e.output;if(!n){var c=this._widthHeightForOutput(o.name,a),u=c.width,l=c.height,p=this._drawSetup(o,s.DEFAULT_PROGRAM_NAME,{},!1,i,a),_=[1/u,1/l];o._setVertexUniform(p,"u_gpuio_scale",[1-2*_[0],1-2*_[1]],s.FLOAT),o._setVertexUniform(p,"u_gpuio_translation",_,s.FLOAT),r.bindBuffer(r.ARRAY_BUFFER,this._getQuadPositionsBuffer()),this._setPositionAttribute(p,o.name),this._setBlendMode(e.blendAlpha),r.drawArrays(r.TRIANGLE_STRIP,0,4),this._drawFinish(e)}}},e.prototype.stepCircle=function(e){var t,r=Object.keys(e);if((0,y.checkValidKeys)(r,["program","position","diameter","useOutputScale","input","output","numSegments","blendAlpha"],"GPUComposer.stepCircle(params)"),(0,y.checkRequiredKeys)(r,["program","position","diameter"],"GPUComposer.stepCircle(params)"),!this._iterateOverOutputsIfNeeded(e,"stepCircle")){var n=this.gl,o=this._errorState,i=e.program,a=e.position,c=e.diameter,u=e.input,l=e.output;if(!o){var p=this._width,_=this._height;e.useOutputScale&&(p=(t=this._widthHeightForOutput(i.name,l)).width,_=t.height);var f=this._drawSetup(i,s.DEFAULT_PROGRAM_NAME,{},!1,u,l);i._setVertexUniform(f,"u_gpuio_scale",[c/p,c/_],s.FLOAT),i._setVertexUniform(f,"u_gpuio_translation",[2*a[0]/p-1,2*a[1]/_-1],s.FLOAT);var d=e.numSegments?e.numSegments:s.DEFAULT_CIRCLE_NUM_SEGMENTS;if(d<3)throw new Error("numSegments for GPUComposer.stepCircle must be greater than 2, got ".concat(d,"."));n.bindBuffer(n.ARRAY_BUFFER,this._getCirclePositionsBuffer(d)),this._setPositionAttribute(f,i.name),this._setBlendMode(e.blendAlpha),n.drawArrays(n.TRIANGLE_FAN,0,d+2),this._drawFinish(e)}}},e.prototype.stepSegment=function(e){var t,r=Object.keys(e);if((0,y.checkValidKeys)(r,["program","position1","position2","thickness","useOutputScale","input","output","endCaps","numCapSegments","blendAlpha"],"GPUComposer.stepSegment(params)"),(0,y.checkRequiredKeys)(r,["program","position1","position2","thickness"],"GPUComposer.stepSegment(params)"),!this._iterateOverOutputsIfNeeded(e,"stepSegment")){var n=this.gl,o=this._errorState,i=e.program,a=e.position1,c=e.position2,u=e.thickness,l=e.input,p=e.output;if(!o){var _=this._width,f=this._height;e.useOutputScale&&(_=(t=this._widthHeightForOutput(i.name,p)).width,f=t.height);var d=this._drawSetup(i,s.SEGMENT_PROGRAM_NAME,{},!1,l,p);i._setVertexUniform(d,"u_gpuio_halfThickness",u/2,s.FLOAT),i._setVertexUniform(d,"u_gpuio_scale",[2/_,2/f],s.FLOAT);var m=a[0]-c[0],v=a[1]-c[1],h=Math.atan2(v,m);i._setVertexUniform(d,"u_gpuio_rotation",h,s.FLOAT);var g=(a[0]+c[0])/2,T=(a[1]+c[1])/2;i._setVertexUniform(d,"u_gpuio_translation",[2*g/_-1,2*T/f-1],s.FLOAT);var E=Math.sqrt(m*m+v*v),A=e.numCapSegments?2*e.numCapSegments:s.DEFAULT_CIRCLE_NUM_SEGMENTS;if(e.endCaps){if(A<6||A%6!=0)throw new Error("numCapSegments for GPUComposer.stepSegment must be divisible by 3, got ".concat(A/2,"."));i._setVertexUniform(d,"u_gpuio_length",E,s.FLOAT),n.bindBuffer(n.ARRAY_BUFFER,this._getCirclePositionsBuffer(A))}else i._setVertexUniform(d,"u_gpuio_length",E-u,s.FLOAT),n.bindBuffer(n.ARRAY_BUFFER,this._getQuadPositionsBuffer());this._setPositionAttribute(d,i.name),this._setBlendMode(e.blendAlpha),e.endCaps?n.drawArrays(n.TRIANGLE_FAN,0,A+2):n.drawArrays(n.TRIANGLE_STRIP,0,4),this._drawFinish(e)}}},e.prototype.stepRect=function(e){var t=Object.keys(e);if((0,y.checkValidKeys)(t,["program","position","size","useOutputScale","input","output","blendAlpha"],"GPUComposer.stepRect(params)"),(0,y.checkRequiredKeys)(t,["program","position","size"],"GPUComposer.stepRect(params)"),!this._iterateOverOutputsIfNeeded(e,"stepRect")){var r=[e.position[0],e.position[1]+e.size[1]/2],n=[e.position[0]+e.size[0],r[1]];this.stepSegment({program:e.program,position1:r,position2:n,thickness:e.size[1],useOutputScale:e.useOutputScale,input:e.input,output:e.output,endCaps:!1,blendAlpha:e.blendAlpha})}},e.prototype.drawLayerAsPoints=function(e){var t,r=Object.keys(e);if((0,y.checkValidKeys)(r,["layer","program","input","output","pointSize","useOutputScale","count","color","wrapX","wrapY","blendAlpha"],"GPUComposer.drawLayerAsPoints(params)"),(0,y.checkRequiredKeys)(r,["layer"],"GPUComposer.drawLayerAsPoints(params)"),!this._iterateOverOutputsIfNeeded(e,"drawLayerAsPoints")){var n=this,i=n.gl,a=n._pointIndexArray,c=n.glslVersion,u=n._errorState,p=e.layer,_=e.output;if(!u){if(2!==p.numComponents&&4!==p.numComponents)throw new Error('GPUComposer.drawLayerAsPoints() must be passed a layer parameter with either 2 or 4 components, got layer "'.concat(p.name,'" with ').concat(p.numComponents," components."));var f=p.length,d=e.count||f;if(d>f)throw new Error("Invalid count ".concat(d," for layer parameter of length ").concat(f,"."));c===s.GLSL1&&d>s.MAX_FLOAT_INT&&console.warn("Points positions array length: ".concat(d," is longer than what is supported by GLSL1 : ").concat(s.MAX_FLOAT_INT,"."));var m=e.program;if(void 0===m){m=this._setValueProgramForType(s.FLOAT);var v=e.color||[1,0,0];if(3!==v.length)throw new Error("Color parameter must have length 3, got ".concat(JSON.stringify(v),"."));m.setUniform("u_value",o(o([],v,!0),[1],!1),s.FLOAT)}var h=this._addLayerToInputs(p,e.input),g={};4===p.numComponents&&(g[s.GPUIO_VS_POSITION_W_ACCUM]="1"),e.wrapX&&(g[s.GPUIO_VS_WRAP_X]="1"),e.wrapY&&(g[s.GPUIO_VS_WRAP_Y]="1");var T=this._drawSetup(m,s.LAYER_POINTS_PROGRAM_NAME,g,!1,h,_);m._setVertexUniform(T,"u_gpuio_positions",(0,l.indexOfLayerInArray)(p,h),s.INT);var E=this._width,A=this._height;e.useOutputScale&&(E=(t=this._widthHeightForOutput(m.name,_)).width,A=t.height),m._setVertexUniform(T,"u_gpuio_scale",[1/E,1/A],s.FLOAT);var O=e.pointSize||1;m._setVertexUniform(T,"u_gpuio_pointSize",O,s.FLOAT);var I=[p.width,p.height];if(m._setVertexUniform(T,"u_gpuio_positionsDimensions",I,s.FLOAT),c===s.GLSL1){if(void 0===this._pointIndexBuffer||a&&a.length<d){var P=(0,l.initSequentialFloatArray)(f);this._pointIndexArray=P,this._pointIndexBuffer=this._initVertexBuffer(P)}i.bindBuffer(i.ARRAY_BUFFER,this._pointIndexBuffer),this._setIndexAttribute(T,m.name)}this._setBlendMode(e.blendAlpha),i.drawArrays(i.POINTS,0,d),this._drawFinish(e)}}},e.prototype.drawLayerAsVectorField=function(e){var t=Object.keys(e);if((0,y.checkValidKeys)(t,["layer","program","input","output","vectorSpacing","vectorScale","color","blendAlpha"],"GPUComposer.drawLayerAsVectorField(params)"),(0,y.checkRequiredKeys)(t,["layer"],"GPUComposer.drawLayerAsVectorField(params)"),!this._iterateOverOutputsIfNeeded(e,"drawLayerAsVectorField")){var r=this,n=r.gl,i=r._vectorFieldIndexArray,a=r._width,c=r._height,u=r.glslVersion,p=r._errorState,_=e.layer,f=e.output;if(!p){if(2!==_.numComponents)throw new Error('GPUComposer.drawLayerAsVectorField() must be passed a fieldLayer with 2 components, got fieldLayer "'.concat(_.name,'" with ').concat(_.numComponents," components."));var d=e.program;if(void 0===d){d=this._setValueProgramForType(s.FLOAT);var m=e.color||[1,0,0];if(3!==m.length)throw new Error("color parameter must have length 3, got ".concat(JSON.stringify(m),"."));d.setUniform("u_value",o(o([],m,!0),[1],!1),s.FLOAT)}var v=this._addLayerToInputs(_,e.input),h=this._drawSetup(d,s.LAYER_VECTOR_FIELD_PROGRAM_NAME,{},!1,v,f);d._setVertexUniform(h,"u_gpuio_vectors",(0,l.indexOfLayerInArray)(_,v),s.INT);var g=e.vectorScale||1;d._setVertexUniform(h,"u_gpuio_scale",[g/a,g/c],s.FLOAT);var T=e.vectorSpacing||10,E=[Math.floor(a/T),Math.floor(c/T)];d._setVertexUniform(h,"u_gpuio_dimensions",E,s.FLOAT);var A=2*E[0]*E[1];if(u===s.GLSL1){if(void 0===this._vectorFieldIndexBuffer||i&&i.length<A){var O=(0,l.initSequentialFloatArray)(A);this._vectorFieldIndexArray=O,this._vectorFieldIndexBuffer=this._initVertexBuffer(O)}n.bindBuffer(n.ARRAY_BUFFER,this._vectorFieldIndexBuffer),this._setIndexAttribute(h,d.name)}this._setBlendMode(e.blendAlpha),n.drawArrays(n.LINES,0,A),this._drawFinish(e)}}},e.prototype.drawLayerAsMesh=function(e){var t,r=Object.keys(e);if((0,y.checkValidKeys)(r,["layer","indices","program","input","output","useOutputScale","color","blendAlpha"],"GPUComposer.drawLayerAsMesh(params)"),(0,y.checkRequiredKeys)(r,["layer"],"GPUComposer.drawLayerAsMesh(params)"),!this._iterateOverOutputsIfNeeded(e,"drawLayerAsMesh")){var n=this,i=n.gl,a=n._width,c=n._height,u=n.glslVersion,p=n._errorState,_=n._meshIndexBuffer,f=n._meshIndexArray,d=e.layer,m=e.output;if(!p){if(2!==d.numComponents&&4!==d.numComponents)throw new Error('GPUComposer.drawLayerAsMesh() must be passed a layer parameter with either 2 or 4 components, got position GPULayer "'.concat(d.name,'" with ').concat(d.numComponents," components."));var v=d.is1D()?d.length:d.width*d.height;u===s.GLSL1&&v>s.MAX_FLOAT_INT&&console.warn("Mesh positions array length: ".concat(v," is longer than what is supported by GLSL1 : ").concat(s.MAX_FLOAT_INT,"."));var h=e.program;if(void 0===h){h=this._setValueProgramForType(s.FLOAT);var g=e.color||[1,0,0];if(3!==g.length)throw new Error("Color parameter must have length 3, got ".concat(JSON.stringify(g),"."));h.setUniform("u_value",o(o([],g,!0),[1],!1),s.FLOAT)}var T=this._addLayerToInputs(d,e.input),E={};4===d.numComponents&&(E[s.GPUIO_VS_POSITION_W_ACCUM]="1");var A=this._drawSetup(h,s.LAYER_MESH_PROGRAM_NAME,E,!1,T,m);h._setVertexUniform(A,"u_gpuio_positions",(0,l.indexOfLayerInArray)(d,T),s.INT);var O=a,I=c;e.useOutputScale&&(O=(t=this._widthHeightForOutput(h.name,m)).width,I=t.height),h._setVertexUniform(A,"u_gpuio_scale",[1/O,1/I],s.FLOAT);var P=[d.width,d.height];if(h._setVertexUniform(A,"u_gpuio_positionsDimensions",P,s.FLOAT),u===s.GLSL1){if(void 0===_||f&&f.length<v){var R=(0,l.initSequentialFloatArray)(v);this._meshIndexArray=R,this._meshIndexBuffer=this._initVertexBuffer(R)}i.bindBuffer(i.ARRAY_BUFFER,this._meshIndexBuffer),this._setIndexAttribute(A,h.name)}if(this._setBlendMode(e.blendAlpha),e.indices){var S=e.indices,N=S.glType,b=S.count,L=S.buffer;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,L),i.drawElements(i.TRIANGLES,b,N,0)}else i.drawArrays(i.TRIANGLES,0,v);this._drawFinish(e)}}},e.prototype.undoThreeState=function(){var e=this,t=e.gl,r=e._threeRenderer,n=e.isWebGL2;if(!r)throw new Error("Can't call undoThreeState() on a GPUComposer that was not inited with GPUComposer.initWithThreeRenderer().");t.disable(t.BLEND),r&&(n?t.bindVertexArray(null):(0,E.getExtension)(this,E.OES_VERTEX_ARRAY_OBJECT,!0).bindVertexArrayOES(null))},e.prototype.resetThreeState=function(){var e=this.gl,t=this._threeRenderer;if(!t)throw new Error("Can't call resetThreeState() on a GPUComposer that was not inited with GPUComposer.initWithThreeRenderer().");var r=t.getViewport(new u.Vector4);e.viewport(r.x,r.y,r.width,r.height),t.resetState()},e.prototype.savePNG=function(e){void 0===e&&(e={});var t=Object.keys(e);(0,y.checkValidKeys)(t,["filename","dpi","callback"],"GPUComposer.savePNG(params)");var r=this.canvas,n=e.filename||"output",o=e.callback||saveAs;r.toBlob((function(t){t?e.dpi?(0,i.changeDpiBlob)(t,e.dpi).then((function(e){o(e,"".concat(n,".png"))})):o(t,"".concat(n,".png")):console.warn("Problem saving PNG, unable to init blob from canvas.")}),"image/png")},e.prototype.tick=function(){this._numTicks+=1;var e=this._lastTickTime,t=this._lastTickFPS,r=performance.now();if(this._lastTickTime=r,!e)return{fps:0,numTicks:this._numTicks};var n=1e3/(r-e);t||(t=n);var o=Number.parseFloat((.9*t+(1-.9)*n).toFixed(1));return this._lastTickFPS=o,{fps:o,numTicks:this._numTicks}},Object.defineProperty(e.prototype,"numTicks",{get:function(){return this._numTicks},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){var e,t=this,r=this.gl;this.verboseLogging&&console.log("Deallocating GPUComposer."),this._quadPositionsBuffer&&(r.deleteBuffer(this._quadPositionsBuffer),delete this._quadPositionsBuffer),this._boundaryPositionsBuffer&&(r.deleteBuffer(this._boundaryPositionsBuffer),delete this._boundaryPositionsBuffer),Object.keys(this._circlePositionsBuffer).forEach((function(e){r.deleteBuffer(t._circlePositionsBuffer[e])})),delete this._circlePositionsBuffer,delete this._pointIndexArray,this._pointIndexBuffer&&(r.deleteBuffer(this._pointIndexBuffer),delete this._pointIndexBuffer),delete this._vectorFieldIndexArray,this._vectorFieldIndexBuffer&&(r.deleteBuffer(this._vectorFieldIndexBuffer),delete this._vectorFieldIndexBuffer),this._indexedLinesIndexBuffer&&(r.deleteBuffer(this._indexedLinesIndexBuffer),delete this._indexedLinesIndexBuffer),Object.keys(this._vertexAttributeLocations).forEach((function(e){delete t._vertexAttributeLocations[e]})),delete this._vertexAttributeLocations,delete this._enabledVertexAttributes,Object.values(this._vertexShaders).forEach((function(e){var t=e.compiledShaders;Object.keys(t).forEach((function(e){r.deleteShader(t[e]),delete t[e]}))})),delete this._vertexShaders,Object.values(this._copyPrograms).forEach((function(e){e.dispose()})),Object.keys(this._copyPrograms).forEach((function(e){delete t._copyPrograms[e]})),delete this._copyPrograms,Object.values(this._setValuePrograms).forEach((function(e){e.dispose()})),Object.keys(this._setValuePrograms).forEach((function(e){delete t._setValuePrograms[e]})),delete this._setValuePrograms,null===(e=this._wrappedLineColorProgram)||void 0===e||e.dispose(),delete this._wrappedLineColorProgram,delete this._threeRenderer,delete this.gl,delete this.canvas,delete this._errorCallback,delete this._extensions,delete this._errorState,delete this.verboseLogging,delete this._numTicks,delete this.isWebGL2,delete this.glslVersion,delete this.intPrecision,delete this.floatPrecision,delete this._width,delete this._height},e}();t.GPUComposer=A},981:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GPUIndexBuffer=void 0;var n=r(566),o=r(650),i=r(707),a=r(581),c=function(){function e(e,t){if(this._composer=e,!t)throw new Error("Error initing GPUIndexBuffer: must pass params to GPUIndexBuffer(composer, params).");if(!(0,n.isObject)(t))throw new Error("Error initing GPUIndexBuffer: must pass valid params object to GPUIndexBuffer(composer, params), got ".concat(JSON.stringify(t),"."));var r=Object.keys(t);(0,i.checkValidKeys)(r,["indices","name"],"GPUIndexBuffer(composer, params)",t.name),(0,i.checkRequiredKeys)(r,["indices"],"GPUIndexBuffer(composer, params)",t.name);var c,s=t.indices,u=e.gl,l=e.isWebGL2,p=u.createBuffer();switch(u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,p),(0,o.isTypedArray)(s)||(s=new Uint32Array(s)),s.constructor){case Uint8Array:c=u.UNSIGNED_BYTE;break;case Uint16Array:c=u.UNSIGNED_SHORT;break;case Uint32Array:if(!l&&!(0,a.getExtension)(e,a.OES_ELEMENT_INDEX_UINT,!0)){c=u.UNSIGNED_SHORT,s=Uint16Array.from(s);break}c=u.UNSIGNED_INT}u.bufferData(u.ELEMENT_ARRAY_BUFFER,s,u.STATIC_DRAW),this.buffer=p,this.glType=c,this.count=s.length}return e.prototype.dispose=function(){var e=this._composer,t=this.buffer;e.gl.deleteBuffer(t),delete this._composer,delete this.buffer,delete this.glType,delete this.count},e}();t.GPUIndexBuffer=c},355:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function c(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.GPULayer=void 0;var i=r(650),a=r(566),c=r(809),s=r(162),u=r(707),l=r(601),p=r(593),_=r(798),f=r(690),d=function(){function e(t,r){this._clearValue=0,this._bufferIndex=0,this._buffers=[];var n=(r||{}).name;if(!t)throw new Error('Error initing GPULayer "'.concat(n,'": must pass GPUComposer instance to GPULayer(composer, params).'));if(!r)throw new Error("Error initing GPULayer: must pass params to GPULayer(composer, params).");if(!(0,a.isObject)(r))throw new Error("Error initing GPULayer: must pass valid params object to GPULayer(composer, params), got ".concat(JSON.stringify(r),"."));var o=Object.keys(r);(0,u.checkValidKeys)(o,["name","type","numComponents","dimensions","filter","wrapX","wrapY","numBuffers","clearValue","array"],"GPULayer(composer, params)",r.name),(0,u.checkRequiredKeys)(o,["name","type","numComponents","dimensions"],"GPULayer(composer, params)",r.name);var i=r.dimensions,c=r.type,s=r.numComponents,p=t.gl;if(this._composer=t,this.name=n,!(0,a.isPositiveInteger)(s)||s>4)throw new Error("Invalid numComponents: ".concat(JSON.stringify(s),' for GPULayer "').concat(n,'", must be number in range [1-4].'));this.numComponents=s;var _=e.calcGPULayerSize(i,n,t.verboseLogging),f=_.length,d=_.width,m=_.height;this._length=f,this._width=d,this._height=m;var v=void 0!==f||c!==l.FLOAT&&c!=l.HALF_FLOAT?l.NEAREST:l.LINEAR,h=void 0!==r.filter?r.filter:v;if(!(0,u.isValidFilter)(h))throw new Error("Invalid filter: ".concat(JSON.stringify(h),' for GPULayer "').concat(n,'", must be one of ').concat(JSON.stringify(l.validFilters),"."));if(h===l.LINEAR&&c!==l.FLOAT&&c!=l.HALF_FLOAT)throw new Error('LINEAR filtering is not supported on integer types, please use NEAREST filtering for GPULayer "'.concat(n,'" with type: ').concat(c,"."));this.filter=h;var g=void 0!==r.wrapX?r.wrapX:l.CLAMP_TO_EDGE;if(!(0,u.isValidWrap)(g))throw new Error("Invalid wrapX: ".concat(JSON.stringify(g),' for GPULayer "').concat(n,'", must be one of ').concat(JSON.stringify(l.validWraps),"."));this.wrapX=g;var y=void 0!==r.wrapY?r.wrapY:l.CLAMP_TO_EDGE;if(!(0,u.isValidWrap)(y))throw new Error("Invalid wrapY: ".concat(JSON.stringify(y),' for GPULayer "').concat(n,'", must be one of ').concat(JSON.stringify(l.validWraps),"."));if(this.wrapY=y,!(0,u.isValidDataType)(c))throw new Error("Invalid type: ".concat(JSON.stringify(c),' for GPULayer "').concat(n,'", must be one of ').concat(JSON.stringify(l.validDataTypes),"."));this.type=c;var T=e.getGPULayerInternalType({composer:t,type:c,name:n});this._internalType=T;var E=e.getGLTextureParameters({composer:t,name:n,numComponents:s,internalType:T}),A=E.glFormat,O=E.glInternalFormat,I=E.glType,P=E.glNumChannels;this._glInternalFormat=O,this._glFormat=A,this._glType=I,this._glNumChannels=P;var R=e.getGPULayerInternalFilter({composer:t,filter:h,wrapX:g,wrapY:y,internalType:T,name:n});this._internalFilter=R,this._glFilter=p[R],this._internalWrapX=e.getGPULayerInternalWrap({composer:t,wrap:g,internalFilter:R,internalType:T,name:n}),this._glWrapS=p[this._internalWrapX],this._internalWrapY=e.getGPULayerInternalWrap({composer:t,wrap:y,internalFilter:R,internalType:T,name:n}),this._glWrapT=p[this._internalWrapY];var S=void 0!==r.numBuffers?r.numBuffers:1;if(!(0,a.isPositiveInteger)(S))throw new Error("Invalid numBuffers: ".concat(JSON.stringify(S),' for GPULayer "').concat(n,'", must be positive integer.'));this.numBuffers=S,void 0!==r.clearValue&&(this.clearValue=r.clearValue),this._initBuffers(r.array)}return e.initFromImageURL=function(t,r){return n(this,void 0,void 0,(function(){return o(this,(function(n){return[2,new Promise((function(n,o){if(!r)throw new Error("Error initing GPULayer: must pass params to GPULayer.initFromImageURL(composer, params).");if(!(0,a.isObject)(r))throw new Error("Error initing GPULayer: must pass valid params object to GPULayer.initFromImageURL(composer, params), got ".concat(JSON.stringify(r),"."));var i=Object.keys(r);(0,u.checkValidKeys)(i,["name","url","filter","wrapX","wrapY","format","type"],"GPULayer.initFromImageURL(composer, params)",r.name),(0,u.checkRequiredKeys)(i,["name","url"],"GPULayer.initFromImageURL(composer, params)",r.name);var c=r.url,s=r.name,p=r.filter,_=r.wrapX,f=r.wrapY,d=r.type,m=r.format;if(!(0,a.isString)(c))throw new Error("Expected GPULayer.initFromImageURL params to have url of type string, got ".concat(c," of type ").concat(typeof c,"."));if(d&&!(0,u.isValidImageType)(d))throw new Error('Invalid type: "'.concat(d,'" for GPULayer.initFromImageURL "').concat(s,'", must be one of ').concat(JSON.stringify(l.validImageTypes),"."));if(m&&!(0,u.isValidImageFormat)(m))throw new Error('Invalid format: "'.concat(m,'" for GPULayer.initFromImageURL "').concat(s,'", must be one of ').concat(JSON.stringify(l.validImageFormats),"."));var v=new e(t,{name:s,type:d||l.FLOAT,filter:p,wrapX:_,wrapY:f,numComponents:m?m.length:4,dimensions:[1,1],numBuffers:1}),h=new Image;h.onload=function(){v.resize([h.width,h.height],h),n(v)},h.onerror=function(e){o(new Error('Error loading image "'.concat(s,'": ').concat(e)))},h.src=c}))]}))}))},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){if(!this._length)throw new Error('Cannot access length on 2D GPULayer "'.concat(this.name,'".'));return this._length},enumerable:!1,configurable:!0}),e.prototype.is1D=function(){return void 0!==this._length},e.prototype.is2D=function(){return!this.is1D()},e.prototype._usingTextureOverrideForCurrentBuffer=function(){return!(!this._textureOverrides||!this._textureOverrides[this.bufferIndex])},e.prototype.copyCurrentStateToGPULayer=function(e){var t=this._composer;if(this===e)throw new Error("Can't call GPULayer.copyCurrentStateToGPULayer() on self.");var r=t._copyProgramForType(this._internalType);t.step({program:r,input:this,output:e})},e.prototype._initBuffers=function(t){var r=this,n=r.name,o=r.numBuffers,i=r._composer,c=r._glInternalFormat,s=r._glFormat,u=r._glType,l=r._glFilter,p=r._glWrapS,_=r._glWrapT,f=r.width,d=r.height,m=i.gl,v=i._errorCallback,h=null;(0,a.isArray)(t)?h=e.validateGPULayerArray(t,this):(null==t?void 0:t.constructor)===HTMLImageElement&&(h=t);for(var g=0;g<o;g++){var y=m.createTexture();if(!y)return void v('Could not init texture for GPULayer "'.concat(n,'": ').concat(m.getError(),"."));m.bindTexture(m.TEXTURE_2D,y),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,p),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,_),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,l),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,l),m.texImage2D(m.TEXTURE_2D,0,c,f,d,0,s,u,h),this._buffers.push(y)}m.bindTexture(m.TEXTURE_2D,null),m.bindFramebuffer(m.FRAMEBUFFER,null)},Object.defineProperty(e.prototype,"bufferIndex",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),e.prototype.incrementBufferIndex=function(){var e=this.numBuffers;1!==e&&(this._bufferIndex=(this.bufferIndex+1)%e)},e.prototype.decrementBufferIndex=function(){var e=this.numBuffers;1!==e&&(this._bufferIndex=(this.bufferIndex-1+e)%e)},Object.defineProperty(e.prototype,"currentState",{get:function(){return this.getStateAtIndex(this.bufferIndex)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_currentTexture",{get:function(){var e=this,t=e._buffers,r=e._bufferIndex,n=e._textureOverrides;return n&&n[r]?n[r]:t[r]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastState",{get:function(){if(1===this.numBuffers)throw new Error('Cannot access lastState on GPULayer "'.concat(this.name,'" with only one buffer.'));return this.getStateAtIndex((this.bufferIndex-1+this.numBuffers)%this.numBuffers)},enumerable:!1,configurable:!0}),e.prototype.getStateAtIndex=function(e){var t=this,r=t.numBuffers,n=t._textureOverrides,o=t._buffers;e<0&&e>-r&&(e+=r),(e<0||e>=r)&&(console.warn("Out of range buffer index: ".concat(e,' for GPULayer "').concat(this.name,'" with $.numBuffers} buffer').concat(r>1?"s":"",".  Was this intentional?")),e<0?e+=r*Math.ceil(Math.abs(e)/r):e%=r);var i=o[e];return n&&n[e]&&(i=n[e]),{texture:i,layer:this}},e.prototype._prepareForWrite=function(e){e&&this.incrementBufferIndex(),this._textureOverrides&&(this._textureOverrides[this.bufferIndex]=void 0)},e.prototype.setFromArray=function(t){var r=this,n=r._composer,o=r._glInternalFormat,i=r._glFormat,a=r._glType,c=r.width,s=r.height,u=r._currentTexture,l=n.gl,p=e.validateGPULayerArray(t,this);l.bindTexture(l.TEXTURE_2D,u),l.texImage2D(l.TEXTURE_2D,0,o,c,s,0,i,a,p),l.bindTexture(l.TEXTURE_2D,null)},e.prototype.resize=function(t,r){var n=this.name,o=this._composer.verboseLogging;o&&console.log('Resizing GPULayer "'.concat(n,'" to ').concat(JSON.stringify(t),"."));var i=e.calcGPULayerSize(t,n,o),a=i.length,c=i.width,s=i.height;this._length=a,this._width=c,this._height=s,this._destroyBuffers(),this._initBuffers(r)},Object.defineProperty(e.prototype,"clearValue",{get:function(){return this._clearValue},set:function(e){var t=this.numComponents,r=this.type;if(!(0,u.isValidClearValue)(e,t,r))throw new Error("Invalid clearValue: ".concat(JSON.stringify(e),' for GPULayer "').concat(this.name,'", expected ').concat(r," or array of ").concat(r," of length ").concat(t,"."));this._clearValue=(0,a.isArray)(e)?e.slice():e,this._clearValueVec4=void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clearValueVec4",{get:function(){var e=this._clearValueVec4;if(!e){var t=this.clearValue;if(e=[],(0,a.isFiniteNumber)(t))e.push(t,t,t,t);else{e.push.apply(e,t);for(var r=e.length;r<4;r++)e.push(0)}this._clearValueVec4=e}return e},enumerable:!1,configurable:!0}),e.prototype.clear=function(e){void 0===e&&(e=!1);var t=this,r=t.name,n=t._composer,o=t.clearValueVec4,i=t.numBuffers,a=t.type;n.verboseLogging&&console.log('Clearing GPULayer "'.concat(r,'".'));var c=n._setValueProgramForType(a);c.setUniform("u_value",o),this.decrementBufferIndex();for(var s=e?i:1,u=0;u<s;u++)n.step({program:c,output:this});e&&this.incrementBufferIndex()},e.prototype._getValuesSetup=function(){var e=this,t=e.width,r=e.height,n=e._composer,o=e._currentTexture,i=this._valuesRaw,a=n.gl;(0,_.bindFrameBuffer)(n,this,o);var c=this,s=c._glNumChannels,u=c._glType,f=c._glFormat,d=c._internalType;switch(d){case l.HALF_FLOAT:void 0!==a.FLOAT?(s=4,f=a.RGBA,u=a.FLOAT,i=i||new Float32Array(t*r*s)):i=i||new Uint16Array(t*r*s);break;case l.FLOAT:s=4,f=a.RGBA,i=i||new Float32Array(t*r*s);break;case l.UNSIGNED_BYTE:case l.UNSIGNED_SHORT:s=4,f=a.RGBA_INTEGER,u=a.UNSIGNED_INT,i=i||new Uint32Array(t*r*s);break;case l.UNSIGNED_INT:s=4,f=a.RGBA_INTEGER,i=i||new Uint32Array(t*r*s);break;case l.BYTE:case l.SHORT:s=4,f=a.RGBA_INTEGER,u=a.INT,i=i||new Int32Array(t*r*s);break;case l.INT:s=4,f=a.RGBA_INTEGER,i=i||new Int32Array(t*r*s);break;default:throw new Error("Unsupported internalType ".concat(d," for getValues()."))}if(this._valuesRaw=i,(0,p.readyToRead)(a))return{_glFormat:f,_glType:u,_valuesRaw:i,_glNumChannels:s,_internalType:d};throw new Error("Unable to read values from Buffer with status: ".concat(a.checkFramebufferStatus(a.FRAMEBUFFER),"."))},e.prototype._getValuesPost=function(t,r,n){var o=this,a=o.width,c=o.height,s=o.numComponents,u=o.type,p=(this._length?this._length:a*c)*s,_=n===l.HALF_FLOAT&&t.constructor===Uint16Array,d=this._valuesBufferView;_&&!d&&(d=new DataView(t.buffer),this._valuesBufferView=d),t.length===p&&(0,f.arrayConstructorForType)(u,!0)===t.constructor?this._values=t:this._values||(this._values=e.initArrayForType(u,p,!0));var m=this._values;if(d||m!==t||s!==r)for(var v=0,h=a*c;v<h;v++){var g=v*r,y=v*s;if(y>=p)break;for(var T=0;T<s;T++)m[y+T]=d?(0,i.getFloat16)(d,2*(g+T),!0):t[g+T]}return m},e.prototype.getValues=function(){var e=this,t=e.width,r=e.height,n=e._composer.gl,o=this._getValuesSetup(),i=o._glFormat,a=o._glType,c=o._valuesRaw,s=o._glNumChannels,u=o._internalType;return n.readPixels(0,0,t,r,i,a,c),this._getValuesPost(c,s,u)},e.prototype.getValuesAsync=function(){return n(this,void 0,void 0,(function(){var e,t,r,n,i,a,c,s,u,l,_;return o(this,(function(o){switch(o.label){case 0:return t=(e=this).width,r=e.height,n=e._composer,i=n.gl,n.isWebGL2?(a=this._getValuesSetup(),c=a._glFormat,s=a._glType,u=a._valuesRaw,l=a._glNumChannels,_=a._internalType,[4,(0,p.readPixelsAsync)(i,0,0,t,r,c,s,u)]):[2,this.getValues()];case 1:return o.sent(),[2,this._getValuesPost(u,l,_)]}}))}))},e.prototype.savePNG=function(e){void 0===e&&(e={});var t=Object.keys(e);(0,u.checkValidKeys)(t,["filename","dpi","multiplier","callback"],"GPULayer.savePNG(params)");var r=this.getValues(),n=this,o=n.width,i=n.height,a=n.type,p=n.name,_=n.numComponents,f=e.callback||s.saveAs,d=e.filename||p,m=e.multiplier||(a===l.FLOAT||a===l.HALF_FLOAT?255:1),v=document.createElement("canvas");v.width=o,v.height=i;for(var h=v.getContext("2d"),g=h.getImageData(0,0,o,i),y=g.data,T=0;T<i;T++)for(var E=0;E<o;E++){for(var A=T*o+E,O=(i-1-T)*o+E,I=0;I<_;I++)y[4*O+I]=r[_*A+I]*m;1===_&&(y[4*O+1]=y[4*O],y[4*O+2]=y[4*O]),_<4&&(y[4*O+3]=255)}h.putImageData(g,0,0),v.toBlob((function(t){t?e.dpi?(0,c.changeDpiBlob)(t,e.dpi).then((function(e){f(e,"".concat(d,".png"))})):f(t,"".concat(d,".png")):console.warn('Problem saving PNG from GPULayer "'.concat(p,'", unable to init blob.'))}),"image/png")},e.prototype.attachToThreeTexture=function(e){var t=this,r=t._composer,n=t.numBuffers,o=t.currentState,i=t.name,a=r._threeRenderer,c=r.gl;if(!a)throw new Error("GPUComposer was not inited with a renderer.");if(n>1)throw new Error('GPULayer "'.concat(i,'" contains multiple WebGL textures (one for each buffer) that are flip-flopped during compute cycles, please choose a GPULayer with one buffer.'));var s=a.properties.get(e);c.deleteTexture(s.__webglTexture),s.__webglTexture=o.texture,s.__webglInit=!0},e.prototype._destroyBuffers=function(){var e=this._composer,t=this._buffers,r=e.gl;t.forEach((function(e){r.deleteTexture(e),(0,_.disposeFramebuffers)(r,e)})),t.length=0,delete this._textureOverrides},e.prototype.clone=function(e){return this._composer._cloneGPULayer(this,e)},e.prototype.dispose=function(){var e=this.name,t=this._composer,r=t.gl;if(t.verboseLogging&&console.log('Deallocating GPULayer "'.concat(e,'".')),!r)throw new Error("Must call dispose() on all GPULayers before calling dispose() on GPUComposer.");this._destroyBuffers(),delete this._buffers,delete this._composer,this._values&&delete this._values,this._valuesRaw&&delete this._valuesRaw},e}();t.GPULayer=d},191:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.minMaxValuesForType=t.testFilterWrap=t.testWriteSupport=t.shouldCastIntTypeAsFloat=void 0;var n=r(566),o=r(650),i=r(601),a=r(690),c=r(581),s=r(798),u=r(355),l=r(593),p={writeSupport:{},filterWrapSupport:{}};function _(e,t){var r=e.glslVersion,n=e.isWebGL2;return!(r===i.GLSL3&&n||t!==i.UNSIGNED_BYTE&&t!==i.BYTE&&t!==i.SHORT&&t!==i.INT&&t!==i.UNSIGNED_SHORT&&t!==i.UNSIGNED_INT)}function f(e,t){var r=e.gl,n=e.glslVersion,o=e.isWebGL2,a="".concat(o,",").concat(t,",").concat(n===i.GLSL3?"3":"1");if(void 0!==p.writeSupport[a])return p.writeSupport[a];var c=r.createTexture();if(!c)return p.writeSupport[a]=!1,p.writeSupport[a];r.bindTexture(r.TEXTURE_2D,c);var s=r[i.CLAMP_TO_EDGE],l=r[i.NEAREST];r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,l),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,l);var _=u.GPULayer.getGLTextureParameters({composer:e,name:"testWriteSupport",numComponents:1,internalType:t}),f=_.glInternalFormat,d=_.glFormat,m=_.glType;r.texImage2D(r.TEXTURE_2D,0,f,10,10,0,d,m,null);var v=r.createFramebuffer();if(!v)return r.deleteTexture(c),p.writeSupport[a]=!1,p.writeSupport[a];r.bindFramebuffer(r.FRAMEBUFFER,v),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,c,0);var h=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.deleteTexture(c),r.deleteFramebuffer(v),p.writeSupport[a]=h,p.writeSupport[a]}function d(e,t,r,n){var a,c=e.gl,_=e.glslVersion,f=e.intPrecision,d=e.floatPrecision,m=e._errorCallback,v=e.isWebGL2,h="".concat(v,",").concat(t,",").concat(r,",").concat(n,",").concat(_===i.GLSL3?"3":"1");if(void 0!==p.filterWrapSupport[h])return p.filterWrapSupport[h];var g=c.createTexture();if(!g)return p.filterWrapSupport[h]=!1,p.filterWrapSupport[h];c.bindTexture(c.TEXTURE_2D,g);var y=c[n],T=c[r];c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,y),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,y),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,T),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,T);for(var E=u.GPULayer.getGLTextureParameters({composer:e,name:"testFilterWrap",numComponents:1,internalType:t}),A=E.glInternalFormat,O=E.glFormat,I=E.glType,P=E.glNumChannels,R=[3,56.5,834,-53.6,.003,96.2,23,90.2,32],S=u.GPULayer.initArrayForType(t,R.length*P,!0),N=0;N<R.length;N++)S[N*P]=R[N],R[N]=S[N*P];if(t===i.HALF_FLOAT){var b=new Uint16Array(S.length),L=new DataView(b.buffer);for(N=0;N<S.length;N++)(0,o.setFloat16)(L,2*N,S[N],!0);S=b}c.texImage2D(c.TEXTURE_2D,0,A,3,3,0,O,I,S);var U=new u.GPULayer(e,{name:"testFloatLinearFiltering-output",type:t,numComponents:1,dimensions:[3,3],wrapX:i.CLAMP_TO_EDGE,wrapY:i.CLAMP_TO_EDGE,filter:i.NEAREST}),F=r===i.LINEAR?.5:1,w="testFilterWrap-program",x="\nin vec2 v_uv;\nuniform vec2 u_offset;\n#ifdef GPUIO_INT\n\tuniform isampler2D u_input;\n\tout int out_result;\n#endif\n#ifdef GPUIO_UINT\n\tuniform usampler2D u_input;\n\tout uint out_result;\n#endif\n#ifdef GPUIO_FLOAT\n\tuniform sampler2D u_input;\n\tout float out_result;\n#endif\nvoid main() {\n\tout_result = texture(u_input, v_uv + offset).x;\n}";_!==i.GLSL3&&(x=(0,l.convertFragmentShaderToGLSL1)(x,w)[0]);var G=(0,l.compileShader)(c,_,f,d,x,c.FRAGMENT_SHADER,w,m,((a={offset:"vec2(".concat(F/3,", ").concat(F/3,")")})[(0,l.isUnsignedIntType)(t)?"GPUIO_UINT":(0,l.isIntType)(t)?"GPUIO_INT":"GPUIO_FLOAT"]="1",a),void 0,!0);function D(e,t){return n===i.CLAMP_TO_EDGE?Math.max(0,Math.min(t-1,e)):(e+t)%t}var M=e._getVertexShader(i.DEFAULT_PROGRAM_NAME,"",{},w);if(M&&G){var C=(0,l.initGLProgram)(c,M,G,w,m);if(C){U._prepareForWrite(!1),(0,s.bindFrameBuffer)(e,U,U._currentTexture),c.viewport(0,0,3,3),c.useProgram(C),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,g),c.uniform2fv(c.getUniformLocation(C,"u_gpuio_scale"),[1,1]),c.uniform2fv(c.getUniformLocation(C,"u_gpuio_translation"),[0,0]),c.bindBuffer(c.ARRAY_BUFFER,e._getQuadPositionsBuffer()),e._setPositionAttribute(C,w),c.drawArrays(c.TRIANGLE_STRIP,0,4),c.disable(c.BLEND);for(var B=U.getValues(),V=!0,k=(0,l.isIntType)(t)?0:t===i.HALF_FLOAT?.01:1e-4,H=0;H<3;H++)for(var W=0;W<3;W++){var X=void 0;if(r===i.LINEAR)X=(R[3*W+H]+R[3*W+D(H+1,3)]+R[3*D(W+1,3)+H]+R[3*D(W+1,3)+D(H+1,3)])/4;else{var j=D(H+F,3);X=R[3*D(W+F,3)+j]}if(N=3*W+H,Math.abs((X-B[N])/X)>k){V=!1;break}}p.filterWrapSupport[h]=V,c.deleteProgram(C)}else p.filterWrapSupport[h]=!1;c.deleteShader(G)}else p.filterWrapSupport[h]=!1;return U.dispose(),c.deleteTexture(g),p.filterWrapSupport[h]}function m(e){var t=-1/0,r=1/0;switch(e){case i.UNSIGNED_BYTE:t=i.MIN_UNSIGNED_BYTE,r=i.MAX_UNSIGNED_BYTE;break;case i.BYTE:t=i.MIN_BYTE,r=i.MAX_BYTE;break;case i.UNSIGNED_SHORT:t=i.MIN_UNSIGNED_SHORT,r=i.MAX_UNSIGNED_SHORT;break;case i.SHORT:t=i.MIN_SHORT,r=i.MAX_SHORT;break;case i.UNSIGNED_INT:t=i.MIN_UNSIGNED_INT,r=i.MAX_UNSIGNED_INT;break;case i.INT:t=i.MIN_INT,r=i.MAX_INT}return{min:t,max:r}}u.GPULayer.initArrayForType=function(e,t,r){return void 0===r&&(r=!1),new((0,a.arrayConstructorForType)(e,r))(t)},u.GPULayer.calcGPULayerSize=function(e,t,r){if((0,n.isNumber)(e)){if(!(0,n.isPositiveInteger)(e))throw new Error("Invalid length: ".concat(JSON.stringify(e),' for GPULayer "').concat(t,'", must be positive integer.'));var o=e,i=Math.ceil(Math.sqrt(o)),a=Math.ceil(o/i);return r&&console.log("Using [".concat(i,", ").concat(a,"] for 1D array of length ").concat(e,' in GPULayer "').concat(t,'".')),{width:i,height:a,length:o}}var c=e[0];if(!(0,n.isPositiveInteger)(c))throw new Error("Invalid width: ".concat(JSON.stringify(c),' for GPULayer "').concat(t,'", must be positive integer.'));var s=e[1];if(!(0,n.isPositiveInteger)(s))throw new Error("Invalid height: ".concat(JSON.stringify(s),' for GPULayer "').concat(t,'", must be positive integer.'));return{width:c,height:s}},u.GPULayer.getGPULayerInternalWrap=function(e){var t=e.composer,r=e.wrap,n=e.internalFilter,o=e.internalType;return r===i.CLAMP_TO_EDGE||d(t,o,n,r)?r:i.CLAMP_TO_EDGE},u.GPULayer.getGPULayerInternalFilter=function(e){var t=e.filter;if(t===i.NEAREST)return t;var r=e.composer,n=e.internalType,o=e.wrapX,a=e.wrapY,s=e.name;return n===i.HALF_FLOAT&&(((0,c.getExtension)(r,c.OES_TEXTURE_HAlF_FLOAT_LINEAR,!0)||(0,c.getExtension)(r,c.OES_TEXTURE_FLOAT_LINEAR,!0))&&d(r,n,t,o)&&d(r,n,t,a)||(console.warn("This browser does not support ".concat(t," filtering for type ").concat(n," and wrap [").concat(o,", ").concat(a,'].  Falling back to NEAREST filter for GPULayer "').concat(s,'" with ').concat(t," polyfill in fragment shader.")),t=i.NEAREST)),n===i.FLOAT&&((0,c.getExtension)(r,c.OES_TEXTURE_FLOAT_LINEAR,!0)&&d(r,n,t,o)&&d(r,n,t,a)||(console.warn("This browser does not support ".concat(t," filtering for type ").concat(n," and wrap [").concat(o,", ").concat(a,'].  Falling back to NEAREST filter for GPULayer "').concat(s,'" with ').concat(t," polyfill in fragment shader.")),t=i.NEAREST)),t},t.shouldCastIntTypeAsFloat=_,u.GPULayer.getGLTextureParameters=function(e){var t,r,n,o,a=e.composer,s=e.name,u=e.numComponents,l=e.internalType,p=a.gl,_=a.glslVersion;if(a.isWebGL2){if(o=u,3===u&&(o=4),l===i.FLOAT||l===i.HALF_FLOAT)switch(o){case 1:r=p.RED;break;case 2:r=p.RG;break;case 4:r=p.RGBA;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(s,'".'))}else switch(o){case 1:r=p.RED_INTEGER;break;case 2:r=p.RG_INTEGER;break;case 4:r=p.RGBA_INTEGER;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(s,'".'))}switch(l){case i.HALF_FLOAT:switch(t=p.HALF_FLOAT,o){case 1:n=p.R16F;break;case 2:n=p.RG16F;break;case 4:n=p.RGBA16F;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(s,'".'))}break;case i.FLOAT:switch(t=p.FLOAT,o){case 1:n=p.R32F;break;case 2:n=p.RG32F;break;case 4:n=p.RGBA32F;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(s,'".'))}break;case i.UNSIGNED_BYTE:if(t=p.UNSIGNED_BYTE,_===i.GLSL1&&l===i.UNSIGNED_BYTE)n=r;else switch(o){case 1:n=p.R8UI;break;case 2:n=p.RG8UI;break;case 4:n=p.RGBA8UI;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(s,'".'))}break;case i.BYTE:switch(t=p.BYTE,o){case 1:n=p.R8I;break;case 2:n=p.RG8I;break;case 4:n=p.RGBA8I;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(s,'".'))}break;case i.SHORT:switch(t=p.SHORT,o){case 1:n=p.R16I;break;case 2:n=p.RG16I;break;case 4:n=p.RGBA16I;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(s,'".'))}break;case i.UNSIGNED_SHORT:switch(t=p.UNSIGNED_SHORT,o){case 1:n=p.R16UI;break;case 2:n=p.RG16UI;break;case 4:n=p.RGBA16UI;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(s,'".'))}break;case i.INT:switch(t=p.INT,o){case 1:n=p.R32I;break;case 2:n=p.RG32I;break;case 4:n=p.RGBA32I;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(s,'".'))}break;case i.UNSIGNED_INT:switch(t=p.UNSIGNED_INT,o){case 1:n=p.R32UI;break;case 2:n=p.RG32UI;break;case 4:n=p.RGBA32UI;break;default:throw new Error("Unsupported glNumChannels: ".concat(o,' for GPULayer "').concat(s,'".'))}break;default:throw new Error('Unsupported type: "'.concat(l,'" for GPULayer "').concat(s,'".'))}}else{if(u<1||u>4)throw new Error("Unsupported numComponents: ".concat(u,' for GPULayer "').concat(s,'".'));switch(o=4,r=p.RGBA,n=p.RGBA,l){case i.FLOAT:t=p.FLOAT;break;case i.HALF_FLOAT:t=p.HALF_FLOAT||(0,c.getExtension)(a,c.OES_TEXTURE_HALF_FLOAT).HALF_FLOAT_OES;break;default:throw new Error('Unsupported type: "'.concat(l,'" in WebGL 1.0 for GPULayer "').concat(s,'".'))}}if(void 0===t||void 0===r||void 0===n){var f=[];throw void 0===t&&f.push("glType"),void 0===r&&f.push("glFormat"),void 0===n&&f.push("glInternalFormat"),new Error("Invalid type: ".concat(l," for numComponents: ").concat(u,", unable to init parameter").concat(f.length>1?"s":""," ").concat(f.join(", "),' for GPULayer "').concat(s,'".'))}if(void 0===o||u<1||u>4||o<u)throw new Error("Invalid numChannels: ".concat(o," for numComponents: ").concat(u,' for GPULayer "').concat(s,'".'));return{glFormat:r,glInternalFormat:n,glType:t,glNumChannels:o}},t.testWriteSupport=f,t.testFilterWrap=d,u.GPULayer.getGPULayerInternalType=function(e){var t=e.composer,r=e.name,n=t._errorCallback,o=t.isWebGL2,a=e.type,s=a;return _(t,a)&&(s===i.UNSIGNED_BYTE||s===i.BYTE?s=i.HALF_FLOAT:(console.warn("Falling back ".concat(s,' type to FLOAT type for glsl1.x support for GPULayer "').concat(r,'".\nLarge UNSIGNED_INT or INT with absolute value > 16,777,216 are not supported, on mobile UNSIGNED_INT, INT, UNSIGNED_SHORT, and SHORT with absolute value > 2,048 may not be supported.')),s=i.FLOAT)),o?(s===i.FLOAT&&((0,c.getExtension)(t,c.EXT_COLOR_BUFFER_FLOAT,!0)?f(t,s)||(console.warn('FLOAT not supported for writing operations in this browser, falling back to HALF_FLOAT type for GPULayer "'.concat(r,'".')),s=i.HALF_FLOAT):(console.warn('FLOAT not supported in this browser, falling back to HALF_FLOAT type for GPULayer "'.concat(r,'".')),s=i.HALF_FLOAT)),s===i.HALF_FLOAT&&((0,c.getExtension)(t,c.EXT_COLOR_BUFFER_HALF_FLOAT,!0)||(0,c.getExtension)(t,c.EXT_COLOR_BUFFER_FLOAT,!0),f(t,s)||(console.warn("This browser does not support writing to HALF_FLOAT textures."),n("This browser does not support writing to HALF_FLOAT textures.")))):(s===i.FLOAT&&((0,c.getExtension)(t,c.OES_TEXTURE_FLOAT,!0)?f(t,s)||(console.warn('FLOAT not supported for writing operations in this browser, falling back to HALF_FLOAT type for GPULayer "'.concat(r,'".')),s=i.HALF_FLOAT):(console.warn('FLOAT not supported in this browser, falling back to HALF_FLOAT type for GPULayer "'.concat(r,'".')),s=i.HALF_FLOAT)),s===i.HALF_FLOAT&&((0,c.getExtension)(t,c.OES_TEXTURE_HALF_FLOAT,!0),f(t,s)||console.warn("This browser does not support writing to HALF_FLOAT textures."))),s},t.minMaxValuesForType=m,u.GPULayer.validateGPULayerArray=function(e,t){var r=t.numComponents,n=t.width,a=t.height,c=t.name,s=t._glNumChannels,l=t._internalType,p=t.is1D()?t.length:null;if(e.length!==n*a*r&&(!p||p&&e.length!==p*r))throw new Error("Invalid data length: ".concat(e.length,' for GPULayer "').concat(c,'" of ').concat(p?"length ".concat(p," and "):"","dimensions: [").concat(n,", ").concat(a,"] and numComponents: ").concat(r,"."));var _=!1;switch(e.constructor){case Array:_=!0;break;case Float32Array:_=l!==i.FLOAT;break;case Uint8Array:_=l!==i.UNSIGNED_BYTE;break;case Int8Array:_=l!==i.BYTE;break;case Uint16Array:_=l!==i.UNSIGNED_SHORT;break;case Int16Array:_=l!==i.SHORT;break;case Uint32Array:_=l!==i.UNSIGNED_INT;break;case Int32Array:_=l!==i.INT;break;default:throw new Error("Invalid array type: ".concat(e.constructor.name,' for GPULayer "').concat(c,'", please use one of [').concat(i.validArrayTypes.map((function(e){return e.name})).join(", "),"]."))}var f=m(l),d=f.min,v=f.max,h=n*a*s,g=e.length!==h,y=e;if(_||g){y=u.GPULayer.initArrayForType(l,h);for(var T=l===i.HALF_FLOAT&&_?new DataView(y.buffer):null,E=0,A=e.length/r;E<A;E++)for(var O=0;O<r;O++){var I=e[E*r+O],P=I,R=!1;P<d?(P=d,R=!0):P>v&&(P=v,R=!0),R&&console.warn("Clipping out of range value ".concat(I," to ").concat(P,' for GPULayer "').concat(c,'" with internal type ').concat(l,"."));var S=E*s+O;T?(0,o.setFloat16)(T,2*S,P,!0):y[S]=P}}return y}},664:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.GPUProgram=void 0;var a=r(601),c=r(593),s=r(360),u=r(566),l=r(707),p=r(581),_=function(){function e(t,r){var n=this;this._fragmentShaders={},this._compileTimeConstants={},this._uniforms={},this._programs={},this._programsKeyLookup=new WeakMap,this._samplerUniformsIndices=[];var o=(r||{}).name;if(!t)throw new Error('Error initing GPUProgram "'.concat(o,'": must pass GPUComposer instance to GPUProgram(composer, params).'));if(!r)throw new Error("Error initing GPUProgram: must pass params to GPUProgram(composer, params).");if(!(0,u.isObject)(r))throw new Error("Error initing GPUProgram: must pass valid params object to GPUProgram(composer, params), got ".concat(JSON.stringify(r),"."));var s=Object.keys(r);(0,l.checkValidKeys)(s,["name","fragmentShader","uniforms","compileTimeConstants"],"GPUProgram(composer, params)",r.name),(0,l.checkRequiredKeys)(s,["name","fragmentShader"],"GPUProgram(composer, params)",r.name);var _=r.fragmentShader,d=r.uniforms,m=r.compileTimeConstants;this._composer=t,this.name=o;var v=(0,u.isString)(_)?_:_.join("\n"),h=(0,c.preprocessFragmentShader)(v,t.glslVersion,o),g=h.shaderSource,y=h.samplerUniforms,T=h.additionalSources;if(this._fragmentShaderSource=g,y.forEach((function(e,t){n._samplerUniformsIndices.push({name:e,inputIndex:0,shaderIndex:t})})),this.constructor===e&&T){this._childPrograms=[];for(var E=0,A=T.length;E<A;E++)this._childPrograms.push(new f(t,r,{fragmentShaderSource:T[E]}))}if(m&&(this._compileTimeConstants=i({},m)),t.glslVersion===a.GLSL1&&(g.includes("dFdx")||g.includes("dFdy")||g.includes("fwidth"))&&(0,p.getExtension)(t,p.OES_STANDARD_DERIVATIVES,!0)&&(this._extensions="#extension GL_OES_standard_derivatives : enable\n"),d)for(E=0;E<d.length;E++){var O=d[E],I=O.name,P=O.value,R=O.type;this.setUniform(I,P,R)}}return e.prototype.recompile=function(e){var t=this._compileTimeConstants,r=!1;if(Object.keys(e).forEach((function(n){t[n]!==e[n]&&(r=!0,t[n]=e[n])})),r){for(var n=this,o=n._fragmentShaders,i=n._programs,a=n._programsKeyLookup,c=n._composer,s=n._uniforms,u=c.gl,l=Object.keys(i),p=0,_=l.length;p<_;p++){var f=i[v=l[p]];u.deleteProgram(f),a.delete(f),delete i[v]}for(var d=Object.keys(o),m=(p=0,d.length);p<m;p++){var v=d[p];u.deleteShader(o[v]),delete o[v]}for(var h=Object.values(s),g=(p=0,h.length);p<g;p++)h[p].location=new WeakMap;if(this._childPrograms){p=0;for(var y=this._childPrograms.length;p<y;p++)this._childPrograms[p].recompile(e)}}},e.prototype._getFragmentShader=function(e,t){var r=this._fragmentShaders;if(r[e])return r[e];for(var n=this,o=n._composer,i=n.name,a=n._fragmentShaderSource,s=n._compileTimeConstants,u=n._extensions,l=o.gl,p=o._errorCallback,_=o.verboseLogging,f=o.glslVersion,d=o.floatPrecision,m=o.intPrecision,v=Object.keys(t),h=0;h<v.length;h++){var g=v[h];s[g]=t[g]}_&&console.log('Compiling fragment shader for GPUProgram "'.concat(i,'" with compile time constants: ').concat(JSON.stringify(s)));var y=(0,c.compileShader)(l,f,m,d,a,l.FRAGMENT_SHADER,i,p,s,u,0===Object.keys(r).length);if(y)return r[e]=y,r[e];p('Unable to compile fragment shader for GPUProgram "'.concat(i,'".'))},e.prototype._getProgramWithName=function(e,t,r){for(var n=this._samplerUniformsIndices,o=this._composer,i="",u={},l=0,p=n.length;l<p;l++){var _=r[n[l].inputIndex].layer,f=_.filter,d=_.wrapX,m=_.wrapY,v=_.type,h=_._internalFilter,g=_._internalWrapX,y=_._internalWrapY,T=d===g?0:d===a.REPEAT?1:0,E=m===y?0:m===a.REPEAT?1:0,A=f===h?0:f===a.LINEAR?1:0;i+="_IN".concat(l,"_").concat(T,"_").concat(E,"_").concat(A),u["".concat(s.SAMPLER2D_WRAP_X).concat(l)]="".concat(T),u["".concat(s.SAMPLER2D_WRAP_Y).concat(l)]="".concat(E),u["".concat(s.SAMPLER2D_FILTER).concat(l)]="".concat(A),o.glslVersion===a.GLSL1&&(0,c.isIntType)(v)&&(u["".concat(s.SAMPLER2D_CAST_INT).concat(l)]="1")}var O=Object.keys(t).map((function(e){return"_".concat(e,"_").concat(t[e])})).join(),I="".concat(e).concat(O).concat(i);if(this._programs[I])return this._programs[I];var P=this,R=P._uniforms,S=P._programs,N=P._programsKeyLookup,b=o.gl,L=o._errorCallback,U=o._getVertexShader(e,O,t,this.name);if(void 0!==U){var F=this._getFragmentShader(i,u);if(void 0!==F){var w=(0,c.initGLProgram)(b,U,F,this.name,L);if(void 0===w)return b.deleteShader(F),void L('Unable to init program "'.concat(I,'" for GPUProgram "').concat(this.name,'".'));b.useProgram(w);for(var x=Object.keys(R),G=(l=0,x.length);l<G;l++){var D=x[l],M=R[D],C=M.value;v=M.type,this._setProgramUniform(w,D,C,v)}return S[I]=w,N.set(w,I),w}L('Unable to init fragment shader "'.concat(i,'" for GPUProgram "').concat(this.name,'".'))}else L('Unable to init vertex shader "'.concat(e).concat(O,'" for GPUProgram "').concat(this.name,'".'))},e.prototype._setProgramUniform=function(e,t,r,n){var o,i=this._composer,c=this._uniforms,s=i.gl,l=i._errorCallback,p=i.glslVersion===a.GLSL3,_=null===(o=c[t])||void 0===o?void 0:o.location.get(e);if(void 0===_){var f=s.getUniformLocation(e,t);if(null===f)return void console.warn('Could not init uniform "'.concat(t,'" for program "').concat(this.name,'". Check that uniform is present in shader code, unused uniforms may be removed by compiler. Also check that uniform type in shader code matches type ').concat(n,". Error code: ").concat(s.getError(),"."));_=f,c[t]&&c[t].location.set(e,_);var d=s.getUniform(e,_),m=!1;if(n===a.BOOL_1D_UNIFORM||n===a.BOOL_2D_UNIFORM||n===a.BOOL_3D_UNIFORM||n===a.BOOL_4D_UNIFORM?(0,u.isBoolean)(d)||d.constructor===Array||(m=!0):n===a.FLOAT_1D_UNIFORM||n===a.FLOAT_2D_UNIFORM||n===a.FLOAT_3D_UNIFORM||n===a.FLOAT_4D_UNIFORM?(0,u.isFiniteNumber)(d)||d.constructor===Float32Array||(m=!0):n===a.INT_1D_UNIFORM||n===a.INT_2D_UNIFORM||n===a.INT_3D_UNIFORM||n===a.INT_4D_UNIFORM?(0,u.isInteger)(d)||d.constructor===Int32Array||(m=!0):n!==a.UINT_1D_UNIFORM&&n!==a.UINT_2D_UNIFORM&&n!==a.UINT_3D_UNIFORM&&n!==a.UINT_4D_UNIFORM||(p?(0,u.isNonNegativeInteger)(d)||d.constructor===Uint32Array||(m=!0):(0,u.isNonNegativeInteger)(d)||d.constructor===Int32Array||(m=!0)),m)return void l('Invalid uniform "'.concat(t,'" for program "').concat(this.name,'". Check that uniform type in shader code matches type ').concat(n,", gl.getUniform(program, location) returned type: ").concat(d.constructor.name,"."))}switch(n){case a.BOOL_1D_UNIFORM:s.uniform1i(_,r?1:0);break;case a.BOOL_2D_UNIFORM:s.uniform2i(_,r[0]?1:0,r[1]?1:0);break;case a.BOOL_3D_UNIFORM:s.uniform3i(_,r[0]?1:0,r[1]?1:0,r[2]?1:0);break;case a.BOOL_4D_UNIFORM:s.uniform4i(_,r[0]?1:0,r[1]?1:0,r[2]?1:0,r[3]?1:0);break;case a.FLOAT_1D_UNIFORM:s.uniform1f(_,r);break;case a.FLOAT_2D_UNIFORM:s.uniform2fv(_,r);break;case a.FLOAT_3D_UNIFORM:s.uniform3fv(_,r);break;case a.FLOAT_4D_UNIFORM:s.uniform4fv(_,r);break;case a.INT_1D_UNIFORM:s.uniform1i(_,r);break;case a.INT_2D_UNIFORM:s.uniform2iv(_,r);break;case a.INT_3D_UNIFORM:s.uniform3iv(_,r);break;case a.INT_4D_UNIFORM:s.uniform4iv(_,r);break;case a.UINT_1D_UNIFORM:p?s.uniform1ui(_,r):s.uniform1i(_,r);break;case a.UINT_2D_UNIFORM:p?s.uniform2uiv(_,r):s.uniform2iv(_,r);break;case a.UINT_3D_UNIFORM:p?s.uniform3uiv(_,r):s.uniform3iv(_,r);break;case a.UINT_4D_UNIFORM:p?s.uniform4uiv(_,r):s.uniform4iv(_,r);break;default:throw new Error("Unknown uniform type ".concat(n,' for GPUProgram "').concat(this.name,'".'))}},e.prototype._cacheUniformValue=function(e,t,r){var n=this._uniforms,o=n[e];if(!o)return n[e]={location:new WeakMap,value:(0,u.isArray)(t)?t.slice():t,type:r},!0;var i=o.value;if(o.value=(0,u.isArray)(t)?t.slice():t,(0,u.isArray)(t)){for(var a=0,c=t.length;a<c;a++)if(t[a]!==i[a])return!0;return!1}return t!==i},e.prototype.setUniform=function(e,t,r){var n,o=this,i=o._programs,a=o._uniforms,s=o._composer,l=o._samplerUniformsIndices,p=s.verboseLogging,_=s.gl;if((0,u.isArray)(t)&&t.length>4)throw new Error("Invalid uniform value: [".concat(t.join(", "),'] passed to GPUProgram "').concat(this.name,', uniforms must be of type number[] with length <= 4, number, or boolean."'));var f=null===(n=a[e])||void 0===n?void 0:n.type;if(r){var d=(0,c.uniformInternalTypeForValue)(t,r,e,this.name);if(void 0===f)f=d;else if(f!==d)throw new Error('Uniform "'.concat(e,'" for GPUProgram "').concat(this.name,'" cannot change from type ').concat(f," to type ").concat(d,"."))}if(void 0===f)throw new Error('Unknown type for uniform "'.concat(e,'", please pass in type to GPUProgram.setUniform(name, value, type) when initing a new uniform.'));if(this._cacheUniformValue(e,t,f)){var m=l.find((function(t){return t.name===e}));m&&(0,u.isInteger)(t)&&(m.inputIndex=t),p&&console.log('Setting uniform "'.concat(e,'" for program "').concat(this.name,'" to value ').concat(JSON.stringify(t),"."));for(var v=Object.keys(i),h=0,g=v.length;h<g;h++){var y=i[v[h]];_.useProgram(y),this._setProgramUniform(y,e,t,f)}if(this._childPrograms){h=0;for(var T=this._childPrograms.length;h<T;h++)this._childPrograms[h].setUniform(e,t,r)}}},e.prototype._setInternalFragmentUniforms=function(e,t){if(0!==t.length){if(!e)throw new Error("Must pass in valid WebGLProgram to GPUProgram._setInternalFragmentUniforms, got undefined.");var r=this._programsKeyLookup,n=this._samplerUniformsIndices;if(!r.get(e))throw new Error('Could not find valid programName for WebGLProgram in GPUProgram "'.concat(this.name,'".'));for(var o=new Array(Math.max(t.length,n.length)).fill(-1),i=0,c=n.length;i<c;i++){var u=n[i],l=u.inputIndex,p=u.shaderIndex;o[l]>=0?console.warn("Found > 1 sampler2D uniforms at texture index ".concat(l,' for GPUProgram "').concat(this.name,'".')):o[l]=p}i=0;for(var _=t.length;i<_;i++){var f=t[i].layer,d=f.width,m=f.height,v=o[i];if(!(v<0)){var h=f.filter,g=f.wrapX,y=f.wrapY,T=f._internalFilter,E=f._internalWrapX,A=f._internalWrapY,O=h!==T;if(O||g!==E||y!==A){var I=[.5/d,.5/m],P="".concat(s.SAMPLER2D_HALF_PX_UNIFORM).concat(v);if(this._cacheUniformValue(P,I,a.FLOAT_2D_UNIFORM)&&this._setProgramUniform(e,P,I,a.FLOAT_2D_UNIFORM),O){var R=[d,m],S="".concat(s.SAMPLER2D_DIMENSIONS_UNIFORM).concat(v);this._cacheUniformValue(S,R,a.FLOAT_2D_UNIFORM)&&this._setProgramUniform(e,S,R,a.FLOAT_2D_UNIFORM)}}}}}},e.prototype._setVertexUniform=function(e,t,r,n){if(!e)throw new Error("Must pass in valid WebGLProgram to GPUProgram._setVertexUniform, got undefined.");if(!this._programsKeyLookup.get(e))throw new Error('Could not find valid programName for WebGLProgram in GPUProgram "'.concat(this.name,'".'));var o=(0,c.uniformInternalTypeForValue)(r,n,t,this.name);this._setProgramUniform(e,t,r,o)},e.prototype.dispose=function(){var e=this,t=e._composer,r=e._fragmentShaders,n=e._programs,o=e._programsKeyLookup,i=t.gl;if(t.verboseLogging&&console.log('Deallocating GPUProgram "'.concat(this.name,'".')),!i)throw new Error("Must call dispose() on all GPUPrograms before calling dispose() on GPUComposer.");if(Object.values(n).forEach((function(e){e&&(i.deleteProgram(e),o.delete(e))})),Object.keys(n).forEach((function(e){delete n[e]})),Object.values(r).forEach((function(e){i.deleteShader(e)})),Object.keys(r).forEach((function(e){delete r[e]})),this._childPrograms){for(var a=0,c=this._childPrograms.length;a<c;a++)this._childPrograms[a].dispose();this._childPrograms.length}delete this._childPrograms,delete this._composer,delete this.name,delete this._fragmentShaderSource,delete this._compileTimeConstants,delete this._extensions,delete this._uniforms,delete this._programs,delete this._programsKeyLookup,delete this._fragmentShaders,delete this._samplerUniformsIndices},e}();t.GPUProgram=_;var f=function(e){function t(t,r,n){var o=e.call(this,t,r)||this,i=n.fragmentShaderSource;return o._fragmentShaderSource=i,o}return o(t,e),t}(_)},579:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.wrappedLineColorProgram=t.renderSignedAmplitudeProgram=t.renderAmplitudeProgram=t.zeroProgram=t.setColorProgram=t.setValueProgram=t.multiplyValueProgram=t.addValueProgram=t.addLayersProgram=t.copyProgram=void 0;var n=r(566),o=r(601),i=r(690),a=r(664);function c(e,t){var r=t.type,o=t.value,c=t.precision||"",s=(0,n.isArray)(o)?o.length:1,u=(0,i.glslTypeForType)(r,s),l=1===s?4:s,p=(0,i.glslTypeForType)(r,l),_=t.name||"setValue_".concat(u,"_w_length_").concat(s);return new a.GPUProgram(e,{name:_,fragmentShader:"\nuniform ".concat(c," ").concat(u," u_value;\nout ").concat(c," ").concat(p," out_result;\nvoid main() {\n\tout_result = ").concat(u!==p?p:"","(u_value);\n}"),uniforms:[{name:"u_value",value:o,type:(0,i.uniformTypeForType)(r,e.glslVersion)}]})}t.copyProgram=function(e,t){var r=t.type,n=t.precision||"",c=(0,i.glslTypeForType)(r,4),s=t.name||"copy_".concat((0,i.uniformTypeForType)(r,e.glslVersion),"_layer");return new a.GPUProgram(e,{name:s,fragmentShader:"\nin vec2 v_uv;\nuniform ".concat(n," ").concat((0,i.glslPrefixForType)(r),"sampler2D u_state;\nout ").concat(n," ").concat(c," out_result;\nvoid main() {\n\tout_result = texture(u_state, v_uv);\n}"),uniforms:[{name:"u_state",value:0,type:o.INT}]})},t.addLayersProgram=function(e,t){var r=t.type,n=t.numInputs||2,c=t.precision||"",s=t.components||"xyzw",u=(0,i.glslTypeForType)(r,s.length),l=new Array(n),p=t.name||"".concat(n,"-way_add_").concat((0,i.uniformTypeForType)(r,e.glslVersion),"_").concat(s);return new a.GPUProgram(e,{name:p,fragmentShader:"\nin vec2 v_uv;\n".concat(l.map((function(e,t){return"uniform ".concat(c," ").concat((0,i.glslPrefixForType)(r),"sampler2D u_state").concat(t,";")})).join("\n"),"\nout ").concat(c," ").concat(u," out_result;\nvoid main() {\n\tout_result = ").concat(l.map((function(e,t){return"texture(u_state".concat(t,", v_uv).").concat(s)})).join(" + "),";\n}"),uniforms:l.map((function(e,t){return{name:"u_state".concat(t),value:t,type:o.INT}}))})},t.addValueProgram=function(e,t){var r=t.type,c=t.value,s=t.precision||"",u=(0,n.isArray)(c)?c.length:1,l=(0,i.glslTypeForType)(r,u),p=1===u?4:u,_=(0,i.glslTypeForType)(r,p),f=(0,i.glslComponentSelectionForNumComponents)(p),d=t.name||"addValue_".concat(l,"_w_length_").concat(u);return new a.GPUProgram(e,{name:d,fragmentShader:"\nin vec2 v_uv;\nuniform ".concat(s," ").concat(l," u_value;\nuniform ").concat(s," ").concat((0,i.glslPrefixForType)(r),"sampler2D u_state;\nout ").concat(s," ").concat(_," out_result;\nvoid main() {\n\tout_result = ").concat(l!==_?_:"","(u_value) + texture(u_state, v_uv)").concat(f,";\n}"),uniforms:[{name:"u_state",value:0,type:o.INT},{name:"u_value",value:c,type:(0,i.uniformTypeForType)(r,e.glslVersion)}]})},t.multiplyValueProgram=function(e,t){var r=t.type,c=t.value,s=t.precision||"",u=(0,n.isArray)(c)?c.length:1,l=(0,i.glslTypeForType)(r,u),p=1===u?4:u,_=(0,i.glslTypeForType)(r,p),f=(0,i.glslComponentSelectionForNumComponents)(p),d=t.name||"addValue_".concat(l,"_w_length_").concat(u);return new a.GPUProgram(e,{name:d,fragmentShader:"\nin vec2 v_uv;\nuniform ".concat(s," ").concat(l," u_value;\nuniform ").concat(s," ").concat((0,i.glslPrefixForType)(r),"sampler2D u_state;\nout ").concat(s," ").concat(_," out_result;\nvoid main() {\n\tout_result = ").concat(l!==_?_:"","(u_value) * texture(u_state, v_uv)").concat(f,";\n}"),uniforms:[{name:"u_state",value:0,type:o.INT},{name:"u_value",value:c,type:(0,i.uniformTypeForType)(r,e.glslVersion)}]})},t.setValueProgram=c,t.setColorProgram=function(e,t){var r=t.type,n=t.precision||"",c=void 0===t.opacity?1:t.opacity,s=t.color||[0,0,0],u=t.name||"setColor",l=(0,i.glslTypeForType)(r,4);return new a.GPUProgram(e,{name:u,fragmentShader:"\nuniform ".concat(n," vec3 u_color;\nuniform ").concat(n," float u_opacity;\nout ").concat(n," ").concat(l," out_result;\nvoid main() {\n\tout_result = ").concat(l,"(u_color, u_opacity);\n}"),uniforms:[{name:"u_color",value:s,type:o.FLOAT},{name:"u_opacity",value:c,type:o.FLOAT}]})},t.zeroProgram=function(e,t){return c(e,{type:o.FLOAT,value:0,name:t.name})},t.renderAmplitudeProgram=function(e,t){var r=t.type,n=t.precision||"",c=t.components||"xyzw",s=c.length,u=(0,i.glslTypeForType)(r,s),l=(0,i.glslTypeForType)(o.FLOAT,s),p=(0,i.glslPrefixForType)(r),_=l===u,f=t.name||"renderAmplitude_".concat(u,"_w_").concat(s,"_components");return new a.GPUProgram(e,{name:f,fragmentShader:"\nin vec2 v_uv;\nuniform float u_opacity;\nuniform float u_scale;\nuniform vec3 u_color;\nuniform vec3 u_colorZero;\nuniform ".concat(n," ").concat(p,"sampler2D u_state;\nout vec4 out_result;\nvoid main() {\n\tfloat amplitude = u_scale * ").concat(1===s?"abs":"length","(").concat(_?"":l,"(texture(u_state, v_uv)").concat("xyzw"===c||"rgba"===c||"stpq"===c?"":".".concat(c),"));\n\tvec3 color = mix(u_colorZero, u_color, amplitude);\n\tout_result = vec4(color, u_opacity);\n}"),uniforms:[{name:"u_state",value:0,type:o.INT},{name:"u_scale",value:void 0!==t.scale?t.scale:1,type:o.FLOAT},{name:"u_opacity",value:void 0!==t.opacity?t.opacity:1,type:o.FLOAT},{name:"u_color",value:t.color||[1,1,1],type:o.FLOAT},{name:"u_colorZero",value:t.colorZero||[0,0,0],type:o.FLOAT}]})},t.renderSignedAmplitudeProgram=function(e,t){var r=t.type,n=t.precision||"",c=(0,i.glslTypeForType)(r,1),s=(0,i.glslPrefixForType)(r),u="float"===c,l=t.component||"x",p=t.name||"renderAmplitude_".concat(c,"_").concat(l);return new a.GPUProgram(e,{name:p,fragmentShader:"\nin vec2 v_uv;\nuniform float u_opacity;\nuniform float u_scale;\nuniform float u_bias;\nuniform vec3 u_colorNegative;\nuniform vec3 u_colorPositive;\nuniform vec3 u_colorZero;\nuniform ".concat(n," ").concat(s,"sampler2D u_state;\nout vec4 out_result;\nvoid main() {\n\tfloat signedAmplitude = u_scale * (").concat(u?"":"float","(texture(u_state, v_uv).").concat(l,") - u_bias);\n\tfloat amplitudeSign = sign(signedAmplitude);\n\tvec3 interpColor = mix(u_colorNegative, u_colorPositive, amplitudeSign / 2.0 + 0.5);\n\tvec3 color = mix(u_colorZero, interpColor, signedAmplitude * amplitudeSign);\n\tout_result = vec4(color, u_opacity);\n}"),uniforms:[{name:"u_state",value:0,type:o.INT},{name:"u_scale",value:void 0!==t.scale?t.scale:1,type:o.FLOAT},{name:"u_bias",value:t.bias||0,type:o.FLOAT},{name:"u_opacity",value:void 0!==t.opacity?t.opacity:1,type:o.FLOAT},{name:"u_colorNegative",value:t.colorNegative||[0,0,1],type:o.FLOAT},{name:"u_colorPositive",value:t.colorPositive||[1,0,0],type:o.FLOAT},{name:"u_colorZero",value:t.colorZero||[1,1,1],type:o.FLOAT}]})},t.wrappedLineColorProgram=function(e){return new a.GPUProgram(e,{name:"wrappedLineColor",fragmentShader:"\nin vec2 v_lineWrapping;\nuniform vec4 u_value;\nout vec4 out_result;\nvoid main() {\n\t// Check if this line has wrapped.\n\tif ((v_lineWrapping.x != 0.0 && v_lineWrapping.x != 1.0) || (v_lineWrapping.y != 0.0 && v_lineWrapping.y != 1.0)) {\n\t\t// Render nothing.\n\t\tdiscard;\n\t\treturn;\n\t}\n\tout_result = vec4(u_value);\n}"})}},404:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Vector4=void 0;var r=function(){function e(e,t,r,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=1),this.x=e,this.y=t,this.z=r,this.w=n}return Object.defineProperty(e.prototype,"width",{get:function(){return this.z},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.w},enumerable:!1,configurable:!0}),e.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e}();t.Vector4=r},707:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkRequiredKeys=t.checkValidKeys=t.isNumberOfType=t.isValidClearValue=t.isValidImageType=t.isValidImageFormat=t.isValidWrap=t.isValidFilter=t.isValidDataType=void 0;var n=r(566),o=r(601);function i(e,t){switch(t){case o.HALF_FLOAT:case o.FLOAT:return(0,n.isFiniteNumber)(e);case o.BYTE:return!(e<-128)&&!(e>127)&&(0,n.isInteger)(e);case o.SHORT:return!(e<-32768)&&!(e>32767)&&(0,n.isInteger)(e);case o.INT:return!(e<-2147483648)&&!(e>2147483647)&&(0,n.isInteger)(e);case o.UNSIGNED_BYTE:return!(e>255)&&(0,n.isNonNegativeInteger)(e);case o.UNSIGNED_SHORT:return!(e>65535)&&(0,n.isNonNegativeInteger)(e);case o.UNSIGNED_INT:return!(e>4294967295)&&(0,n.isNonNegativeInteger)(e);default:throw new Error("Unknown type ".concat(t))}}t.isValidDataType=function(e){return o.validDataTypes.indexOf(e)>-1},t.isValidFilter=function(e){return o.validFilters.indexOf(e)>-1},t.isValidWrap=function(e){return o.validWraps.indexOf(e)>-1},t.isValidImageFormat=function(e){return o.validImageFormats.indexOf(e)>-1},t.isValidImageType=function(e){return o.validImageTypes.indexOf(e)>-1},t.isValidClearValue=function(e,t,r){if((0,n.isArray)(e)){if(e.length!==t)return!1;for(var o=0;o<e.length;o++)if(!i(e[o],r))return!1}else if(!i(e,r))return!1;return!0},t.isNumberOfType=i,t.checkValidKeys=function(e,t,r,n){e.forEach((function(e){t.indexOf(e)<0&&console.warn('Invalid params key "'.concat(e,'" passed to ').concat(r).concat(n?' with name "'.concat(n,'"'):"",".  Valid keys are ").concat(JSON.stringify(t),"."))}))},t.checkRequiredKeys=function(e,t,r,n){t.forEach((function(t){if(e.indexOf(t)<0)throw new Error('Required params key "'.concat(t,'" was not passed to ').concat(r).concat(n?' with name "'.concat(n,'"'):"","."))}))}},601:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LAYER_POINTS_PROGRAM_NAME=t.SEGMENT_PROGRAM_NAME=t.DEFAULT_PROGRAM_NAME=t.BOOL_4D_UNIFORM=t.BOOL_3D_UNIFORM=t.BOOL_2D_UNIFORM=t.BOOL_1D_UNIFORM=t.UINT_4D_UNIFORM=t.UINT_3D_UNIFORM=t.UINT_2D_UNIFORM=t.UINT_1D_UNIFORM=t.INT_4D_UNIFORM=t.INT_3D_UNIFORM=t.INT_2D_UNIFORM=t.INT_1D_UNIFORM=t.FLOAT_4D_UNIFORM=t.FLOAT_3D_UNIFORM=t.FLOAT_2D_UNIFORM=t.FLOAT_1D_UNIFORM=t.PRECISION_HIGH_P=t.PRECISION_MEDIUM_P=t.PRECISION_LOW_P=t.EXPERIMENTAL_WEBGL2=t.EXPERIMENTAL_WEBGL=t.WEBGL1=t.WEBGL2=t.GLSL1=t.GLSL3=t.validImageTypes=t.validImageFormats=t.RGBA=t.RGB=t.validWraps=t.validFilters=t.validDataTypes=t.validArrayTypes=t.REPEAT=t.CLAMP_TO_EDGE=t.LINEAR=t.NEAREST=t.UINT=t.BOOL=t.INT=t.UNSIGNED_INT=t.SHORT=t.UNSIGNED_SHORT=t.BYTE=t.UNSIGNED_BYTE=t.FLOAT=t.HALF_FLOAT=void 0,t.BOUNDARY_RIGHT=t.BOUNDARY_LEFT=t.BOUNDARY_BOTTOM=t.BOUNDARY_TOP=t.GPUIO_FLOAT_PRECISION=t.GPUIO_INT_PRECISION=t.MAX_FLOAT_INT=t.MIN_FLOAT_INT=t.MAX_HALF_FLOAT_INT=t.MIN_HALF_FLOAT_INT=t.MAX_INT=t.MIN_INT=t.MAX_UNSIGNED_INT=t.MIN_UNSIGNED_INT=t.MAX_SHORT=t.MIN_SHORT=t.MAX_UNSIGNED_SHORT=t.MIN_UNSIGNED_SHORT=t.MAX_BYTE=t.MIN_BYTE=t.MAX_UNSIGNED_BYTE=t.MIN_UNSIGNED_BYTE=t.DEFAULT_CIRCLE_NUM_SEGMENTS=t.DEFAULT_ERROR_CALLBACK=t.GPUIO_VS_POSITION_W_ACCUM=t.GPUIO_VS_NORMAL_ATTRIBUTE=t.GPUIO_VS_UV_ATTRIBUTE=t.GPUIO_VS_INDEXED_POSITIONS=t.GPUIO_VS_WRAP_Y=t.GPUIO_VS_WRAP_X=t.LAYER_MESH_PROGRAM_NAME=t.LAYER_VECTOR_FIELD_PROGRAM_NAME=t.LAYER_LINES_PROGRAM_NAME=void 0,t.HALF_FLOAT="HALF_FLOAT",t.FLOAT="FLOAT",t.UNSIGNED_BYTE="UNSIGNED_BYTE",t.BYTE="BYTE",t.UNSIGNED_SHORT="UNSIGNED_SHORT",t.SHORT="SHORT",t.UNSIGNED_INT="UNSIGNED_INT",t.INT="INT",t.BOOL="BOOL",t.UINT="UINT",t.NEAREST="NEAREST",t.LINEAR="LINEAR",t.CLAMP_TO_EDGE="CLAMP_TO_EDGE",t.REPEAT="REPEAT",t.validArrayTypes=[Float32Array,Uint8Array,Int8Array,Uint16Array,Int16Array,Uint32Array,Int32Array,Array],t.validDataTypes=[t.HALF_FLOAT,t.FLOAT,t.UNSIGNED_BYTE,t.BYTE,t.UNSIGNED_SHORT,t.SHORT,t.UNSIGNED_INT,t.INT],t.validFilters=[t.NEAREST,t.LINEAR],t.validWraps=[t.CLAMP_TO_EDGE,t.REPEAT],t.RGB="RGB",t.RGBA="RGBA",t.validImageFormats=[t.RGB,t.RGBA],t.validImageTypes=[t.UNSIGNED_BYTE,t.FLOAT,t.HALF_FLOAT],t.GLSL3="300 es",t.GLSL1="100",t.WEBGL2="webgl2",t.WEBGL1="webgl",t.EXPERIMENTAL_WEBGL="experimental-webgl",t.EXPERIMENTAL_WEBGL2="experimental-webgl2",t.PRECISION_LOW_P="lowp",t.PRECISION_MEDIUM_P="mediump",t.PRECISION_HIGH_P="highp",t.FLOAT_1D_UNIFORM="FLOAT_1D_UNIFORM",t.FLOAT_2D_UNIFORM="FLOAT_2D_UNIFORM",t.FLOAT_3D_UNIFORM="FLOAT_3D_UNIFORM",t.FLOAT_4D_UNIFORM="FLOAT_4D_UNIFORM",t.INT_1D_UNIFORM="INT_1D_UNIFORM",t.INT_2D_UNIFORM="INT_2D_UNIFORM",t.INT_3D_UNIFORM="INT_3D_UNIFORM",t.INT_4D_UNIFORM="INT_4D_UNIFORM",t.UINT_1D_UNIFORM="UINT_1D_UNIFORM",t.UINT_2D_UNIFORM="UINT_2D_UNIFORM",t.UINT_3D_UNIFORM="UINT_3D_UNIFORM",t.UINT_4D_UNIFORM="UINT_4D_UNIFORM",t.BOOL_1D_UNIFORM="BOOL_1D_UNIFORM",t.BOOL_2D_UNIFORM="BOOL_2D_UNIFORM",t.BOOL_3D_UNIFORM="BOOL_3D_UNIFORM",t.BOOL_4D_UNIFORM="BOOL_4D_UNIFORM",t.DEFAULT_PROGRAM_NAME="DEFAULT",t.SEGMENT_PROGRAM_NAME="SEGMENT",t.LAYER_POINTS_PROGRAM_NAME="LAYER_POINTS",t.LAYER_LINES_PROGRAM_NAME="LAYER_LINES",t.LAYER_VECTOR_FIELD_PROGRAM_NAME="LAYER_VECTOR_FIELD",t.LAYER_MESH_PROGRAM_NAME="LAYER_MESH",t.GPUIO_VS_WRAP_X="GPUIO_VS_WRAP_X",t.GPUIO_VS_WRAP_Y="GPUIO_VS_WRAP_Y",t.GPUIO_VS_INDEXED_POSITIONS="GPUIO_VS_INDEXED_POSITIONS",t.GPUIO_VS_UV_ATTRIBUTE="GPUIO_VS_UV_ATTRIBUTE",t.GPUIO_VS_NORMAL_ATTRIBUTE="GPUIO_VS_NORMAL_ATTRIBUTE",t.GPUIO_VS_POSITION_W_ACCUM="GPUIO_VS_POSITION_W_ACCUM",t.DEFAULT_ERROR_CALLBACK=function(e){throw new Error(e)},t.DEFAULT_CIRCLE_NUM_SEGMENTS=18,t.MIN_UNSIGNED_BYTE=0,t.MAX_UNSIGNED_BYTE=Math.pow(2,8)-1,t.MIN_BYTE=-Math.pow(2,7),t.MAX_BYTE=Math.pow(2,7)-1,t.MIN_UNSIGNED_SHORT=0,t.MAX_UNSIGNED_SHORT=Math.pow(2,16)-1,t.MIN_SHORT=-Math.pow(2,15),t.MAX_SHORT=Math.pow(2,15)-1,t.MIN_UNSIGNED_INT=0,t.MAX_UNSIGNED_INT=Math.pow(2,32)-1,t.MIN_INT=-Math.pow(2,31),t.MAX_INT=Math.pow(2,31)-1,t.MIN_HALF_FLOAT_INT=-2048,t.MAX_HALF_FLOAT_INT=2048,t.MIN_FLOAT_INT=-16777216,t.MAX_FLOAT_INT=16777216,t.GPUIO_INT_PRECISION="GPUIO_INT_PRECISION",t.GPUIO_FLOAT_PRECISION="GPUIO_FLOAT_PRECISION",t.BOUNDARY_TOP="BOUNDARY_TOP",t.BOUNDARY_BOTTOM="BOUNDARY_BOTTOM",t.BOUNDARY_LEFT="BOUNDARY_LEFT",t.BOUNDARY_RIGHT="BOUNDARY_RIGHT"},690:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.glslComponentSelectionForNumComponents=t.glslPrefixForType=t.glslTypeForType=t.arrayConstructorForType=t.uniformTypeForType=t.intForPrecision=void 0;var n=r(601);t.intForPrecision=function(e){if(e===n.PRECISION_HIGH_P)return 2;if(e===n.PRECISION_MEDIUM_P)return 1;if(e===n.PRECISION_LOW_P)return 0;throw new Error("Unknown shader precision value: ".concat(JSON.stringify(e),"."))},t.uniformTypeForType=function(e,t){switch(e){case n.HALF_FLOAT:case n.FLOAT:return n.FLOAT;case n.UNSIGNED_BYTE:case n.UNSIGNED_SHORT:case n.UNSIGNED_INT:return t===n.GLSL1?n.INT:n.UINT;case n.BYTE:case n.SHORT:case n.INT:return n.INT;default:throw new Error("Invalid type: ".concat(e," passed to glslKeyForType."))}},t.arrayConstructorForType=function(e,t){switch(void 0===t&&(t=!1),e){case n.HALF_FLOAT:return t?Float32Array:Uint16Array;case n.FLOAT:return Float32Array;case n.UNSIGNED_BYTE:return Uint8Array;case n.BYTE:return Int8Array;case n.UNSIGNED_SHORT:return Uint16Array;case n.SHORT:return Int16Array;case n.UNSIGNED_INT:return Uint32Array;case n.INT:return Int32Array;default:throw new Error('Unsupported type: "'.concat(e,'".'))}},t.glslTypeForType=function(e,t){switch(e){case n.HALF_FLOAT:case n.FLOAT:return 1===t?"float":"vec".concat(t);case n.UNSIGNED_BYTE:case n.UNSIGNED_SHORT:case n.UNSIGNED_INT:return 1===t?"uint":"uvec".concat(t);case n.BYTE:case n.SHORT:case n.INT:return 1===t?"int":"ivec".concat(t)}throw new Error("Invalid type: ".concat(e," passed to glslTypeForType."))},t.glslPrefixForType=function(e){switch(e){case n.HALF_FLOAT:case n.FLOAT:return"";case n.UNSIGNED_BYTE:case n.UNSIGNED_SHORT:case n.UNSIGNED_INT:return"u";case n.BYTE:case n.SHORT:case n.INT:return"i"}throw new Error("Invalid type: ".concat(e," passed to glslPrefixForType."))},t.glslComponentSelectionForNumComponents=function(e){switch(e){case 1:return".x";case 2:return".xy";case 3:return".xyz";case 4:return""}throw new Error("Invalid numComponents: ".concat(e," passed to glslComponentSelectionForNumComponents."))}},581:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getExtension=t.OES_STANDARD_DERIVATIVES=t.OES_ELEMENT_INDEX_UINT=t.OES_VERTEX_ARRAY_OBJECT=t.EXT_COLOR_BUFFER_HALF_FLOAT=t.EXT_COLOR_BUFFER_FLOAT=t.WEBGL_DEPTH_TEXTURE=t.OES_TEXTURE_HAlF_FLOAT_LINEAR=t.OES_TEXTURE_FLOAT_LINEAR=t.OES_TEXTURE_HALF_FLOAT=t.OES_TEXTURE_FLOAT=void 0,t.OES_TEXTURE_FLOAT="OES_texture_float",t.OES_TEXTURE_HALF_FLOAT="OES_texture_half_float",t.OES_TEXTURE_FLOAT_LINEAR="OES_texture_float_linear",t.OES_TEXTURE_HAlF_FLOAT_LINEAR="OES_texture_half_float_linear",t.WEBGL_DEPTH_TEXTURE="WEBGL_depth_texture",t.EXT_COLOR_BUFFER_FLOAT="EXT_color_buffer_float",t.EXT_COLOR_BUFFER_HALF_FLOAT="EXT_color_buffer_half_float",t.OES_VERTEX_ARRAY_OBJECT="OES_vertex_array_object",t.OES_ELEMENT_INDEX_UINT="OES_element_index_uint",t.OES_STANDARD_DERIVATIVES="OES_standard_derivatives",t.getExtension=function(e,t,r){if(void 0===r&&(r=!1),void 0!==e._extensions[t])return e._extensions[t];var n,o=e.gl,i=e._errorCallback,a=e._extensions;e.verboseLogging;try{n=o.getExtension(t)}catch(e){}return n?(a[t]=n,e.verboseLogging&&console.log("Loaded extension: ".concat(t,"."))):(a[t]=!1,e.verboseLogging&&console.log("Unsupported ".concat(r?"optional ":"","extension: ").concat(t,"."))),n||r||i("Required extension unsupported by this device / browser: ".concat(t,".")),n}},798:function(e,t){var r=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.disposeFramebuffers=t.bindFrameBuffer=void 0;var n=new WeakMap,o=new WeakMap;t.bindFrameBuffer=function(e,t,i,a){var c=e.gl,s=a?r([i],a,!0):i,u=n.get(s);if(!u){if(u=function(e,t,r,n){var o=e.gl,i=e._errorCallback,a=e.isWebGL2,c=o.createFramebuffer();if(c){if(o.bindFramebuffer(o.FRAMEBUFFER,c),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,r,0),n){if(!a)throw new Error("WebGL1 does not support drawing to multiple outputs.");if(n.length>15)throw new Error("Can't draw to more than 16 outputs.");for(var s=0,u=n.length;s<u;s++)o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0+s+1,o.TEXTURE_2D,n[s],0)}var l=o.checkFramebufferStatus(o.FRAMEBUFFER);return l!==o.FRAMEBUFFER_COMPLETE&&i('Invalid status for framebuffer for GPULayer "'.concat(t.name,'": ').concat(l,".")),c}i('Could not init framebuffer for GPULayer "'.concat(t.name,'": ').concat(o.getError(),"."))}(e,t,i,a),!u)return;n.set(s,u);var l=o.get(i)||[];if(l.push(u),o.set(i,l),a)for(var p=0,_=a.length;p<_;p++){var f=a[p],d=o.get(f)||[];d.push(u),o.set(f,d)}}c.bindFramebuffer(c.FRAMEBUFFER,u)},t.disposeFramebuffers=function(e,t){e.bindFramebuffer(e.FRAMEBUFFER,null);var r=o.get(t);if(r)for(var n=0,i=r.length;n<i;n++)e.deleteFramebuffer(r[n]);o.delete(t)}},724:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PRECISION_SOURCE=void 0;var n=r(601),o=r(690);t.PRECISION_SOURCE="\n#if (".concat(n.GPUIO_INT_PRECISION," == ").concat((0,o.intForPrecision)(n.PRECISION_LOW_P),")\n\tprecision lowp int;\n\t#if (__VERSION__ == 300)\n\t\tprecision lowp isampler2D;\n\t\tprecision lowp usampler2D;\n\t#endif\n#elif (").concat(n.GPUIO_INT_PRECISION," == ").concat((0,o.intForPrecision)(n.PRECISION_MEDIUM_P),")\n\tprecision mediump int;\n\t#if (__VERSION__ == 300)\n\t\tprecision mediump isampler2D;\n\t\tprecision mediump usampler2D;\n\t#endif\n#else \n\t#ifdef GL_FRAGMENT_PRECISION_HIGH\n\t\tprecision highp int;\n\t\t#if (__VERSION__ == 300)\n\t\t\tprecision highp isampler2D;\n\t\t\tprecision highp usampler2D;\n\t\t#endif\n\t#else\n\t\tprecision mediump int;\n\t\t#if (__VERSION__ == 300)\n\t\t\tprecision mediump isampler2D;\n\t\t\tprecision mediump usampler2D;\n\t\t#endif\n\t#endif\n#endif\n#if (").concat(n.GPUIO_FLOAT_PRECISION," == ").concat((0,o.intForPrecision)(n.PRECISION_LOW_P),")\n\tprecision lowp float;\n\tprecision lowp sampler2D;\n#elif (").concat(n.GPUIO_FLOAT_PRECISION," == ").concat((0,o.intForPrecision)(n.PRECISION_MEDIUM_P),")\n\tprecision mediump float;\n\tprecision mediump sampler2D;\n#else\n\t#ifdef GL_FRAGMENT_PRECISION_HIGH\n\t\tprecision highp float;\n\t\tprecision highp sampler2D;\n\t#else\n\t\tprecision mediump float;\n\t\tprecision mediump sampler2D;\n\t#endif\n#endif\n")},651:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_VERT_SHADER_SOURCE=void 0;var n=r(601);t.DEFAULT_VERT_SHADER_SOURCE="\nin vec2 a_gpuio_position;\n#ifdef ".concat(n.GPUIO_VS_UV_ATTRIBUTE,"\n\tin vec2 a_gpuio_uv;\n#endif\n#ifdef ").concat(n.GPUIO_VS_NORMAL_ATTRIBUTE,"\n\tin vec2 a_gpuio_normal;\n#endif\n\nuniform vec2 u_gpuio_scale;\nuniform vec2 u_gpuio_translation;\n\nout vec2 v_uv;\nout vec2 v_uv_local;\n#ifdef ").concat(n.GPUIO_VS_NORMAL_ATTRIBUTE,"\n\tout vec2 v_normal;\n#endif\n\nvoid main() {\n\t// Optional varyings.\n\t#ifdef ").concat(n.GPUIO_VS_UV_ATTRIBUTE,"\n\t\tv_uv_local = a_gpuio_uv;\n\t#else\n\t\tv_uv_local = 0.5 * (a_gpuio_position + 1.0);\n\t#endif\n\t#ifdef ").concat(n.GPUIO_VS_NORMAL_ATTRIBUTE,"\n\t\tv_normal = a_gpuio_normal;\n\t#endif\n\n\t// Apply transformations.\n\tvec2 position = u_gpuio_scale * a_gpuio_position + u_gpuio_translation;\n\n\t// Calculate a global uv for the viewport.\n\tv_uv = 0.5 * (position + 1.0);\n\n\t// Calculate vertex position.\n\tgl_Position = vec4(position, 0, 1);\n}")},567:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LAYER_LINES_VERTEX_SHADER_SOURCE=void 0;var n=r(601),o=r(324);t.LAYER_LINES_VERTEX_SHADER_SOURCE="\n".concat(o.VERTEX_SHADER_HELPERS_SOURCE,"\n\n#if (__VERSION__ != 300 || ").concat(n.GPUIO_VS_INDEXED_POSITIONS," == 1)\n\t// Cannot use int vertex attributes.\n\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n\tin float a_gpuio_index;\n#endif\n\nuniform sampler2D u_gpuio_positions; // Texture lookup with position data.\nuniform vec2 u_gpuio_positionsDimensions;\nuniform vec2 u_gpuio_scale;\n\nout vec2 v_uv;\nout vec2 v_lineWrapping; // Use this to test if line is only half wrapped and should not be rendered.\nflat out int v_index;\n\nvoid main() {\n\t// Calculate a uv based on the point's index attribute.\n\t#if (__VERSION__ != 300 || ").concat(n.GPUIO_VS_INDEXED_POSITIONS," == 1)\n\t\tvec2 positionUV = uvFromIndex(a_gpuio_index, u_gpuio_positionsDimensions);\n\t\tv_index = int(a_gpuio_index);\n\t#else\n\t\tvec2 positionUV = uvFromIndex(gl_VertexID, u_gpuio_positionsDimensions);\n\t\tv_index = gl_VertexID;\n\t#endif\n\n\t// Calculate a global uv for the viewport.\n\t// Lookup vertex position and scale to [0, 1] range.\n\t#ifdef ").concat(n.GPUIO_VS_POSITION_W_ACCUM,"\n\t\t// We have packed a 2D displacement with the position.\n\t\tvec4 positionData = texture(u_gpuio_positions, positionUV);\n\t\t// position = first two components plus last two components (optional accumulation buffer).\n\t\tv_uv = (positionData.rg + positionData.ba) * u_gpuio_scale;\n\t#else\n\t\tv_uv = texture(u_gpuio_positions, positionUV).rg  * u_gpuio_scale;\n\t#endif\n\n\t// Wrap if needed.\n\tv_lineWrapping = vec2(0.0);\n\t#ifdef ").concat(n.GPUIO_VS_WRAP_X,"\n\t\tv_lineWrapping.x = max(step(1.0, v_uv.x), step(v_uv.x, 0.0));\n\t\tv_ux.x = fract(v_uv.x + 1.0);\n\t#endif\n\t#ifdef ").concat(n.GPUIO_VS_WRAP_Y,"\n\t\tv_lineWrapping.y = max(step(1.0, v_uv.y), step(v_uv.y, 0.0));\n\t\tv_ux.y = fract(v_uv.y + 1.0);\n\t#endif\n\n\t// Calculate position in [-1, 1] range.\n\tvec2 position = v_uv * 2.0 - 1.0;\n\n\tgl_Position = vec4(position, 0, 1);\n}")},380:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LAYER_MESH_VERTEX_SHADER_SOURCE=void 0;var n=r(601),o=r(324);t.LAYER_MESH_VERTEX_SHADER_SOURCE="\n".concat(o.VERTEX_SHADER_HELPERS_SOURCE,"\n\n#if (__VERSION__ != 300)\n\t// Cannot use int vertex attributes.\n\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n\tin float a_gpuio_index;\n#endif\n\nuniform sampler2D u_gpuio_positions; // Texture lookup with position data.\nuniform vec2 u_gpuio_positionsDimensions;\nuniform vec2 u_gpuio_scale;\n\nout vec2 v_uv;\nout vec2 v_uv_position;\nout vec2 v_position;\nflat out int v_index;\n\nvoid main() {\n\t// Calculate a uv based on the point's index attribute.\n\t#if (__VERSION__ == 300)\n\t\tv_uv_position = uvFromIndex(gl_VertexID, u_gpuio_positionsDimensions);\n\t\tv_index = gl_VertexID;\n\t#else\n\t\tv_uv_position = uvFromIndex(a_gpuio_index, u_gpuio_positionsDimensions);\n\t\tv_index = int(a_gpuio_index);\n\t#endif\n\n\t// Calculate a global uv for the viewport.\n\t// Lookup vertex position and scale to [0, 1] range.\n\t#ifdef ").concat(n.GPUIO_VS_POSITION_W_ACCUM,"\n\t\t// We have packed a 2D displacement with the position.\n\t\tvec4 positionData = texture(u_gpuio_positions, v_uv_position);\n\t\t// position = first two components plus last two components (optional accumulation buffer).\n\t\tv_position = positionData.rg + positionData.ba;\n\t\tv_uv = v_position * u_gpuio_scale;\n\t#else\n\t\tv_position = texture(u_gpuio_positions, v_uv_position).rg;\n\t\tv_uv = v_position * u_gpuio_scale;\n\t#endif\n\n\t// Calculate position in [-1, 1] range.\n\tvec2 position = v_uv * 2.0 - 1.0;\n\n\tgl_Position = vec4(position, 0, 1);\n}")},929:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LAYER_POINTS_VERTEX_SHADER_SOURCE=void 0;var n=r(601),o=r(324);t.LAYER_POINTS_VERTEX_SHADER_SOURCE="\n".concat(o.VERTEX_SHADER_HELPERS_SOURCE,"\n\n#if (__VERSION__ != 300)\n\t// Cannot use int vertex attributes.\n\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n\tin float a_gpuio_index;\n#endif\n\nuniform sampler2D u_gpuio_positions; // Texture lookup with position data.\nuniform vec2 u_gpuio_positionsDimensions;\nuniform vec2 u_gpuio_scale;\nuniform float u_gpuio_pointSize;\n\nout vec2 v_uv;\nout vec2 v_uv_position;\nout vec2 v_position;\nflat out int v_index;\n\nvoid main() {\n\t// Calculate a uv based on the point's index attribute.\n\t#if (__VERSION__ == 300)\n\t\tv_uv_position = uvFromIndex(gl_VertexID, u_gpuio_positionsDimensions);\n\t\tv_index = gl_VertexID;\n\t#else\n\t\tv_uv_position = uvFromIndex(a_gpuio_index, u_gpuio_positionsDimensions);\n\t\tv_index = int(a_gpuio_index);\n\t#endif\n\n\t// Calculate a global uv for the viewport.\n\t// Lookup vertex position and scale to [0, 1] range.\n\t#ifdef ").concat(n.GPUIO_VS_POSITION_W_ACCUM,"\n\t\t// We have packed a 2D displacement with the position.\n\t\tvec4 positionData = texture(u_gpuio_positions, v_uv_position);\n\t\t// position = first two components plus last two components (optional accumulation buffer).\n\t\tv_position = positionData.rg + positionData.ba;\n\t\tv_uv = v_position * u_gpuio_scale;\n\t#else\n\t\tv_position = texture(u_gpuio_positions, v_uv_position).rg;\n\t\tv_uv = v_position * u_gpuio_scale;\n\t#endif\n\n\t// Wrap if needed.\n\t#ifdef ").concat(n.GPUIO_VS_WRAP_X,"\n\t\tv_uv.x = fract(v_uv.x + ceil(abs(v_uv.x)));\n\t#endif\n\t#ifdef ").concat(n.GPUIO_VS_WRAP_Y,"\n\t\tv_uv.y = fract(v_uv.y + ceil(abs(v_uv.y)));\n\t#endif\n\n\t// Calculate position in [-1, 1] range.\n\tvec2 position = v_uv * 2.0 - 1.0;\n\n\tgl_PointSize = u_gpuio_pointSize;\n\tgl_Position = vec4(position, 0, 1);\n}")},634:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LAYER_VECTOR_FIELD_VERTEX_SHADER_SOURCE=void 0;var n=r(324);t.LAYER_VECTOR_FIELD_VERTEX_SHADER_SOURCE="\n".concat(n.VERTEX_SHADER_HELPERS_SOURCE,"\n\n#if (__VERSION__ != 300)\n\t// Cannot use int vertex attributes.\n\t// https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/vertexAttribPointer\n\tin float a_gpuio_index;\n#endif\n\nuniform sampler2D u_gpuio_vectors; // Texture lookup with vector data.\nuniform vec2 u_gpuio_dimensions;\nuniform vec2 u_gpuio_scale;\n\nout vec2 v_uv;\nflat out int v_index;\n\nvoid main() {\n\t#if (__VERSION__ == 300)\n\t\t// Divide index by 2.\n\t\tint index = gl_VertexID / 2;\n\t\tv_index = index;\n\t#else\n\t\t// Divide index by 2.\n\t\tfloat index = floor((a_gpuio_index + 0.5) / 2.0);\n\t\tv_index = int(index);\n\t#endif\n\n\t// Calculate a uv based on the vertex index attribute.\n\tv_uv = uvFromIndex(index, u_gpuio_dimensions);\n\t#if (__VERSION__ == 300)\n\t\t// Add vector displacement if needed.\n\t\tv_uv += float(gl_VertexID - 2 * index) * texture(u_gpuio_vectors, v_uv).xy * u_gpuio_scale;\n\t#else\n\t\t// Add vector displacement if needed.\n\t\tv_uv += (a_gpuio_index - 2.0 * index) * texture(u_gpuio_vectors, v_uv).xy * u_gpuio_scale;\n\t#endif\n\n\n\t// Calculate position in [-1, 1] range.\n\tvec2 position = v_uv * 2.0 - 1.0;\n\n\tgl_Position = vec4(position, 0, 1);\n}")},946:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SEGMENT_VERTEX_SHADER_SOURCE=void 0,t.SEGMENT_VERTEX_SHADER_SOURCE="\nin vec2 a_gpuio_position;\n\nuniform float u_gpuio_halfThickness;\nuniform vec2 u_gpuio_scale;\nuniform float u_gpuio_length;\nuniform float u_gpuio_rotation;\nuniform vec2 u_gpuio_translation;\n\nout vec2 v_uv_local;\nout vec2 v_uv;\n\nmat2 rotate2d(float _angle){\n\treturn mat2(cos(_angle), -sin(_angle), sin(_angle), cos(_angle));\n}\n\nvoid main() {\n\t// Calculate UV coordinates of current rendered object.\n\tv_uv_local = 0.5 * (a_gpuio_position + 1.0);\n\n\tvec2 position = a_gpuio_position;\n\t// Apply thickness / radius.\n\tposition *= u_gpuio_halfThickness;\n\t// Stretch center of shape to form a round-capped line segment.\n\tfloat signX = sign(position.x);\n\tposition.x += signX * u_gpuio_length / 2.0;\n\tv_uv_local.x = (signX + 1.0) / 2.0;// Set entire cap uv.x to 1 or 0.\n\t// Apply transformations.\n\tposition = u_gpuio_scale * (rotate2d(-u_gpuio_rotation) * position) + u_gpuio_translation;\n\n\t// Calculate a global uv for the viewport.\n\tv_uv = 0.5 * (position + 1.0);\n\n\t// Calculate vertex position.\n\tgl_Position = vec4(position, 0, 1);\n}"},324:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VERTEX_SHADER_HELPERS_SOURCE=void 0,t.VERTEX_SHADER_HELPERS_SOURCE='\n/**\n * Create UV coordinates from a 1D index for data stored in a texture of size "dimensions".\n */\nvec2 uvFromIndex(const float index, const vec2 dimensions) {\n\tfloat y = floor((index + 0.5) / dimensions.x);\n\tfloat x = floor(index - y * dimensions.x + 0.5);\n\treturn vec2(x + 0.5, y + 0.5) / dimensions;\n}\nvec2 uvFromIndex(const int index, const vec2 dimensions) {\n    int width = int(dimensions.x);\n    int y = index / width;\n\tint x = index - y * width;\n    return vec2(float(x) + 0.5, float(y) + 0.5) / dimensions;\n}\nvec2 uvFromIndex(const float index, const ivec2 dimensions) {\n\tfloat width = float(dimensions.x);\n    float y = floor((index + 0.5) / width);\n\tfloat x = floor(index - y * width + 0.5);\n    return vec2(x + 0.5, y + 0.5) / vec2(dimensions);\n}\nvec2 uvFromIndex(const int index, const ivec2 dimensions) {\n    int y = index / dimensions.x;\n\tint x = index - y * dimensions.x;\n    return vec2(float(x) + 0.5, float(y) + 0.5) / vec2(dimensions);\n}'},607:function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t._testing=t.zeroProgram=t.setColorProgram=t.setValueProgram=t.renderSignedAmplitudeProgram=t.renderAmplitudeProgram=t.multiplyValueProgram=t.addValueProgram=t.addLayersProgram=t.copyProgram=t.getFragmentShaderMediumpPrecision=t.getVertexShaderMediumpPrecision=t.isHighpSupportedInFragmentShader=t.isHighpSupportedInVertexShader=t.isWebGL2Supported=t.isWebGL2=t.GPUIndexBuffer=t.GPUProgram=t.GPULayer=t.GPUComposer=void 0;var a=r(593),c=r(484);Object.defineProperty(t,"GPUComposer",{enumerable:!0,get:function(){return c.GPUComposer}});var s=r(355);Object.defineProperty(t,"GPULayer",{enumerable:!0,get:function(){return s.GPULayer}});var u=r(191),l=r(664);Object.defineProperty(t,"GPUProgram",{enumerable:!0,get:function(){return l.GPUProgram}});var p=r(981);Object.defineProperty(t,"GPUIndexBuffer",{enumerable:!0,get:function(){return p.GPUIndexBuffer}});var _=r(707),f=r(126),d=r(581),m=r(360),v=r(690),h=r(579),g=n(n(n(n(n(n({isFloatType:a.isFloatType,isUnsignedIntType:a.isUnsignedIntType,isSignedIntType:a.isSignedIntType,isIntType:a.isIntType,makeShaderHeader:a.makeShaderHeader,compileShader:a.compileShader,initGLProgram:a.initGLProgram,readyToRead:a.readyToRead,preprocessVertexShader:a.preprocessVertexShader,preprocessFragmentShader:a.preprocessFragmentShader,isPowerOf2:a.isPowerOf2,initSequentialFloatArray:a.initSequentialFloatArray,uniformInternalTypeForValue:a.uniformInternalTypeForValue,indexOfLayerInArray:a.indexOfLayerInArray,readPixelsAsync:a.readPixelsAsync},d),f),_),u),m),v);t._testing=g;var y=a.isWebGL2,T=a.isWebGL2Supported,E=a.isHighpSupportedInVertexShader,A=a.isHighpSupportedInFragmentShader,O=a.getVertexShaderMediumpPrecision,I=a.getFragmentShaderMediumpPrecision;t.isWebGL2=y,t.isWebGL2Supported=T,t.isHighpSupportedInVertexShader=E,t.isHighpSupportedInFragmentShader=A,t.getVertexShaderMediumpPrecision=O,t.getFragmentShaderMediumpPrecision=I;var P=h.copyProgram,R=h.addLayersProgram,S=h.addValueProgram,N=h.multiplyValueProgram,b=h.setValueProgram,L=h.setColorProgram,U=h.zeroProgram,F=h.renderAmplitudeProgram,w=h.renderSignedAmplitudeProgram;t.copyProgram=P,t.addLayersProgram=R,t.addValueProgram=S,t.multiplyValueProgram=N,t.setValueProgram=b,t.setColorProgram=L,t.zeroProgram=U,t.renderAmplitudeProgram=F,t.renderSignedAmplitudeProgram=w,i(r(601),t)},360:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fragmentShaderPolyfills=t.GLSL1Polyfills=t.texturePolyfill=t.SAMPLER2D_DIMENSIONS_UNIFORM=t.SAMPLER2D_HALF_PX_UNIFORM=t.SAMPLER2D_FILTER=t.SAMPLER2D_CAST_INT=t.SAMPLER2D_WRAP_Y=t.SAMPLER2D_WRAP_X=void 0;var n=r(601),o=r(126);function i(e){switch(e){case"int":case"uint":return"float";case"ivec2":case"uvec2":return"vec2";case"ivec3":case"uvec3":return"vec3";case"ivec4":case"uvec4":return"vec4"}throw new Error("Unknown type ".concat(e,"."))}function a(e){return"".concat(e," abs(const ").concat(e," a) { return ").concat(e,"(abs(").concat(i(e),"(a))); }")}function c(e){return"".concat(e," sign(const ").concat(e," a) { return ").concat(e,"(sign(").concat(i(e),"(a))); }")}function s(e){return"".concat(e," trunc(const ").concat(e," a) { return round(a - fract(a) * sign(a)); }")}function u(e){return"".concat(e," round(const ").concat(e," a) { return floor(a + 0.5); }")}function l(e){return"".concat(e," roundEven(const ").concat(e," a) { return 2.0 * round(a / 2.0); }")}function p(e,t){return"".concat(e," min(const ").concat(e," a, const ").concat(t," b) { return ").concat(e,"(min(").concat(i(e),"(a), ").concat(i(t),"(b))); }")}function _(e,t){return"".concat(e," max(const ").concat(e," a, const ").concat(t," b) { return ").concat(e,"(max(").concat(i(e),"(a), ").concat(i(t),"(b))); }")}function f(e,t){return"".concat(e," clamp(const ").concat(e," a, const ").concat(t," min, const ").concat(t," max) { return ").concat(e,"(clamp(").concat(i(e),"(a), ").concat(i(t),"(min), ").concat(i(t),"(max))); }")}function d(e,t){return"".concat(e," mix(const ").concat(e," a, const ").concat(e," b, const ").concat(t," c) { return mix(a, b, ").concat(function(e){switch(e){case"bool":return"float";case"bvec2":return"vec2";case"bvec3":return"vec3";case"bvec4":return"vec4"}throw new Error("Unknown type ".concat(e,"."))}(t),"(c)); }")}function m(e,t,r){return"a[".concat(e,"][").concat(t,"] * a[").concat((e+1)%r,"][").concat((t+1)%r,"] - a[").concat((e+1)%r,"][").concat(t,"] * a[").concat(e,"][").concat((t+1)%r,"]")}function v(e,t,r){return[0,1,2].map((function(n){return"a[".concat(e,"][").concat((t+n)%r,"] * (").concat(m((e+1)%r,(t+1+n)%r,r),")")})).join(" + ")}function h(e,t){return"".concat(e," modi(const ").concat(e," x, const ").concat(t," y) { return x - y * (x / y); }")}function g(e,t){return"".concat(t," stepi(const ").concat(e," x, const ").concat(t," y) { return ").concat(t,"(step(").concat(i(e),"(x), ").concat(i(t),"(y))); }")}function y(e,t){return"".concat(e," bitshiftLeft(const ").concat(e," a, const ").concat(t," b) {\n\t#if (__VERSION__ == 300)\n\t\treturn a << b;\n\t#else\n\t\treturn a * ").concat(e,"(pow(").concat(i(t),"(2.0), ").concat(i(t),"(b)));\n\t#endif\n}")}function T(e,t){return"".concat(e," bitshiftRight(const ").concat(e," a, const ").concat(t," b) {\n\t#if (__VERSION__ == 300)\n\t\treturn a >> b;\n\t#else\n\t\treturn ").concat(e,"(round(").concat(i(e),"(a) / pow(").concat(i(t),"(2.0), ").concat(i(t),"(b))));\n\t#endif\n}")}function E(e){return"int bitwiseOr".concat(32===e?"":e,"(int a, int b) {\n\t#if (__VERSION__ == 300)\n\t\treturn a | b;\n\t#else\n\t\tint result = 0;\n\t\tint n = 1;\n\t\t\n\t\tfor (int i = 0; i < ").concat(e,"; i++) {\n\t\t\tif ((modi(a, 2) == 1) || (modi(b, 2) == 1)) {\n\t\t\t\tresult += n;\n\t\t\t}\n\t\t\ta = a / 2;\n\t\t\tb = b / 2;\n\t\t\tn = n * 2;\n\t\t\tif(!(a > 0 || b > 0)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t#endif\n}")}function A(e){return"int bitwiseXOR".concat(32===e?"":e,"(int a, int b) {\n\t#if (__VERSION__ == 300)\n\t\treturn a ^ b;\n\t#else\n\t\tint result = 0;\n\t\tint n = 1;\n\t\t\n\t\tfor (int i = 0; i < ").concat(e,"; i++) {\n\t\t\tif ((modi(a, 2) == 1) != (modi(b, 2) == 1)) {\n\t\t\t\tresult += n;\n\t\t\t}\n\t\t\ta = a / 2;\n\t\t\tb = b / 2;\n\t\t\tn = n * 2;\n\t\t\tif(!(a > 0 || b > 0)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t#endif\n}")}function O(e){return"int bitwiseAnd".concat(32===e?"":e,"(int a, int b) {\n\t#if (__VERSION__ == 300)\n\t\treturn a & b;\n\t#else\n\t\tint result = 0;\n\t\tint n = 1;\n\t\tfor (int i = 0; i < ").concat(e,"; i++) {\n\t\t\tif ((modi(a, 2) == 1) && (modi(b, 2) == 1)) {\n\t\t\t\tresult += n;\n\t\t\t}\n\t\t\ta = a / 2;\n\t\t\tb = b / 2;\n\t\t\tn = n * 2;\n\t\t\tif(!(a > 0 && b > 0)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t#endif\n}")}function I(e){return"int bitwiseNot".concat(32===e?"":e,"(int a) {\n\t#if (__VERSION__ == 300)\n\t\treturn ~a;\n\t#else\n\t\tint result = 0;\n\t\tint n = 1;\n\n\t\tfor (int i = 0; i < ").concat(e,"; i++) {\n\t\t\tif (modi(a, 2) == 0) {\n\t\t\t\tresult += n;\n\t\t\t}\n\t\t\ta = a / 2;\n\t\t\tn = n * 2;\n\t\t}\n\t\treturn result;\n\t#endif\n}")}t.SAMPLER2D_WRAP_X="GPUIO_WRAP_X",t.SAMPLER2D_WRAP_Y="GPUIO_WRAP_Y",t.SAMPLER2D_CAST_INT="GPUIO_CAST_INT",t.SAMPLER2D_FILTER="GPUIO_FILTER",t.SAMPLER2D_HALF_PX_UNIFORM="u_gpuio_half_px",t.SAMPLER2D_DIMENSIONS_UNIFORM="u_gpuio_dimensions",t.texturePolyfill=function(e){var r=e.match(/\btexture\(/g);if(!r||0===r.length)return{shaderSource:e,samplerUniforms:[]};var n=(0,o.getSampler2DsInProgram)(e);if(0===n.length)return{shaderSource:e,samplerUniforms:n};n.forEach((function(t,r){var n=new RegExp("\\btexture(2D)?\\(\\s?".concat(t,"\\b"),"gs");e=e.replace(n,"GPUIO_TEXTURE_POLYFILL".concat(r,"(").concat(t))}));var i=e.match(/\btexture(2D)?\(/g);(null==i?void 0:i.length)&&console.warn("Fragment shader polyfill has missed some calls to texture().",e);for(var a={},c=0;c<n.length;c++)a["".concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(c)]="vec2",a["".concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(c)]="vec2";function s(e,r,n){void 0===n&&(n="");var o=""===n?"":")";return"\n".concat(""===n?r:"i","vec4 GPUIO_TEXTURE_POLYFILL").concat(e,"(const ").concat(r,"sampler2D sampler, const vec2 uv) {\n\t").concat(""===r?"#if (".concat(t.SAMPLER2D_FILTER).concat(e," == 0)"):"","\n\t\t#if (").concat(t.SAMPLER2D_WRAP_X).concat(e," == 0)\n\t\t\t#if (").concat(t.SAMPLER2D_WRAP_Y).concat(e," == 0)\n\t\t\t\treturn ").concat(n,"texture(sampler, uv)").concat(o,";\n\t\t\t#else\n\t\t\t\treturn ").concat(n,"GPUIO_TEXTURE_WRAP_CLAMP_REPEAT(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(e,")").concat(o,";\n\t\t\t#endif\n\t\t#else\n\t\t\t#if (").concat(t.SAMPLER2D_WRAP_Y).concat(e," == 0)\n\t\t\t\treturn ").concat(n,"GPUIO_TEXTURE_WRAP_REPEAT_CLAMP(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(e,")").concat(o,";\n\t\t\t#else\n\t\t\t\treturn ").concat(n,"GPUIO_TEXTURE_WRAP_REPEAT_REPEAT(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(e,")").concat(o,";\n\t\t\t#endif\n\t\t#endif\n\t").concat(""===r?"#else\n\t\t#if (".concat(t.SAMPLER2D_WRAP_X).concat(e," == 0)\n\t\t\t#if (").concat(t.SAMPLER2D_WRAP_Y).concat(e," == 0)\n\t\t\t\treturn ").concat(n,"GPUIO_TEXTURE_BILINEAR_INTERP(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(e,", ").concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(e,")").concat(o,";\n\t\t\t#else\n\t\t\t\treturn ").concat(n,"GPUIO_TEXTURE_BILINEAR_INTERP_WRAP_CLAMP_REPEAT(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(e,", ").concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(e,")").concat(o,";\n\t\t\t#endif\n\t\t#else\n\t\t\t#if (").concat(t.SAMPLER2D_WRAP_Y).concat(e," == 0)\n\t\t\t\treturn ").concat(n,"GPUIO_TEXTURE_BILINEAR_INTERP_WRAP_REPEAT_CLAMP(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(e,", ").concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(e,")").concat(o,";\n\t\t\t#else\n\t\t\t\treturn ").concat(n,"GPUIO_TEXTURE_BILINEAR_INTERP_WRAP_REPEAT_REPEAT(sampler, uv, ").concat(t.SAMPLER2D_HALF_PX_UNIFORM).concat(e,", ").concat(t.SAMPLER2D_DIMENSIONS_UNIFORM).concat(e,")").concat(o,";\n\t\t\t#endif\n\t\t#endif\n\t#endif"):"","\n}\n")}function u(e){return"\n".concat(e,"vec4 GPUIO_TEXTURE_WRAP_REPEAT_REPEAT(const ").concat(e,"sampler2D sampler, const vec2 uv, const vec2 halfPx) {\n\treturn texture(sampler, GPUIO_WRAP_REPEAT_UV(uv));\n}\n").concat(e,"vec4 GPUIO_TEXTURE_WRAP_REPEAT_CLAMP(const ").concat(e,"sampler2D sampler, vec2 uv, const vec2 halfPx) {\n\tuv.x = GPUIO_WRAP_REPEAT_UV_COORD(uv.x);\n\t// uv.y = GPUIO_WRAP_CLAMP_UV_COORD(uv.y, halfPx.y);\n\treturn texture(sampler, uv);\n}\n").concat(e,"vec4 GPUIO_TEXTURE_WRAP_CLAMP_REPEAT(const ").concat(e,"sampler2D sampler, vec2 uv, const vec2 halfPx) {\n\t// uv.x = GPUIO_WRAP_CLAMP_UV_COORD(uv.x, halfPx.x);\n\tuv.y = GPUIO_WRAP_REPEAT_UV_COORD(uv.y);\n\treturn texture(sampler, uv);\n}\n")}return{shaderSource:e="\n".concat(Object.keys(a).map((function(e){return"uniform ".concat(a[e]," ").concat(e,";")})).join("\n"),"\n\nfloat GPUIO_WRAP_REPEAT_UV_COORD(const float coord) {\n\treturn fract(coord + ceil(abs(coord)));\n}\nvec2 GPUIO_WRAP_REPEAT_UV(const vec2 uv) {\n\treturn fract(uv + ceil(abs(uv)));\n}\n// float GPUIO_WRAP_CLAMP_UV_COORD(const float coord, const float halfPx) {\n// \treturn clamp(coord, halfPx, 1.0 - halfPx);\n// }\n\n").concat(u(""),"\n#if (__VERSION__ == 300)\n").concat(["u","i"].map((function(e){return u(e)})).join("\n"),"\n#endif\n\n").concat([null,"REPEAT_REPEAT","REPEAT_CLAMP","CLAMP_REPEAT"].map((function(e){return r=(t=e)?"GPUIO_TEXTURE_WRAP_".concat(t):"texture",n=t?", halfPx":"","\nvec4 GPUIO_TEXTURE_BILINEAR_INTERP".concat(t?"_WRAP_".concat(t):"","(const sampler2D sampler, const vec2 uv, const vec2 halfPx, const vec2 dimensions) {\n\tvec2 pxFraction = fract(uv * dimensions);\n\tvec2 offset = halfPx - vec2(0.00001, 0.00001) * max(\n\t\t\tstep(abs(pxFraction.x - 0.5), 0.001),\n\t\t\tstep(abs(pxFraction.y - 0.5), 0.001)\n\t\t);\n\tvec2 baseUV = uv - offset;\n\tvec2 diagOffset = vec2(offset.x, -offset.y);\n\tvec4 minmin = ").concat(r,"(sampler, baseUV").concat(n,");\n\tvec4 maxmin = ").concat(r,"(sampler, uv + diagOffset").concat(n,");\n\tvec4 minmax = ").concat(r,"(sampler, uv - diagOffset").concat(n,");\n\tvec4 maxmax = ").concat(r,"(sampler, uv + offset").concat(n,");\n\tvec2 t = fract(baseUV * dimensions);\n\tvec4 yMin = mix(minmin, maxmin, t.x);\n\tvec4 yMax = mix(minmax, maxmax, t.x);\n\treturn mix(yMin, yMax, t.y);\n}\n");var t,r,n})).join("\n"),"\n\n").concat(n.map((function(e,r){return"#ifndef ".concat(t.SAMPLER2D_CAST_INT).concat(r,"\n\t").concat(s(r,""),"\n#endif")})).join("\n"),"\n#if (__VERSION__ == 300)\n").concat(["u","i"].map((function(e){return n.map((function(t,r){return s(r,e)})).join("\n")})).join("\n"),"\n#else\n\t").concat(n.map((function(e,r){return"#ifdef ".concat(t.SAMPLER2D_CAST_INT).concat(r,"\n\t").concat(s(r,"","ivec4("),"\n#endif")})).join("\n"),"\n#endif\n\n").concat(e),samplerUniforms:n}},t.GLSL1Polyfills=function(e){var t,r,n,o="";return e.includes("abs")&&(o+="\n\n\n".concat(a("int"),"\n").concat(a("ivec2"),"\n").concat(a("ivec3"),"\n").concat(a("ivec4"),"\n")),e.includes("sign")&&(o+="\n\n\n".concat(c("int"),"\n").concat(c("ivec2"),"\n").concat(c("ivec3"),"\n").concat(c("ivec4"),"\n")),e.includes("round")&&(o+="\n\n\n".concat(u("float"),"\n").concat(u("vec2"),"\n").concat(u("vec3"),"\n").concat(u("vec4"),"\n")),e.includes("trunc")&&(o+="\n\n\n".concat(s("float"),"\n").concat(s("vec2"),"\n").concat(s("vec3"),"\n").concat(s("vec4"),"\n")),e.includes("roundEven")&&(o+="\n\n\n".concat(l("float"),"\n").concat(l("vec2"),"\n").concat(l("vec3"),"\n").concat(l("vec4"),"\n")),e.includes("min")&&(o+="\n\n\n".concat(p("int","int"),"\n").concat(p("ivec2","ivec2"),"\n").concat(p("ivec3","ivec3"),"\n").concat(p("ivec4","ivec4"),"\n").concat(p("ivec2","int"),"\n").concat(p("ivec3","int"),"\n").concat(p("ivec4","int"),"\n")),e.includes("max")&&(o+="\n\n\n".concat(_("int","int"),"\n").concat(_("ivec2","ivec2"),"\n").concat(_("ivec3","ivec3"),"\n").concat(_("ivec4","ivec4"),"\n").concat(_("ivec2","int"),"\n").concat(_("ivec3","int"),"\n").concat(_("ivec4","int"),"\n")),e.includes("clamp")&&(o+="\n\n\n".concat(f("int","int"),"\n").concat(f("ivec2","ivec2"),"\n").concat(f("ivec3","ivec3"),"\n").concat(f("ivec4","ivec4"),"\n").concat(f("ivec2","int"),"\n").concat(f("ivec3","int"),"\n").concat(f("ivec4","int"),"\n")),e.includes("mix")&&(o+="\n\n\n".concat(d("float","bool"),"\n").concat(d("vec2","bvec2"),"\n").concat(d("vec3","bvec3"),"\n").concat(d("vec4","bvec4"),"\n")),e.includes("outerProduct")&&(o+="\n\n\nmat2 outerProduct(const vec2 a, const vec2 b) {\n\treturn mat2(\n\t\ta.x * b.x, a.x * b.y,\n\t\ta.y * b.x, a.y * b.y\n\t);\n}\nmat3 outerProduct(const vec3 a, const vec3 b) {\n\treturn mat3(\n\t\ta.x * b.x, a.x * b.y, a.x * b.z,\n\t\ta.y * b.x, a.y * b.y, a.y * b.z,\n\t\ta.z * b.x, a.z * b.y, a.z * b.z\n\t);\n}\nmat4 outerProduct(const vec4 a, const vec4 b) {\n\treturn mat4(\n\t\ta.x * b.x, a.x * b.y, a.x * b.z, a.x * b.w,\n\t\ta.y * b.x, a.y * b.y, a.y * b.z, a.y * b.w,\n\t\ta.z * b.x, a.z * b.y, a.z * b.z, a.z * b.w,\n\t\ta.w * b.x, a.w * b.y, a.w * b.z, a.w * b.w\n\t);\n}\n"),e.includes("transpose")&&(o+="\n\n\nmat2 transpose(mat2 a) {\n\tfloat temp = a[0][1];\n\ta[0][1] = a[1][0];\n\ta[1][0] = temp;\n\treturn a;\n}\nmat3 transpose(mat3 a) {\n\tfloat temp = a[0][2];\n\ta[0][2] = a[2][0];\n\ta[2][0] = temp;\n\ttemp = a[0][1];\n\ta[0][1] = a[1][0];\n\ta[1][0] = temp;\n\ttemp = a[1][2];\n\ta[1][2] = a[2][1];\n\ta[2][1] = temp;\n\treturn a;\n}\nmat4 transpose(mat4 a) {\n\tfloat temp = a[0][3];\n\ta[0][3] = a[3][0];\n\ta[3][0] = temp;\n\ttemp = a[0][2];\n\ta[0][2] = a[2][0];\n\ta[2][0] = temp;\n\ttemp = a[2][3];\n\ta[2][3] = a[3][2];\n\ta[3][2] = temp;\n\ttemp = a[0][1];\n\ta[0][1] = a[1][0];\n\ta[1][0] = temp;\n\ttemp = a[1][2];\n\ta[1][2] = a[2][1];\n\ta[2][1] = temp;\n\ttemp = a[2][3];\n\ta[2][3] = a[3][2];\n\ta[3][2] = temp;\n\treturn a;\n}\n"),e.includes("determinant")&&(o+="\n\n\nfloat determinant(const mat2 a) {\n\treturn ".concat(m(0,0,2),";\n}\nfloat determinant(const mat3 a) {\n\treturn ").concat(v(0,0,3),";\n}\nfloat determinant(const mat4 a) {\n\treturn ").concat((t=0,r=0,n=4,[0,1,2,3].map((function(e){return"a[".concat(t,"][").concat((r+e)%n,"] * (").concat(v((t+1)%n,(r+1+e)%n,n),")")})).join(" + ")),";\n}\n")),e.includes("sinh")&&(o+="\n\n\nfloat sinh(const float x) {\n\treturn (pow(".concat(Math.E,", x) - pow(").concat(Math.E,", -x)) / 2.0;\n}\n")),e.includes("cosh")&&(o+="\n\n\nfloat cosh(const float x) {\n\treturn (pow(".concat(Math.E,", x) + pow(").concat(Math.E,", -x)) / 2.0; \n}\n")),e.includes("tanh")&&(o+="\n\n\nfloat tanh(const float x) {\n\tfloat e = exp(2.0 * x);\n\treturn (e - 1.0) / (e + 1.0);\n}\n"),e.includes("asinh")&&(o+="\n\n\nfloat asinh(const float x) {\n\treturn log(x + sqrt(x * x + 1.0));\n}\n"),e.includes("asinh")&&(o+="\n\n\nfloat acosh(const float x) {\n\treturn log(x + sqrt(x * x - 1.0));\n}\n"),e.includes("asinh")&&(o+="\n\n\nfloat atanh(float x) {\n\tx = (x + 1.0) / (x - 1.0);\n\treturn 0.5 * log(x * sign(x));\n}\n"),o},t.fragmentShaderPolyfills=function(e,t){var r="";return(e.includes("modi")||t===n.GLSL1&&e.includes("bitwise"))&&(r+="\n\n".concat(h("int","int"),"\n").concat(h("ivec2","ivec2"),"\n").concat(h("ivec3","ivec3"),"\n").concat(h("ivec4","ivec4"),"\n").concat(h("ivec2","int"),"\n").concat(h("ivec3","int"),"\n").concat(h("ivec4","int"),"\n#if (__VERSION__ == 300)\n").concat(h("uint","uint"),"\n").concat(h("uvec2","uvec2"),"\n").concat(h("uvec3","uvec3"),"\n").concat(h("uvec4","uvec4"),"\n").concat(h("uvec2","uint"),"\n").concat(h("uvec3","uint"),"\n").concat(h("uvec4","uint"),"\n#endif\n")),e.includes("stepi")&&(r+="\n\n".concat(g("int","int"),"\n").concat(g("ivec2","ivec2"),"\n").concat(g("ivec3","ivec3"),"\n").concat(g("ivec4","ivec4"),"\n").concat(g("int","ivec2"),"\n").concat(g("int","ivec3"),"\n").concat(g("int","ivec4"),"\n#if (__VERSION__ == 300)\n").concat(g("uint","uint"),"\n").concat(g("uvec2","uvec2"),"\n").concat(g("uvec3","uvec3"),"\n").concat(g("uvec4","uvec4"),"\n").concat(g("uint","uvec2"),"\n").concat(g("uint","uvec3"),"\n").concat(g("uint","uvec4"),"\n#endif\n")),e.includes("bitshiftLeft")&&(r+="\n\n".concat(y("int","int"),"\n").concat(y("ivec2","ivec2"),"\n").concat(y("ivec3","ivec3"),"\n").concat(y("ivec4","ivec4"),"\n").concat(y("ivec2","int"),"\n").concat(y("ivec3","int"),"\n").concat(y("ivec4","int"),"\n#if (__VERSION__ == 300)\n").concat(y("uint","uint"),"\n").concat(y("uvec2","uvec2"),"\n").concat(y("uvec3","uvec3"),"\n").concat(y("uvec4","uvec4"),"\n").concat(y("uvec2","uint"),"\n").concat(y("uvec3","uint"),"\n").concat(y("uvec4","uint"),"\n#endif\n")),e.includes("bitshiftRight")&&(r+="\n\n".concat(T("int","int"),"\n").concat(T("ivec2","ivec2"),"\n").concat(T("ivec3","ivec3"),"\n").concat(T("ivec4","ivec4"),"\n").concat(T("ivec2","int"),"\n").concat(T("ivec3","int"),"\n").concat(T("ivec4","int"),"\n#if (__VERSION__ == 300)\n").concat(T("uint","uint"),"\n").concat(T("uvec2","uvec2"),"\n").concat(T("uvec3","uvec3"),"\n").concat(T("uvec4","uvec4"),"\n").concat(T("uvec2","uint"),"\n").concat(T("uvec3","uint"),"\n").concat(T("uvec4","uint"),"\n#endif\n")),e.includes("bitwiseOr")&&(r+="\n\n".concat(E(8),"\n").concat(E(16),"\n").concat(E(32),"\n#if (__VERSION__ == 300)\n").concat([8,16,""].map((function(e){return"\nuint bitwiseOr".concat(e,"(uint a, uint b) {\n\treturn uint(bitwiseOr").concat(e,"(int(a), int(b)));\n}")})).join("\n"),"\n#endif\n")),e.includes("bitwiseXOR")&&(r+="\n\n".concat(A(8),"\n").concat(A(16),"\n").concat(A(32),"\n#if (__VERSION__ == 300)\n").concat([8,16,""].map((function(e){return"\nuint bitwiseXOR".concat(e,"(uint a, uint b) {\n\treturn uint(bitwiseXOR").concat(e,"(int(a), int(b)));\n}")})).join("\n"),"\n#endif\n")),e.includes("bitwiseAnd")&&(r+="\n\n".concat(O(8),"\n").concat(O(16),"\n").concat(O(32),"\n#if (__VERSION__ == 300)\n").concat([8,16,""].map((function(e){return"\nuint bitwiseAnd".concat(e,"(uint a, uint b) {\n\treturn uint(bitwiseAnd").concat(e,"(int(a), int(b)));\n}")})).join("\n"),"\n#endif\n")),e.includes("bitwiseNot")&&(r+="\n\n".concat(I(8),"\n").concat(I(16),"\n").concat(I(32),"\n#if (__VERSION__ == 300)\n").concat([8,16,""].map((function(e){return"\nuint bitwiseNot".concat(e,"(uint a) {\n\treturn uint(bitwiseNot").concat(e,"(int(a)));\n}")})).join("\n"),"\n#endif\n")),r}},126:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSampler2DsInProgram=t.stripComments=t.stripPrecision=t.stripVersion=t.highpToMediump=t.glsl1Uint=t.glsl1Sampler2D=t.glsl1Texture=t.checkFragmentShaderForFragColor=t.glsl1FragmentOut=t.getFragmentOuts=t.glsl1FragmentIn=t.glsl1VertexOut=t.castVaryingToFloat=t.glsl1VertexIn=void 0;var n=r(601);function o(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function i(e,t,r){var n=new RegExp("\\b".concat(o(t),"\\s*=\\s*\\S[^;]*;"),"sg"),i=e.match(n);if(i)for(var a=0;a<i.length;a++){var c=new RegExp("\\b".concat(o(t),"\\s*=\\s*(\\S[^;]*);"),"s"),s=i[a].match(c);if(s&&s[1]){var u=new RegExp("\\b".concat(o(t),"\\s*=\\s*").concat(o(s[1]),"\\s*;"),"s");e=e.replace(u,"".concat(t," = ").concat(r,"(").concat(s[1],");"))}else console.warn('Could not find value in expression: "'.concat(i[a],'"'))}else console.warn("No assignment found for shader variable ".concat(t,"."));return e}function a(e,t,r){var n=new RegExp("".concat(t,"\\s+\\S[^;]*;"),"g"),o=e.match(n);if(o){var a=new RegExp("".concat(t,"\\b"),"g");e=e.replace(a,"varying ".concat(r));for(var c=0;c<o.length;c++){var s=new RegExp("".concat(t,"\\s+(\\S[^;]*);")),u=o[c].match(s);u&&u[2]?e=i(e,u[2],r):console.warn('Could not find variable name in expression: "'.concat(o[c],'"'))}}return e}function c(e){return e=a(e,"\\bvarying\\s+(u)?int","float"),e=a(e,"\\bvarying\\s+(i|u)vec2","vec2"),e=a(e,"\\bvarying\\s+(i|u)vec3","vec3"),e=a(e,"\\bvarying\\s+(i|u)vec4","vec4")}function s(e,t){for(var r={},n=0;;){var o=e.match(/\b(layout\s*\(\s*location\s*=\s*([0-9]+)\s*\)\s*)?out\s+((lowp|mediump|highp)\s+)?((float|int|uint|([iu]?vec[234]))\s+)?([_$a-zA-Z0-9]+)\s*;/);if(!o){if(0===Object.keys(r).length)return[];for(var i=Object.keys(r),a=i.length,c=new Array(n).fill(void 0),s=0;s<a;s++){var u=i[s],l=r[u],p=l.location,_=l.type;if(void 0!==c[p])throw new Error('Must be exactly one out declaration per layout location in GPUProgram "'.concat(t,'", conflicting declarations found at location ').concat(p,"."));c[p]={name:u,type:_}}if(i.length!==n+1)throw new Error('Must be exactly one out declaration per layout location in GPUProgram "'.concat(t,'", layout locations must be sequential (no missing location numbers) starting from 0.'));for(s=0;s<=n;s++)if(void 0===c[s])throw new Error("Missing out declaration at location ".concat(s,' in GPUProgram "').concat(t,'", layout locations must be sequential (no missing location numbers) starting from 0.'));return c}var f=o[8],d=parseInt(o[2]||"0"),m=o[6];if(!m)throw new Error('No type found for out declaration "'.concat(o[0],'" for GPUProgram "').concat(t,'".'));if(!f)throw new Error('No variable name found for out declaration "'.concat(o[0],'" for GPUProgram "').concat(t,'".'));if(r[f]){if(r[f].location!==d)throw new Error('All out declarations for variable "'.concat(f,'" must have same location in GPUProgram "').concat(t,'".'))}else d>n&&(n=d),r[f]={location:d,type:m};e=e.replace(o[0],"")}}t.glsl1VertexIn=function(e){return e.replace(/\bin\b/g,"attribute")},t.castVaryingToFloat=c,t.glsl1VertexOut=function(e){return e=c(e=e.replace(/(\bflat\s+)?\bout\b/g,"varying"))},t.glsl1FragmentIn=function(e){return e=c(e=e.replace(/(\bflat\s+)?\bin\b/g,"varying"))},t.getFragmentOuts=s,t.glsl1FragmentOut=function(e,t){var r=s(e,t);if(0===r.length)return[e];e=e.replace(/\blayout\s*\(\s*location\s*=\s*([0-9]+)\s*\)\s*/g,"");for(var n=[],o=0,i=r.length;o<i;o++){var a=r[o],c=a.type,u=a.name,l=new RegExp("\\bout\\s+((lowp|mediump|highp)\\s+)?(float|int|uint|([iu]?vec[234]))\\s+".concat(u,"\\s*;"),"g"),p=e.replace(l,"");p=p.replace(/\bout\b/g,"");for(var _=!1,f=new RegExp("\\b".concat(u,"\\s*=\\s*(\\S.*?);"),"s");;){var d=p.match(f);if(!d||!d[1]){if(!_)throw new Error('No assignment found for out declaration in GPUProgram "'.concat(t,'".'));break}_=!0;var m="";switch(c){case"float":case"int":case"uint":m=", 0, 0, 0";break;case"vec2":case"ivec2":case"uvec2":m=", 0, 0";break;case"vec3":case"ivec3":case"uvec3":m=", 0"}p=p.replace(f,"gl_FragColor = vec4(".concat(d[1]).concat(m,");"))}n.push(p)}return n},t.checkFragmentShaderForFragColor=function(e,t,r){var o=function(e){return!!e.match(/\bgl_FragColor\b/)}(e);if(t===n.GLSL3&&o)throw new Error('Found "gl_FragColor" declaration in fragment shader for GPUProgram "'.concat(r,'": either init GPUComposer with glslVersion = GLSL1 or use GLSL3 syntax in your fragment shader.'))},t.glsl1Texture=function(e){return e.replace(/\btexture\(/g,"texture2D(")},t.glsl1Sampler2D=function(e){return e.replace(/\b(i|u)sampler2D\b/g,"sampler2D")},t.glsl1Uint=function(e){return e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\buint\b/g,"int")).replace(/\buvec2\b/g,"ivec2")).replace(/\buvec3\b/g,"ivec3")).replace(/\buvec4\b/g,"ivec4")).replace(/\buint\(/g,"int(")).replace(/\buvec2\(/g,"ivec2(")).replace(/\buvec3\(/g,"ivec3(")).replace(/\buvec4\(/g,"ivec4(")},t.highpToMediump=function(e){return e.replace(/\bhighp\b/,"mediump")},t.stripVersion=function(e){var t=e.length;return(e=e.replace(/^\s*\#version\s+([0-9]+(\s+(es)+)?)\s*/,"")).length!==t&&console.warn("GPUIO expects shader source that does not contain #version declarations, removing...."),e},t.stripPrecision=function(e){var t=e.length;return(e=e.replace(/\s*precision\s+((highp)|(mediump)|(lowp))\s+[a-zA-Z0-9]+\s*;/g,"")).length!==t&&console.warn("GPUIO expects shader source that does not contain precision declarations, removing...."),e},t.stripComments=function(e){return e=(e=e.replace(/[\t ]*\/\/.*\n/g,"")).replace(/\/\*.*?\*\//gs,"")},t.getSampler2DsInProgram=function(e){var t={},r="\\buniform\\s+(((highp)|(mediump)|(lowp))\\s+)?(i|u)?sampler2D\\s+(\\w+)\\s*;",n=e.match(new RegExp(r,"g"));if(!n||0===n.length)return[];var o=new RegExp(r);return n.forEach((function(e){var r=e.match(o);r&&r[7]?t[r[7]]=!0:console.warn('Could not find sampler2D uniform name in string "'.concat(e,'".'))})),Object.keys(t)}},593:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function c(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.readPixelsAsync=t.indexOfLayerInArray=t.uniformInternalTypeForValue=t.preprocessFragmentShader=t.preprocessVertexShader=t.convertFragmentShaderToGLSL1=t.initSequentialFloatArray=t.isPowerOf2=t.getFragmentShaderMediumpPrecision=t.getVertexShaderMediumpPrecision=t.isHighpSupportedInFragmentShader=t.isHighpSupportedInVertexShader=t.readyToRead=t.isWebGL2Supported=t.isWebGL2=t.initGLProgram=t.compileShader=t.makeShaderHeader=t.isIntType=t.isSignedIntType=t.isUnsignedIntType=t.isFloatType=void 0;var i=r(566),a=r(601),c=r(690),s=r(724),u=r(360),l=r(126),p={supportsWebGL2:void 0,supportsHighpVertex:void 0,supportsHighpFragment:void 0,mediumpVertexPrecision:void 0,mediumpFragmentPrecision:void 0};function _(e){return e===a.UNSIGNED_BYTE||e===a.UNSIGNED_SHORT||e===a.UNSIGNED_INT}function f(e){return e===a.BYTE||e===a.SHORT||e===a.INT}function d(e){for(var t="",r=Object.keys(e),n=0;n<r.length;n++){var o=r[n];if(!(0,i.isString)(o)||!(0,i.isString)(e[o]))throw new Error("GPUProgram compile time constants must be passed in as key value pairs that are both strings, got key value pair of type [".concat(typeof o," : ").concat(typeof e[o],"] for key ").concat(o,"."));t+="#define ".concat(o," ").concat(e[o],"\n")}return t}function m(e,t,r,n,o){var i,u=e===a.GLSL3?"#version ".concat(a.GLSL3,"\n"):"",l=n?d(n):"",p=d(((i={})[a.GPUIO_INT_PRECISION]="".concat((0,c.intForPrecision)(t)),i[a.GPUIO_FLOAT_PRECISION]="".concat((0,c.intForPrecision)(r)),i));return"".concat(u).concat(o||"").concat(l).concat(p).concat(s.PRECISION_SOURCE)}function v(e,t,r,n,o,i,a,c,s,u,l){void 0===l&&(l=!1);var p=e.createShader(i);if(!p)return c("Unable to init gl shader."),null;var _=m(t,r,n,s,u),f="".concat(_).concat(o);return e.shaderSource(p,f),e.compileShader(p),l&&!e.getShaderParameter(p,e.COMPILE_STATUS)?(console.log(f.split("\n").map((function(e,t){return"".concat(t,"\t").concat(e)})).join("\n")),c("Could not compile ".concat(i===e.FRAGMENT_SHADER?"fragment":"vertex",' shader for program "').concat(a,'": ').concat(e.getShaderInfoLog(p),".")),null):p}function h(e,t,r,n,o){var i=e.createProgram();if(i){if(e.attachShader(i,t),e.attachShader(i,r),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS))return i;o('GPUProgram "'.concat(n,'" failed to link: ').concat(e.getProgramInfoLog(i)))}else o('Unable to init GL program for GPUProgram "'.concat(n,'", gl.createProgram() has failed.'))}function g(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext}function y(e,t){var r=document.createElement("canvas").getContext(a.WEBGL1);if(!r)throw new Error("Unable to init webgl context.");try{var n=v(r,a.GLSL1,a.PRECISION_HIGH_P,a.PRECISION_HIGH_P,e,r.VERTEX_SHADER,"highpFragmentTest",a.DEFAULT_ERROR_CALLBACK),o=v(r,a.GLSL1,a.PRECISION_HIGH_P,a.PRECISION_HIGH_P,t,r.FRAGMENT_SHADER,"highpFragmentTest",a.DEFAULT_ERROR_CALLBACK),i=h(r,n,o,"highpFragmentTest",a.DEFAULT_ERROR_CALLBACK);r.deleteProgram(i),r.deleteShader(n),r.deleteShader(o)}catch(e){return!1}return!0}function T(){if(void 0===p.supportsHighpVertex){var e=y("void main() { highp float test = 0.524; gl_Position = vec4(test, test, 0, 1); }","void main() { gl_FragColor = vec4(0); }");p.supportsHighpVertex=e}return p.supportsHighpVertex}function E(){if(void 0===p.supportsHighpFragment){var e=y("void main() { gl_Position = vec4(0.5, 0.5, 0, 1); }","void main() { highp float test = 1.35; gl_FragColor = vec4(test); }");p.supportsHighpFragment=e}return p.supportsHighpFragment}function A(e,t,r,n,o){var i=h(t,n,r,e,a.DEFAULT_ERROR_CALLBACK);if(!i)throw new Error("Unable to init WebGLProgram.");var c=t.getAttribLocation(i,"position"),s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,1,t.STATIC_DRAW),t.enableVertexAttribArray(c),t.vertexAttribPointer(c,1,t.UNSIGNED_BYTE,!1,0,0),t.viewport(0,0,1,1),t.useProgram(i),o(i),t.drawArrays(t.POINTS,0,1);var u=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,u),t.disableVertexAttribArray(c),t.deleteProgram(i),t.deleteShader(n),t.deleteShader(r),t.deleteBuffer(s),u}function O(e){return e=(0,l.stripVersion)(e),e=(0,l.stripPrecision)(e),e=(0,l.stripComments)(e)}function I(e){return e=(0,l.glsl1Sampler2D)(e),e=(0,l.glsl1Uint)(e),e=(0,l.glsl1Texture)(e)}function P(e,t){return e=I(e),e=(0,l.glsl1FragmentIn)(e),(0,l.glsl1FragmentOut)(e,t)}function R(e,t,r,n){return new Promise((function(o,i){!function a(){var c=e.clientWaitSync(t,r,0);c!==e.WAIT_FAILED?c!==e.TIMEOUT_EXPIRED?o():setTimeout(a,n):i()}()}))}function S(e,t,r,i,a){return n(this,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return n=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0),e.flush(),[4,R(e,n,0,10)];case 1:return o.sent(),e.deleteSync(n),e.bindBuffer(t,r),e.getBufferSubData(t,i,a),e.bindBuffer(t,null),[2]}}))}))}t.isFloatType=function(e){return e===a.FLOAT||e===a.HALF_FLOAT},t.isUnsignedIntType=_,t.isSignedIntType=f,t.isIntType=function(e){return _(e)||f(e)},t.makeShaderHeader=m,t.compileShader=v,t.initGLProgram=h,t.isWebGL2=g,t.isWebGL2Supported=function(){if(void 0===p.supportsWebGL2){var e=document.createElement("canvas").getContext(a.WEBGL2);p.supportsWebGL2=g(e)}return p.supportsWebGL2},t.readyToRead=function(e){return e.checkFramebufferStatus(e.FRAMEBUFFER)==e.FRAMEBUFFER_COMPLETE},t.isHighpSupportedInVertexShader=T,t.isHighpSupportedInFragmentShader=E,t.getVertexShaderMediumpPrecision=function(){if(void 0===p.mediumpVertexPrecision){var e=document.createElement("canvas").getContext("webgl");if(!e)throw new Error("Unable to init webgl context.");var t=v(e,a.GLSL1,a.PRECISION_MEDIUM_P,a.PRECISION_MEDIUM_P,"\n\tattribute vec4 position;  // needed because of another bug in Safari\n\tuniform mediump vec3 v;\n\tvarying mediump vec4 v_result;\n\tvoid main() {\n\t\tgl_Position = position;\n\t\tgl_PointSize = 1.0;\n\t\tv_result = vec4(normalize(v) * 0.5 + 0.5, 1);\n\t}\n\t\t",e.VERTEX_SHADER,"mediumpPrecisionVertexTest",a.DEFAULT_ERROR_CALLBACK);if(!t)throw new Error("Unable to init vertex shader.");var r=v(e,a.GLSL1,a.PRECISION_MEDIUM_P,a.PRECISION_MEDIUM_P,"\n\tvarying mediump vec4 v_result;\n\tvoid main() {\n\t\tgl_FragColor = v_result;\n\t}\n\t\t",e.FRAGMENT_SHADER,"mediumpPrecisionVertexTest",a.DEFAULT_ERROR_CALLBACK);if(!r)throw new Error("Unable to init fragment shader.");var n=Math.pow(2,31)-1,o=Math.sqrt(n),i=255*(o/Math.sqrt(o*o*3)*.5+.5)|0,c=A("mediumpPrecisionVertexTest",e,r,t,(function(t){var r=e.getUniformLocation(t,"v");e.uniform3f(r,o,o,o)})),s=Math.abs(c[0]-i)>16;p.mediumpVertexPrecision=s?a.PRECISION_MEDIUM_P:a.PRECISION_HIGH_P}return p.mediumpVertexPrecision},t.getFragmentShaderMediumpPrecision=function(){if(void 0===p.mediumpFragmentPrecision){var e=document.createElement("canvas").getContext("webgl");if(!e)throw new Error("Unable to init webgl context.");var t=v(e,a.GLSL1,a.PRECISION_MEDIUM_P,a.PRECISION_MEDIUM_P,"\n\tattribute vec4 position;  // needed because of another bug in Safari\n\tvoid main() {\n\t\tgl_Position = position;\n\t\tgl_PointSize = 1.0;\n\t}\n\t\t",e.VERTEX_SHADER,"mediumpPrecisionFragmentTest",a.DEFAULT_ERROR_CALLBACK);if(!t)throw new Error("Unable to init vertex shader.");var r=v(e,a.GLSL1,a.PRECISION_MEDIUM_P,a.PRECISION_MEDIUM_P,"\n\tuniform mediump vec3 v;\n\tvoid main() {\n\t\tgl_FragColor = vec4(normalize(v) * 0.5 + 0.5, 1);\n\t}\n\t\t",e.FRAGMENT_SHADER,"mediumpPrecisionFragmentTest",a.DEFAULT_ERROR_CALLBACK);if(!r)throw new Error("Unable to init fragment shader.");var n=Math.pow(2,31)-1,o=Math.sqrt(n),i=255*(o/Math.sqrt(o*o*3)*.5+.5)|0,c=A("mediumpPrecisionFragmentTest",e,r,t,(function(t){var r=e.getUniformLocation(t,"v");e.uniform3f(r,o,o,o)})),s=Math.abs(c[0]-i)>16;p.mediumpFragmentPrecision=s?a.PRECISION_MEDIUM_P:a.PRECISION_HIGH_P}return p.mediumpFragmentPrecision},t.isPowerOf2=function(e){return e>0&&0==(e&e-1)},t.initSequentialFloatArray=function(e){for(var t=new Float32Array(e),r=0;r<e;r++)t[r]=r;return t},t.convertFragmentShaderToGLSL1=P,t.preprocessVertexShader=function(e,t){return e=O(e),T()||(console.warn("highp not supported in vertex shader in this browser, falling back to mediump."),e=(0,l.highpToMediump)(e)),t===a.GLSL3?e:function(e){return e=I(e),e=(0,l.glsl1VertexIn)(e),(0,l.glsl1VertexOut)(e)}(e)},t.preprocessFragmentShader=function(e,t,r){var n,o;if(e=O(e),(0,l.checkFragmentShaderForFragColor)(e,t,r),E()||(console.warn("highp not supported in fragment shader in this browser, falling back to mediump."),e=(0,l.highpToMediump)(e)),e=(0,u.fragmentShaderPolyfills)(e,t)+e,e=(n=(0,u.texturePolyfill)(e)).shaderSource,o=n.samplerUniforms,t!==a.GLSL3){for(var i=P(e,r),c=0,s=i.length;c<s;c++)i[c]=(0,u.GLSL1Polyfills)(i[c])+i[c];if(e=i.shift(),i.length)return{shaderSource:e,samplerUniforms:o,additionalSources:i}}return{shaderSource:e,samplerUniforms:o}},t.uniformInternalTypeForValue=function(e,t,r,n){if(t===a.FLOAT){if((0,i.isArray)(e)){for(var o=0;o<e.length;o++)if(!(0,i.isFiniteNumber)(e[o]))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(n,'", expected float or float[] of length 1-4.'))}else if(!(0,i.isFiniteNumber)(e))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(n,'", expected float or float[] of length 1-4.'));if(!(0,i.isArray)(e)||1===e.length)return a.FLOAT_1D_UNIFORM;if(2===e.length)return a.FLOAT_2D_UNIFORM;if(3===e.length)return a.FLOAT_3D_UNIFORM;if(4===e.length)return a.FLOAT_4D_UNIFORM;throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(n,'", expected float or float[] of length 1-4.'))}if(t===a.INT){if((0,i.isArray)(e)){for(o=0;o<e.length;o++)if(!(0,i.isInteger)(e[o]))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(n,'", expected int or int[] of length 1-4.'))}else if(!(0,i.isInteger)(e))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(n,'", expected int or int[] of length 1-4.'));if(!(0,i.isArray)(e)||1===e.length)return a.INT_1D_UNIFORM;if(2===e.length)return a.INT_2D_UNIFORM;if(3===e.length)return a.INT_3D_UNIFORM;if(4===e.length)return a.INT_4D_UNIFORM;throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(n,'", expected int or int[] of length 1-4.'))}if(t===a.UINT){if((0,i.isArray)(e)){for(o=0;o<e.length;o++)if(!(0,i.isNonNegativeInteger)(e[o]))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(n,'", expected uint or uint[] of length 1-4.'))}else if(!(0,i.isNonNegativeInteger)(e))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(n,'", expected uint or uint[] of length 1-4.'));if(!(0,i.isArray)(e)||1===e.length)return a.UINT_1D_UNIFORM;if(2===e.length)return a.UINT_2D_UNIFORM;if(3===e.length)return a.UINT_3D_UNIFORM;if(4===e.length)return a.UINT_4D_UNIFORM;throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(n,'", expected uint or uint[] of length 1-4.'))}if(t===a.BOOL){if((0,i.isArray)(e)){for(o=0;o<e.length;o++)if(!(0,i.isBoolean)(e[o]))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(n,'", expected bool or bool[] of length 1-4.'))}else if(!(0,i.isBoolean)(e))throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(n,'", expected bool or bool[] of length 1-4.'));if(!(0,i.isArray)(e)||1===e.length)return a.BOOL_1D_UNIFORM;if(2===e.length)return a.BOOL_2D_UNIFORM;if(3===e.length)return a.BOOL_3D_UNIFORM;if(4===e.length)return a.BOOL_4D_UNIFORM;throw new Error("Invalid value ".concat(JSON.stringify(e),' for uniform "').concat(r,'" in program "').concat(n,'", expected boolean.'))}throw new Error('Invalid type "'.concat(t,'" for uniform "').concat(r,'" in program "').concat(n,'", expected ').concat(a.FLOAT," or ").concat(a.INT," or ").concat(a.BOOL,"."))},t.indexOfLayerInArray=function(e,t){return t.findIndex((function(t){return t===e||t.layer===e}))},t.readPixelsAsync=function(e,t,r,i,a,c,s,u){return n(this,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return n=e.createBuffer(),e.bindBuffer(e.PIXEL_PACK_BUFFER,n),e.bufferData(e.PIXEL_PACK_BUFFER,u.byteLength,e.STREAM_READ),e.readPixels(t,r,i,a,c,s,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),[4,S(e,e.PIXEL_PACK_BUFFER,n,0,u)];case 1:return o.sent(),e.deleteBuffer(n),[2,u]}}))}))}},557:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFloat16=function(e,t,...r){return(0,o.convertToNumber)((0,i.DataViewPrototypeGetUint16)(e,t,...(0,n.safeIfNeeded)(r)))},t.setFloat16=function(e,t,r,...a){return(0,i.DataViewPrototypeSetUint16)(e,t,(0,o.roundToFloat16Bits)(r),...(0,n.safeIfNeeded)(a))};var n=r(802),o=r(605),i=r(983)},310:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isFloat16Array=p;var n=r(802),o=r(299),i=r(605),a=r(554),c=r(930),s=r(983),u=r(700);const l=new s.NativeWeakMap;function p(e){return(0,s.WeakMapPrototypeHas)(l,e)||!(0,s.ArrayBufferIsView)(e)&&(0,o.hasFloat16ArrayBrand)(e)}function _(e){if(!p(e))throw(0,s.NativeTypeError)(c.THIS_IS_NOT_A_FLOAT16ARRAY_OBJECT)}function f(e,t){const r=p(e),n=(0,a.isNativeTypedArray)(e);if(!r&&!n)throw(0,s.NativeTypeError)(c.SPECIES_CONSTRUCTOR_DIDNT_RETURN_TYPEDARRAY_OBJECT);if("number"==typeof t){let n;if(r){const t=d(e);n=(0,s.TypedArrayPrototypeGetLength)(t)}else n=(0,s.TypedArrayPrototypeGetLength)(e);if(n<t)throw(0,s.NativeTypeError)(c.DERIVED_CONSTRUCTOR_CREATED_TYPEDARRAY_OBJECT_WHICH_WAS_TOO_SMALL_LENGTH)}if((0,a.isNativeBigIntTypedArray)(e))throw(0,s.NativeTypeError)(c.CANNOT_MIX_BIGINT_AND_OTHER_TYPES)}function d(e){const t=(0,s.WeakMapPrototypeGet)(l,e);if(void 0!==t){const e=(0,s.TypedArrayPrototypeGetBuffer)(t);if((0,u.IsDetachedBuffer)(e))throw(0,s.NativeTypeError)(c.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);return t}const r=e.buffer;if((0,u.IsDetachedBuffer)(r))throw(0,s.NativeTypeError)(c.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);const n=(0,s.ReflectConstruct)(g,[r,e.byteOffset,e.length],e.constructor);return(0,s.WeakMapPrototypeGet)(l,n)}function m(e){const t=(0,s.TypedArrayPrototypeGetLength)(e),r=[];for(let n=0;n<t;++n)r[n]=(0,i.convertToNumber)(e[n]);return r}const v=new s.NativeWeakSet;for(const e of(0,s.ReflectOwnKeys)(s.TypedArrayPrototype)){if(e===s.SymbolToStringTag)continue;const t=(0,s.ReflectGetOwnPropertyDescriptor)(s.TypedArrayPrototype,e);(0,s.ObjectHasOwn)(t,"get")&&"function"==typeof t.get&&(0,s.WeakSetPrototypeAdd)(v,t.get)}const h=(0,s.ObjectFreeze)({get:(e,t,r)=>(0,a.isCanonicalIntegerIndexString)(t)&&(0,s.ObjectHasOwn)(e,t)?(0,i.convertToNumber)((0,s.ReflectGet)(e,t)):(0,s.WeakSetPrototypeHas)(v,(0,s.ObjectPrototype__lookupGetter__)(e,t))?(0,s.ReflectGet)(e,t):(0,s.ReflectGet)(e,t,r),set:(e,t,r,n)=>(0,a.isCanonicalIntegerIndexString)(t)&&(0,s.ObjectHasOwn)(e,t)?(0,s.ReflectSet)(e,t,(0,i.roundToFloat16Bits)(r)):(0,s.ReflectSet)(e,t,r,n),getOwnPropertyDescriptor(e,t){if((0,a.isCanonicalIntegerIndexString)(t)&&(0,s.ObjectHasOwn)(e,t)){const r=(0,s.ReflectGetOwnPropertyDescriptor)(e,t);return r.value=(0,i.convertToNumber)(r.value),r}return(0,s.ReflectGetOwnPropertyDescriptor)(e,t)},defineProperty:(e,t,r)=>(0,a.isCanonicalIntegerIndexString)(t)&&(0,s.ObjectHasOwn)(e,t)&&(0,s.ObjectHasOwn)(r,"value")?(r.value=(0,i.roundToFloat16Bits)(r.value),(0,s.ReflectDefineProperty)(e,t,r)):(0,s.ReflectDefineProperty)(e,t,r)});class g{constructor(e,t,r){let n;if(p(e))n=(0,s.ReflectConstruct)(s.NativeUint16Array,[d(e)],new.target);else if((0,a.isObject)(e)&&!(0,a.isArrayBuffer)(e)){let t,r;if((0,a.isNativeTypedArray)(e)){t=e,r=(0,s.TypedArrayPrototypeGetLength)(e);const o=(0,s.TypedArrayPrototypeGetBuffer)(e),i=(0,a.isSharedArrayBuffer)(o)?s.NativeArrayBuffer:(0,u.SpeciesConstructor)(o,s.NativeArrayBuffer);if((0,u.IsDetachedBuffer)(o))throw(0,s.NativeTypeError)(c.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);if((0,a.isNativeBigIntTypedArray)(e))throw(0,s.NativeTypeError)(c.CANNOT_MIX_BIGINT_AND_OTHER_TYPES);const l=new i(2*r);n=(0,s.ReflectConstruct)(s.NativeUint16Array,[l],new.target)}else{const o=e[s.SymbolIterator];if(null!=o&&"function"!=typeof o)throw(0,s.NativeTypeError)(c.ITERATOR_PROPERTY_IS_NOT_CALLABLE);null!=o?(0,a.isOrdinaryArray)(e)?(t=e,r=e.length):(t=[...e],r=t.length):(t=e,r=(0,u.ToLength)(t.length)),n=(0,s.ReflectConstruct)(s.NativeUint16Array,[r],new.target)}for(let e=0;e<r;++e)n[e]=(0,i.roundToFloat16Bits)(t[e])}else n=(0,s.ReflectConstruct)(s.NativeUint16Array,arguments,new.target);const o=new s.NativeProxy(n,h);return(0,s.WeakMapPrototypeSet)(l,o,n),o}static from(e,...t){const r=this;if(!(0,s.ReflectHas)(r,o.brand))throw(0,s.NativeTypeError)(c.THIS_CONSTRUCTOR_IS_NOT_A_SUBCLASS_OF_FLOAT16ARRAY);if(r===g){if(p(e)&&0===t.length){const t=d(e),r=new s.NativeUint16Array((0,s.TypedArrayPrototypeGetBuffer)(t),(0,s.TypedArrayPrototypeGetByteOffset)(t),(0,s.TypedArrayPrototypeGetLength)(t));return new g((0,s.TypedArrayPrototypeGetBuffer)((0,s.TypedArrayPrototypeSlice)(r)))}if(0===t.length)return new g((0,s.TypedArrayPrototypeGetBuffer)((0,s.Uint16ArrayFrom)(e,i.roundToFloat16Bits)));const r=t[0],o=t[1];return new g((0,s.TypedArrayPrototypeGetBuffer)((0,s.Uint16ArrayFrom)(e,(function(e,...t){return(0,i.roundToFloat16Bits)((0,s.ReflectApply)(r,this,[e,...(0,n.safeIfNeeded)(t)]))}),o)))}let l,_;const f=e[s.SymbolIterator];if(null!=f&&"function"!=typeof f)throw(0,s.NativeTypeError)(c.ITERATOR_PROPERTY_IS_NOT_CALLABLE);if(null!=f)(0,a.isOrdinaryArray)(e)?(l=e,_=e.length):(0,a.isOrdinaryNativeTypedArray)(e)?(l=e,_=(0,s.TypedArrayPrototypeGetLength)(e)):(l=[...e],_=l.length);else{if(null==e)throw(0,s.NativeTypeError)(c.CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT);l=(0,s.NativeObject)(e),_=(0,u.ToLength)(l.length)}const m=new r(_);if(0===t.length)for(let e=0;e<_;++e)m[e]=l[e];else{const e=t[0],r=t[1];for(let t=0;t<_;++t)m[t]=(0,s.ReflectApply)(e,r,[l[t],t])}return m}static of(...e){const t=this;if(!(0,s.ReflectHas)(t,o.brand))throw(0,s.NativeTypeError)(c.THIS_CONSTRUCTOR_IS_NOT_A_SUBCLASS_OF_FLOAT16ARRAY);const r=e.length;if(t===g){const t=new g(r),n=d(t);for(let t=0;t<r;++t)n[t]=(0,i.roundToFloat16Bits)(e[t]);return t}const n=new t(r);for(let t=0;t<r;++t)n[t]=e[t];return n}keys(){_(this);const e=d(this);return(0,s.TypedArrayPrototypeKeys)(e)}values(){_(this);const e=d(this);return(0,n.wrap)(function*(){for(const t of(0,s.TypedArrayPrototypeValues)(e))yield(0,i.convertToNumber)(t)}())}entries(){_(this);const e=d(this);return(0,n.wrap)(function*(){for(const[t,r]of(0,s.TypedArrayPrototypeEntries)(e))yield[t,(0,i.convertToNumber)(r)]}())}at(e){_(this);const t=d(this),r=(0,s.TypedArrayPrototypeGetLength)(t),n=(0,u.ToIntegerOrInfinity)(e),o=n>=0?n:r+n;if(!(o<0||o>=r))return(0,i.convertToNumber)(t[o])}map(e,...t){_(this);const r=d(this),n=(0,s.TypedArrayPrototypeGetLength)(r),o=t[0],a=(0,u.SpeciesConstructor)(r,g);if(a===g){const t=new g(n),a=d(t);for(let t=0;t<n;++t){const n=(0,i.convertToNumber)(r[t]);a[t]=(0,i.roundToFloat16Bits)((0,s.ReflectApply)(e,o,[n,t,this]))}return t}const c=new a(n);f(c,n);for(let t=0;t<n;++t){const n=(0,i.convertToNumber)(r[t]);c[t]=(0,s.ReflectApply)(e,o,[n,t,this])}return c}filter(e,...t){_(this);const r=d(this),n=(0,s.TypedArrayPrototypeGetLength)(r),o=t[0],a=[];for(let t=0;t<n;++t){const n=(0,i.convertToNumber)(r[t]);(0,s.ReflectApply)(e,o,[n,t,this])&&(0,s.ArrayPrototypePush)(a,n)}const c=new((0,u.SpeciesConstructor)(r,g))(a);return f(c),c}reduce(e,...t){_(this);const r=d(this),n=(0,s.TypedArrayPrototypeGetLength)(r);if(0===n&&0===t.length)throw(0,s.NativeTypeError)(c.REDUCE_OF_EMPTY_ARRAY_WITH_NO_INITIAL_VALUE);let o,a;0===t.length?(o=(0,i.convertToNumber)(r[0]),a=1):(o=t[0],a=0);for(let t=a;t<n;++t)o=e(o,(0,i.convertToNumber)(r[t]),t,this);return o}reduceRight(e,...t){_(this);const r=d(this),n=(0,s.TypedArrayPrototypeGetLength)(r);if(0===n&&0===t.length)throw(0,s.NativeTypeError)(c.REDUCE_OF_EMPTY_ARRAY_WITH_NO_INITIAL_VALUE);let o,a;0===t.length?(o=(0,i.convertToNumber)(r[n-1]),a=n-2):(o=t[0],a=n-1);for(let t=a;t>=0;--t)o=e(o,(0,i.convertToNumber)(r[t]),t,this);return o}forEach(e,...t){_(this);const r=d(this),n=(0,s.TypedArrayPrototypeGetLength)(r),o=t[0];for(let t=0;t<n;++t)(0,s.ReflectApply)(e,o,[(0,i.convertToNumber)(r[t]),t,this])}find(e,...t){_(this);const r=d(this),n=(0,s.TypedArrayPrototypeGetLength)(r),o=t[0];for(let t=0;t<n;++t){const n=(0,i.convertToNumber)(r[t]);if((0,s.ReflectApply)(e,o,[n,t,this]))return n}}findIndex(e,...t){_(this);const r=d(this),n=(0,s.TypedArrayPrototypeGetLength)(r),o=t[0];for(let t=0;t<n;++t){const n=(0,i.convertToNumber)(r[t]);if((0,s.ReflectApply)(e,o,[n,t,this]))return t}return-1}findLast(e,...t){_(this);const r=d(this),n=(0,s.TypedArrayPrototypeGetLength)(r),o=t[0];for(let t=n-1;t>=0;--t){const n=(0,i.convertToNumber)(r[t]);if((0,s.ReflectApply)(e,o,[n,t,this]))return n}}findLastIndex(e,...t){_(this);const r=d(this),n=(0,s.TypedArrayPrototypeGetLength)(r),o=t[0];for(let t=n-1;t>=0;--t){const n=(0,i.convertToNumber)(r[t]);if((0,s.ReflectApply)(e,o,[n,t,this]))return t}return-1}every(e,...t){_(this);const r=d(this),n=(0,s.TypedArrayPrototypeGetLength)(r),o=t[0];for(let t=0;t<n;++t)if(!(0,s.ReflectApply)(e,o,[(0,i.convertToNumber)(r[t]),t,this]))return!1;return!0}some(e,...t){_(this);const r=d(this),n=(0,s.TypedArrayPrototypeGetLength)(r),o=t[0];for(let t=0;t<n;++t)if((0,s.ReflectApply)(e,o,[(0,i.convertToNumber)(r[t]),t,this]))return!0;return!1}set(e,...t){_(this);const r=d(this),n=(0,u.ToIntegerOrInfinity)(t[0]);if(n<0)throw(0,s.NativeRangeError)(c.OFFSET_IS_OUT_OF_BOUNDS);if(null==e)throw(0,s.NativeTypeError)(c.CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT);if((0,a.isNativeBigIntTypedArray)(e))throw(0,s.NativeTypeError)(c.CANNOT_MIX_BIGINT_AND_OTHER_TYPES);if(p(e))return(0,s.TypedArrayPrototypeSet)(d(this),d(e),n);if((0,a.isNativeTypedArray)(e)){const t=(0,s.TypedArrayPrototypeGetBuffer)(e);if((0,u.IsDetachedBuffer)(t))throw(0,s.NativeTypeError)(c.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER)}const o=(0,s.TypedArrayPrototypeGetLength)(r),l=(0,s.NativeObject)(e),f=(0,u.ToLength)(l.length);if(n===1/0||f+n>o)throw(0,s.NativeRangeError)(c.OFFSET_IS_OUT_OF_BOUNDS);for(let e=0;e<f;++e)r[e+n]=(0,i.roundToFloat16Bits)(l[e])}reverse(){_(this);const e=d(this);return(0,s.TypedArrayPrototypeReverse)(e),this}fill(e,...t){_(this);const r=d(this);return(0,s.TypedArrayPrototypeFill)(r,(0,i.roundToFloat16Bits)(e),...(0,n.safeIfNeeded)(t)),this}copyWithin(e,t,...r){_(this);const o=d(this);return(0,s.TypedArrayPrototypeCopyWithin)(o,e,t,...(0,n.safeIfNeeded)(r)),this}sort(e){_(this);const t=d(this),r=void 0!==e?e:u.defaultCompare;return(0,s.TypedArrayPrototypeSort)(t,((e,t)=>r((0,i.convertToNumber)(e),(0,i.convertToNumber)(t)))),this}slice(e,t){_(this);const r=d(this),n=(0,u.SpeciesConstructor)(r,g);if(n===g){const n=new s.NativeUint16Array((0,s.TypedArrayPrototypeGetBuffer)(r),(0,s.TypedArrayPrototypeGetByteOffset)(r),(0,s.TypedArrayPrototypeGetLength)(r));return new g((0,s.TypedArrayPrototypeGetBuffer)((0,s.TypedArrayPrototypeSlice)(n,e,t)))}const o=(0,s.TypedArrayPrototypeGetLength)(r),a=(0,u.ToIntegerOrInfinity)(e),l=void 0===t?o:(0,u.ToIntegerOrInfinity)(t);let p,m;p=a===-1/0?0:a<0?o+a>0?o+a:0:o<a?o:a,m=l===-1/0?0:l<0?o+l>0?o+l:0:o<l?o:l;const v=m-p>0?m-p:0,h=new n(v);if(f(h,v),0===v)return h;const y=(0,s.TypedArrayPrototypeGetBuffer)(r);if((0,u.IsDetachedBuffer)(y))throw(0,s.NativeTypeError)(c.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER);let T=0;for(;p<m;)h[T]=(0,i.convertToNumber)(r[p]),++p,++T;return h}subarray(e,t){_(this);const r=d(this),n=(0,u.SpeciesConstructor)(r,g),o=new s.NativeUint16Array((0,s.TypedArrayPrototypeGetBuffer)(r),(0,s.TypedArrayPrototypeGetByteOffset)(r),(0,s.TypedArrayPrototypeGetLength)(r)),i=(0,s.TypedArrayPrototypeSubarray)(o,e,t),a=new n((0,s.TypedArrayPrototypeGetBuffer)(i),(0,s.TypedArrayPrototypeGetByteOffset)(i),(0,s.TypedArrayPrototypeGetLength)(i));return f(a),a}indexOf(e,...t){_(this);const r=d(this),n=(0,s.TypedArrayPrototypeGetLength)(r);let o=(0,u.ToIntegerOrInfinity)(t[0]);if(o===1/0)return-1;o<0&&(o+=n,o<0&&(o=0));for(let t=o;t<n;++t)if((0,s.ObjectHasOwn)(r,t)&&(0,i.convertToNumber)(r[t])===e)return t;return-1}lastIndexOf(e,...t){_(this);const r=d(this),n=(0,s.TypedArrayPrototypeGetLength)(r);let o=t.length>=1?(0,u.ToIntegerOrInfinity)(t[0]):n-1;if(o===-1/0)return-1;o>=0?o=o<n-1?o:n-1:o+=n;for(let t=o;t>=0;--t)if((0,s.ObjectHasOwn)(r,t)&&(0,i.convertToNumber)(r[t])===e)return t;return-1}includes(e,...t){_(this);const r=d(this),n=(0,s.TypedArrayPrototypeGetLength)(r);let o=(0,u.ToIntegerOrInfinity)(t[0]);if(o===1/0)return!1;o<0&&(o+=n,o<0&&(o=0));const a=(0,s.NumberIsNaN)(e);for(let t=o;t<n;++t){const n=(0,i.convertToNumber)(r[t]);if(a&&(0,s.NumberIsNaN)(n))return!0;if(n===e)return!0}return!1}join(e){_(this);const t=m(d(this));return(0,s.ArrayPrototypeJoin)(t,e)}toLocaleString(...e){_(this);const t=m(d(this));return(0,s.ArrayPrototypeToLocaleString)(t,...(0,n.safeIfNeeded)(e))}get[s.SymbolToStringTag](){if(p(this))return"Float16Array"}}t.Float16Array=g,(0,s.ObjectDefineProperty)(g,"BYTES_PER_ELEMENT",{value:2}),(0,s.ObjectDefineProperty)(g,o.brand,{}),(0,s.ReflectSetPrototypeOf)(g,s.TypedArray);const y=g.prototype;(0,s.ObjectDefineProperty)(y,"BYTES_PER_ELEMENT",{value:2}),(0,s.ObjectDefineProperty)(y,s.SymbolIterator,{value:y.values,writable:!0,configurable:!0}),(0,s.ReflectSetPrototypeOf)(y,s.TypedArrayPrototype)},802:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.safeIfNeeded=function(e){if(e[n.SymbolIterator]===n.NativeArrayPrototypeSymbolIterator)return e;const t=(0,n.ObjectCreate)(i);return(0,n.WeakMapPrototypeSet)(o,t,(0,n.ArrayPrototypeSymbolIterator)(e)),t},t.wrap=function(e){const t=(0,n.ObjectCreate)(c);return(0,n.WeakMapPrototypeSet)(a,t,e),t};var n=r(983);const o=new n.NativeWeakMap,i=(0,n.ObjectCreate)(null,{next:{value:function(){const e=(0,n.WeakMapPrototypeGet)(o,this);return(0,n.ArrayIteratorPrototypeNext)(e)}},[n.SymbolIterator]:{value:function(){return this}}}),a=new n.NativeWeakMap,c=(0,n.ObjectCreate)(n.IteratorPrototype,{next:{value:function(){const e=(0,n.WeakMapPrototypeGet)(a,this);return(0,n.GeneratorPrototypeNext)(e)},writable:!0,configurable:!0}});for(const e of(0,n.ReflectOwnKeys)(n.ArrayIteratorPrototype))"next"!==e&&(0,n.ObjectDefineProperty)(c,e,(0,n.ReflectGetOwnPropertyDescriptor)(n.ArrayIteratorPrototype,e))},299:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasFloat16ArrayBrand=function(e){if(!(0,n.isObjectLike)(e))return!1;const t=(0,i.ReflectGetPrototypeOf)(e);if(!(0,n.isObjectLike)(t))return!1;const r=t.constructor;if(void 0===r)return!1;if(!(0,n.isObject)(r))throw(0,i.NativeTypeError)(o.THE_CONSTRUCTOR_PROPERTY_VALUE_IS_NOT_AN_OBJECT);return(0,i.ReflectHas)(r,a)};var n=r(554),o=r(930),i=r(983);const a=(0,i.SymbolFor)("__Float16Array__");t.brand=a},605:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertToNumber=function(e){const t=e>>10;return a[0]=u[p[t]+(1023&e)]+l[t],i[0]},t.roundToFloat16Bits=function(e){i[0]=e;const t=a[0],r=t>>23&511;return c[r]+((8388607&t)>>s[r])};var n=r(983);const o=new n.NativeArrayBuffer(4),i=new n.NativeFloat32Array(o),a=new n.NativeUint32Array(o),c=new n.NativeUint32Array(512),s=new n.NativeUint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(c[e]=0,c[256|e]=32768,s[e]=24,s[256|e]=24):t<-14?(c[e]=1024>>-t-14,c[256|e]=1024>>-t-14|32768,s[e]=-t-1,s[256|e]=-t-1):t<=15?(c[e]=t+15<<10,c[256|e]=t+15<<10|32768,s[e]=13,s[256|e]=13):t<128?(c[e]=31744,c[256|e]=64512,s[e]=24,s[256|e]=24):(c[e]=31744,c[256|e]=64512,s[e]=13,s[256|e]=13)}const u=new n.NativeUint32Array(2048),l=new n.NativeUint32Array(64),p=new n.NativeUint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,r=0;for(;0==(8388608&t);)t<<=1,r-=8388608;t&=-8388609,r+=947912704,u[e]=t|r}for(let e=1024;e<2048;++e)u[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)l[e]=e<<23;l[31]=1199570944,l[32]=2147483648;for(let e=33;e<63;++e)l[e]=2147483648+(e-32<<23);l[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(p[e]=1024)},554:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isArrayBuffer=function(e){try{return(0,n.ArrayBufferPrototypeGetByteLength)(e),!0}catch(e){return!1}},t.isCanonicalIntegerIndexString=function(e){if("string"!=typeof e)return!1;const t=+e;return e===t+""&&!!(0,n.NumberIsFinite)(t)&&t===(0,n.MathTrunc)(t)},t.isNativeBigIntTypedArray=function(e){const t=(0,n.TypedArrayPrototypeGetSymbolToStringTag)(e);return"BigInt64Array"===t||"BigUint64Array"===t},t.isNativeTypedArray=o,t.isObject=function(e){return null!==e&&"object"==typeof e||"function"==typeof e},t.isObjectLike=function(e){return null!==e&&"object"==typeof e},t.isOrdinaryArray=function(e){return!!(0,n.ArrayIsArray)(e)&&(e[n.SymbolIterator]===n.NativeArrayPrototypeSymbolIterator||"Array Iterator"===e[n.SymbolIterator]()[n.SymbolToStringTag])},t.isOrdinaryNativeTypedArray=function(e){return!!o(e)&&(e[n.SymbolIterator]===n.NativeTypedArrayPrototypeSymbolIterator||"Array Iterator"===e[n.SymbolIterator]()[n.SymbolToStringTag])},t.isSharedArrayBuffer=function(e){if(null===n.NativeSharedArrayBuffer)return!1;try{return(0,n.SharedArrayBufferPrototypeGetByteLength)(e),!0}catch(e){return!1}};var n=r(983);function o(e){return void 0!==(0,n.TypedArrayPrototypeGetSymbolToStringTag)(e)}},930:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.THIS_IS_NOT_AN_OBJECT="This is not an object",t.THIS_IS_NOT_A_FLOAT16ARRAY_OBJECT="This is not a Float16Array object",t.THIS_CONSTRUCTOR_IS_NOT_A_SUBCLASS_OF_FLOAT16ARRAY="This constructor is not a subclass of Float16Array",t.THE_CONSTRUCTOR_PROPERTY_VALUE_IS_NOT_AN_OBJECT="The constructor property value is not an object",t.SPECIES_CONSTRUCTOR_DIDNT_RETURN_TYPEDARRAY_OBJECT="Species constructor didn't return TypedArray object",t.DERIVED_CONSTRUCTOR_CREATED_TYPEDARRAY_OBJECT_WHICH_WAS_TOO_SMALL_LENGTH="Derived constructor created TypedArray object which was too small length",t.ATTEMPTING_TO_ACCESS_DETACHED_ARRAYBUFFER="Attempting to access detached ArrayBuffer",t.CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT="Cannot convert undefined or null to object",t.CANNOT_MIX_BIGINT_AND_OTHER_TYPES="Cannot mix BigInt and other types, use explicit conversions",t.ITERATOR_PROPERTY_IS_NOT_CALLABLE="@@iterator property is not callable",t.REDUCE_OF_EMPTY_ARRAY_WITH_NO_INITIAL_VALUE="Reduce of empty array with no initial value",t.OFFSET_IS_OUT_OF_BOUNDS="Offset is out of bounds"},983:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(930);function o(e){return(t,...r)=>a(e,t,r)}function i(e,t){return o(l(e,t).get)}const{apply:a,construct:c,defineProperty:s,get:u,getOwnPropertyDescriptor:l,getPrototypeOf:p,has:_,ownKeys:f,set:d,setPrototypeOf:m}=Reflect;t.ReflectSetPrototypeOf=m,t.ReflectSet=d,t.ReflectOwnKeys=f,t.ReflectHas=_,t.ReflectGetPrototypeOf=p,t.ReflectGetOwnPropertyDescriptor=l,t.ReflectGet=u,t.ReflectDefineProperty=s,t.ReflectConstruct=c,t.ReflectApply=a;const v=Proxy;t.NativeProxy=v;const{MAX_SAFE_INTEGER:h,isFinite:g,isNaN:y}=Number;t.NumberIsNaN=y,t.NumberIsFinite=g,t.MAX_SAFE_INTEGER=h;const{iterator:T,species:E,toStringTag:A,for:O}=Symbol;t.SymbolFor=O,t.SymbolToStringTag=A,t.SymbolSpecies=E,t.SymbolIterator=T;const I=Object;t.NativeObject=I;const{create:P,defineProperty:R,freeze:S,is:N}=I;t.ObjectIs=N,t.ObjectFreeze=S,t.ObjectDefineProperty=R,t.ObjectCreate=P;const b=I.prototype,L=b.__lookupGetter__?o(b.__lookupGetter__):(e,t)=>{if(null==e)throw Ae(n.CANNOT_CONVERT_UNDEFINED_OR_NULL_TO_OBJECT);let r=I(e);do{const e=l(r,t);if(void 0!==e)return U(e,"get")?e.get:void 0}while(null!==(r=p(r)))};t.ObjectPrototype__lookupGetter__=L;const U=I.hasOwn||o(b.hasOwnProperty);t.ObjectHasOwn=U;const F=Array,w=F.isArray;t.ArrayIsArray=w;const x=F.prototype,G=o(x.join);t.ArrayPrototypeJoin=G;const D=o(x.push);t.ArrayPrototypePush=D;const M=o(x.toLocaleString);t.ArrayPrototypeToLocaleString=M;const C=x[T];t.NativeArrayPrototypeSymbolIterator=C;const B=o(C);t.ArrayPrototypeSymbolIterator=B;const V=Math.trunc;t.MathTrunc=V;const k=ArrayBuffer;t.NativeArrayBuffer=k;const H=k.isView;t.ArrayBufferIsView=H;const W=k.prototype,X=o(W.slice);t.ArrayBufferPrototypeSlice=X;const j=i(W,"byteLength");t.ArrayBufferPrototypeGetByteLength=j;const Y="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null;t.NativeSharedArrayBuffer=Y;const z=Y&&i(Y.prototype,"byteLength");t.SharedArrayBufferPrototypeGetByteLength=z;const K=p(Uint8Array);t.TypedArray=K;const J=K.from,q=K.prototype;t.TypedArrayPrototype=q;const Z=q[T];t.NativeTypedArrayPrototypeSymbolIterator=Z;const Q=o(q.keys);t.TypedArrayPrototypeKeys=Q;const $=o(q.values);t.TypedArrayPrototypeValues=$;const ee=o(q.entries);t.TypedArrayPrototypeEntries=ee;const te=o(q.set);t.TypedArrayPrototypeSet=te;const re=o(q.reverse);t.TypedArrayPrototypeReverse=re;const ne=o(q.fill);t.TypedArrayPrototypeFill=ne;const oe=o(q.copyWithin);t.TypedArrayPrototypeCopyWithin=oe;const ie=o(q.sort);t.TypedArrayPrototypeSort=ie;const ae=o(q.slice);t.TypedArrayPrototypeSlice=ae;const ce=o(q.subarray);t.TypedArrayPrototypeSubarray=ce;const se=i(q,"buffer");t.TypedArrayPrototypeGetBuffer=se;const ue=i(q,"byteOffset");t.TypedArrayPrototypeGetByteOffset=ue;const le=i(q,"length");t.TypedArrayPrototypeGetLength=le;const pe=i(q,A);t.TypedArrayPrototypeGetSymbolToStringTag=pe;const _e=Uint16Array;t.NativeUint16Array=_e,t.Uint16ArrayFrom=(...e)=>a(J,_e,e);const fe=Uint32Array;t.NativeUint32Array=fe;const de=Float32Array;t.NativeFloat32Array=de;const me=p([][T]());t.ArrayIteratorPrototype=me;const ve=o(me.next);t.ArrayIteratorPrototypeNext=ve;const he=o(function*(){}().next);t.GeneratorPrototypeNext=he;const ge=p(me);t.IteratorPrototype=ge;const ye=DataView.prototype,Te=o(ye.getUint16);t.DataViewPrototypeGetUint16=Te;const Ee=o(ye.setUint16);t.DataViewPrototypeSetUint16=Ee;const Ae=TypeError;t.NativeTypeError=Ae;const Oe=RangeError;t.NativeRangeError=Oe;const Ie=WeakSet;t.NativeWeakSet=Ie;const Pe=Ie.prototype,Re=o(Pe.add);t.WeakSetPrototypeAdd=Re;const Se=o(Pe.has);t.WeakSetPrototypeHas=Se;const Ne=WeakMap;t.NativeWeakMap=Ne;const be=Ne.prototype,Le=o(be.get);t.WeakMapPrototypeGet=Le;const Ue=o(be.has);t.WeakMapPrototypeHas=Ue;const Fe=o(be.set);t.WeakMapPrototypeSet=Fe},700:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IsDetachedBuffer=function(e){if((0,n.isSharedArrayBuffer)(e))return!1;try{return(0,i.ArrayBufferPrototypeSlice)(e,0,0),!1}catch(e){}return!0},t.SpeciesConstructor=function(e,t){if(!(0,n.isObject)(e))throw(0,i.NativeTypeError)(o.THIS_IS_NOT_AN_OBJECT);const r=e.constructor;if(void 0===r)return t;if(!(0,n.isObject)(r))throw(0,i.NativeTypeError)(o.THE_CONSTRUCTOR_PROPERTY_VALUE_IS_NOT_AN_OBJECT);const a=r[i.SymbolSpecies];return null==a?t:a},t.ToIntegerOrInfinity=a,t.ToLength=function(e){const t=a(e);return t<0?0:t<i.MAX_SAFE_INTEGER?t:i.MAX_SAFE_INTEGER},t.defaultCompare=function(e,t){const r=(0,i.NumberIsNaN)(e),n=(0,i.NumberIsNaN)(t);if(r&&n)return 0;if(r)return 1;if(n)return-1;if(e<t)return-1;if(e>t)return 1;if(0===e&&0===t){const r=(0,i.ObjectIs)(e,0),n=(0,i.ObjectIs)(t,0);if(!r&&n)return-1;if(r&&!n)return 1}return 0};var n=r(554),o=r(930),i=r(983);function a(e){const t=+e;return(0,i.NumberIsNaN)(t)||0===t?0:(0,i.MathTrunc)(t)}},216:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hfround=function(e){const t=+e;if(!(0,o.NumberIsFinite)(t)||0===t)return t;const r=(0,n.roundToFloat16Bits)(t);return(0,n.convertToNumber)(r)};var n=r(605),o=r(983)},650:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(310);t.Float16Array=n.Float16Array,t.isFloat16Array=n.isFloat16Array;var o=r(146);t.isTypedArray=o.isTypedArray;var i=r(557);t.getFloat16=i.getFloat16,t.setFloat16=i.setFloat16;var a=r(216);t.hfround=a.hfround},146:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isTypedArray=function(e){return(0,o.isNativeTypedArray)(e)||(0,n.isFloat16Array)(e)};var n=r(310),o=r(554)}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}return r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r(607)})(),t.exports=e();var r=1e3,n={VELOCITY_DECAY:1},o=document.createElement("canvas");function i(e,t){return Math.min(Math.ceil(e*t*.1),1e5)}document.body.appendChild(o);var a=i(o.width,o.height),c=new t.exports.GPUComposer({canvas:o}),s=o.clientWidth,u=o.clientHeight,l=new t.exports.GPULayer(c,{name:"velocity",dimensions:[Math.ceil(s/8),Math.ceil(u/8)],type:t.exports.FLOAT,filter:t.exports.LINEAR,numComponents:2,wrapX:t.exports.REPEAT,wrapY:t.exports.REPEAT,numBuffers:2}),p=new t.exports.GPULayer(c,{name:"divergence",dimensions:[l.width,l.height],type:t.exports.FLOAT,filter:t.exports.NEAREST,numComponents:1,wrapX:t.exports.REPEAT,wrapY:t.exports.REPEAT}),_=new t.exports.GPULayer(c,{name:"pressure",dimensions:[l.width,l.height],type:t.exports.FLOAT,filter:t.exports.NEAREST,numComponents:1,wrapX:t.exports.REPEAT,wrapY:t.exports.REPEAT,numBuffers:2}),f=new t.exports.GPULayer(c,{name:"material",dimensions:[s,u],type:t.exports.FLOAT,filter:t.exports.LINEAR,numComponents:1,wrapX:t.exports.REPEAT,wrapY:t.exports.REPEAT,numBuffers:2}),d=new t.exports.GPULayer(c,{name:"position",dimensions:a,type:t.exports.FLOAT,numComponents:4,numBuffers:2}),m=new t.exports.GPULayer(c,{name:"initialPosition",dimensions:a,type:t.exports.FLOAT,numComponents:4,numBuffers:1}),v=new t.exports.GPULayer(c,{name:"age",dimensions:a,type:t.exports.SHORT,numComponents:1,numBuffers:2}),h=new t.exports.GPUProgram(c,{name:"advection",fragmentShader:"\n\tin vec2 v_uv;\n\n\tuniform sampler2D u_state;\n\tuniform sampler2D u_velocity;\n\tuniform vec2 u_dimensions;\n\tuniform float u_decay;\n\n\tout vec2 out_state;\n\n\tvoid main() {\n\t\t// Implicitly solve advection.\n\t\tout_state = texture(u_state, v_uv - texture(u_velocity, v_uv).xy / u_dimensions).xy * u_decay;\n\t}",uniforms:[{name:"u_state",value:0,type:t.exports.INT},{name:"u_velocity",value:1,type:t.exports.INT},{name:"u_decay",value:1,type:t.exports.FLOAT}]}),g=new t.exports.GPUProgram(c,{name:"divergence2D",fragmentShader:"\n\tin vec2 v_uv;\n\n\tuniform sampler2D u_vectorField;\n\tuniform vec2 u_pxSize;\n\n\tout float out_divergence;\n\n\tvoid main() {\n\t\tfloat n = texture(u_vectorField, v_uv + vec2(0, u_pxSize.y)).y;\n\t\tfloat s = texture(u_vectorField, v_uv - vec2(0, u_pxSize.y)).y;\n\t\tfloat e = texture(u_vectorField, v_uv + vec2(u_pxSize.x, 0)).x;\n\t\tfloat w = texture(u_vectorField, v_uv - vec2(u_pxSize.x, 0)).x;\n\t\tout_divergence = 0.5 * ( e - w + n - s);\n\t}"}),y=new t.exports.GPUProgram(c,{name:"jacobi",fragmentShader:"\n\tin vec2 v_uv;\n\n\tuniform float u_alpha;\n\tuniform float u_beta;\n\tuniform vec2 u_pxSize;\n\tuniform sampler2D u_previousState;\n\tuniform sampler2D u_divergence;\n\n\tout vec4 out_jacobi;\n\n\tvoid main() {\n\t\tvec4 n = texture(u_previousState, v_uv + vec2(0, u_pxSize.y));\n\t\tvec4 s = texture(u_previousState, v_uv - vec2(0, u_pxSize.y));\n\t\tvec4 e = texture(u_previousState, v_uv + vec2(u_pxSize.x, 0));\n\t\tvec4 w = texture(u_previousState, v_uv - vec2(u_pxSize.x, 0));\n\t\tvec4 d = texture(u_divergence, v_uv);\n\t\tout_jacobi = (n + s + e + w + u_alpha * d) * u_beta;\n\t}",uniforms:[{name:"u_alpha",value:-1,type:t.exports.FLOAT},{name:"u_beta",value:.25,type:t.exports.FLOAT},{name:"u_previousState",value:0,type:t.exports.INT},{name:"u_divergence",value:1,type:t.exports.INT}]}),T=new t.exports.GPUProgram(c,{name:"gradientSubtraction",fragmentShader:"\n\tin vec2 v_uv;\n\n\tuniform vec2 u_pxSize;\n\tuniform sampler2D u_scalarField;\n\tuniform sampler2D u_vectorField;\n\n\tout vec2 out_result;\n\n\tvoid main() {\n\t\tfloat n = texture(u_scalarField, v_uv + vec2(0, u_pxSize.y)).r;\n\t\tfloat s = texture(u_scalarField, v_uv - vec2(0, u_pxSize.y)).r;\n\t\tfloat e = texture(u_scalarField, v_uv + vec2(u_pxSize.x, 0)).r;\n\t\tfloat w = texture(u_scalarField, v_uv - vec2(u_pxSize.x, 0)).r;\n\n\t\tout_result = texture2D(u_vectorField, v_uv).xy - 0.5 * vec2(e - w, n - s);\n\t}",uniforms:[{name:"u_scalarField",value:0,type:t.exports.INT},{name:"u_vectorField",value:1,type:t.exports.INT}]}),E=new t.exports.GPUProgram(c,{name:"renderParticles",fragmentShader:"\n\t#define FADE_TIME 0.1\n\n\tin vec2 v_uv;\n\tin vec2 v_uv_position;\n\n\tuniform isampler2D u_ages;\n\tuniform sampler2D u_velocity;\n\n\tout vec4 out_color;\n\n\tvoid main() {\n\t\tfloat ageFraction = float(texture(u_ages, v_uv_position).x) / ".concat(r.toFixed(1),";\n\t\t// Fade first 10% and last 10%.\n\t\tfloat opacity = mix(0.0, 1.0, min(ageFraction * 10.0, 1.0)) * mix(1.0, 0.0, max(ageFraction * 10.0 - 90.0, 0.0));\n\t\tvec2 velocity = texture(u_velocity, v_uv).xy;\n\t\t// Show the fastest regions with darker color.\n\t\tfloat multiplier = clamp(dot(velocity, velocity) * 0.05 + 0.7, 0.0, 1.0);\n\t\tout_color = vec4(0, 0, 0.2, opacity * multiplier);\n\t}"),uniforms:[{name:"u_ages",value:0,type:t.exports.INT},{name:"u_velocity",value:1,type:t.exports.INT}]}),A=new t.exports.GPUProgram(c,{name:"ageParticles",fragmentShader:"\n\tin vec2 v_uv;\n\n\tuniform isampler2D u_ages;\n\n\tout int out_age;\n\n\tvoid main() {\n\t\tint age = texture(u_ages, v_uv).x + 1;\n\t\tout_age = stepi(age, ".concat(r,") * age;\n\t}")}),O=new t.exports.GPUProgram(c,{name:"advectParticles",fragmentShader:"\n\tin vec2 v_uv;\n\n\tuniform vec2 u_dimensions;\n\tuniform sampler2D u_positions;\n\tuniform sampler2D u_velocity;\n\tuniform isampler2D u_ages;\n\tuniform sampler2D u_initialPositions;\n\n\tout vec4 out_position;\n\n\tvoid main() {\n\t\t// Store small displacements as separate number until they accumulate sufficiently.\n\t\t// Then add them to the absolution position.\n\t\t// This prevents small offsets on large abs positions from being lost in float16 precision.\n\t\tvec4 positionData = texture(u_positions, v_uv);\n\t\tvec2 absolute = positionData.rg;\n\t\tvec2 displacement = positionData.ba;\n\t\tvec2 position = absolute + displacement;\n\n\t\t// Forward integrate via RK2.\n\t\tvec2 pxSize = 1.0 / u_dimensions;\n\t\tvec2 velocity1 = texture(u_velocity, position * pxSize).xy;\n\t\tvec2 halfStep = position + velocity1 * 0.5;\n\t\tdisplacement += texture(u_velocity, halfStep * pxSize).xy;\n\n\t\t// Merge displacement with absolute if needed.\n\t\tfloat shouldMerge = step(20.0, dot(displacement, displacement));\n\t\t// Also wrap absolute position if needed.\n\t\tabsolute = mod(absolute + shouldMerge * displacement + u_dimensions, u_dimensions);\n\t\tdisplacement *= (1.0 - shouldMerge);\n\n\t\t// If this particle is being reset, give it a random position.\n\t\tint shouldReset = stepi(texture(u_ages, v_uv).x, 1);\n\t\tout_position = mix(vec4(absolute, displacement), texture(u_initialPositions, v_uv), float(shouldReset));\n\t}",uniforms:[{name:"u_positions",value:0,type:t.exports.INT},{name:"u_velocity",value:1,type:t.exports.INT},{name:"u_ages",value:2,type:t.exports.INT},{name:"u_initialPositions",value:3,type:t.exports.INT}]}),I=new t.exports.GPUProgram(c,{name:"renderMaterial",fragmentShader:"\n\t#define BACKGROUND vec3(0.98, 0.922, 0.843)\n\t#define COLOR1 vec3(0.925, 0, 0.55)\n\t#define COLOR2 vec3(0.0, 0.70, 0.63)\n\t#define COLOR3 vec3(0.52, 0.81, 0.70)\n\t#define NUM_COLORS 3.0\n\n\tin vec2 v_uv;\n\n\tuniform sampler2D u_material;\n\n\tout vec4 out_color;\n\n\tvoid main() {\n\t\tfloat val = clamp(texture(u_material, v_uv).x, 0.0, 1.0);\n\t\tfloat mix1 = step(val, 1.0 / NUM_COLORS);\n\t\tfloat mix2 = step(val, 2.0 / NUM_COLORS) * (1.0 - mix1);\n\t\tfloat mix3 = (1.0 - mix1) * (1.0 - mix2);\n\t\tvec3 color =\n\t\t\tmix(BACKGROUND, COLOR1, val * NUM_COLORS) * mix1 +\n\t\t\tmix(COLOR1, COLOR2, val * NUM_COLORS - 1.0) * mix2 +\n\t\t\tmix(COLOR2, COLOR3, val * NUM_COLORS - 2.0) * mix3;\n\t\tout_color = vec4(color, 1);\n\t}"}),P=new t.exports.GPUProgram(c,{name:"touchVelocity",fragmentShader:"\n\tin vec2 v_uv;\n\tin vec2 v_uv_local;\n\n\tuniform sampler2D u_velocity;\n\tuniform vec2 u_vector;\n\tuniform float u_maxVelocity;\n\n\tout vec2 out_velocity;\n\n\tvoid main() {\n\t\tvec2 radialVec = (v_uv_local * 2.0 - 1.0);\n\t\tfloat radiusSq = 1.0 - dot(radialVec, radialVec);\n\t\t// Update velocity.\n\t\tvec2 velocity = texture(u_velocity, v_uv).xy + radiusSq * u_vector * ".concat(2..toFixed(1),";\n\t\tfloat velocityMag = length(velocity);\n\t\tout_velocity = velocity / velocityMag * min(velocityMag, u_maxVelocity);\n\t}"),uniforms:[{name:"u_vector",value:[0,0],type:t.exports.FLOAT},{name:"u_maxVelocity",value:30,type:t.exports.FLOAT}]}),R=new t.exports.GPUProgram(c,{name:"touchMaterial",fragmentShader:"\n\tin vec2 v_uv;\n\tin vec2 v_uv_local;\n\n\tuniform sampler2D u_material;\n\n\tout float out_material;\n\n\tvoid main() {\n\t\tvec2 radialVec = (v_uv_local * 2.0 - 1.0);\n\t\tfloat radiusSq = clamp(1.0 - dot(radialVec, radialVec), 0.0, 1.0);\n\t\t// Update material.\n\t\tout_material = clamp(texture(u_material, v_uv).x + radiusSq * ".concat(.5.toFixed(1),", 0.0, 1.0);\n\t}")});function S(){var e=window.innerWidth,n=window.innerHeight;c.resize([e,n]);var o=[Math.ceil(e/8),Math.ceil(n/8)];l.resize(o),p.resize(o),_.resize(o),f.resize([e,n]),h.setUniform("u_dimensions",[e,n],t.exports.FLOAT),O.setUniform("u_dimensions",[e,n],t.exports.FLOAT);var s=[1/o[0],1/o[1]];g.setUniform("u_pxSize",s,t.exports.FLOAT),y.setUniform("u_pxSize",s,t.exports.FLOAT),T.setUniform("u_pxSize",s,t.exports.FLOAT),a=i(e,n);for(var u=new Float32Array(4*a),E=0;E<u.length/4;E++)u[4*E]=Math.random()*e,u[4*E+1]=Math.random()*n;d.resize(a,u),m.resize(a,u);var A=new Int16Array(a);for(E=0;E<a;E++)A[E]=Math.round(Math.random()*r);v.resize(a,A),N()}function N(){c.step({program:I,input:f}),c.drawLayerAsPoints({layer:d,pointSize:1,program:E,input:[v,l],wrapX:!0,wrapY:!0,blendAlpha:!0})}var b=900,L=!0;function U(){b--,n.VELOCITY_DECAY=b<150?.98:1,(L=b<=0)?console.log("PAUSE"):(window.requestAnimationFrame(U),function(){h.setUniform("u_decay",n.VELOCITY_DECAY),c.step({program:h,input:[l,l],output:l}),h.setUniform("u_decay",.995),c.step({program:h,input:[f,l],output:f}),c.step({program:g,input:l,output:p});for(var e=0;e<5;e++)c.step({program:y,input:[_,p],output:_});c.step({program:T,input:[_,l],output:l}),c.step({program:A,input:v,output:v}),c.step({program:O,input:[d,l,v,m],output:d}),N()}())}window.addEventListener("resize",S),S();var F={};function w(e){b=900,L&&(L=!1,console.log("START"),U()),e.preventDefault(),e.stopPropagation();var t=[e.clientX,e.clientY],r=void 0;void 0===F[e.pointerId]?F[e.pointerId]={current:t}:(r=F[e.pointerId].current,F[e.pointerId].last=r,F[e.pointerId].current=t),function(e,t){if(t){if(e[0]===t[0]&&e[1]===t[1])return;P.setUniform("u_vector",[e[0]-t[0],-(e[1]-t[1])]),P.setUniform("u_maxVelocity",30),c.stepSegment({program:P,input:l,output:l,position1:[e[0],o.clientHeight-e[1]],position2:[t[0],o.clientHeight-t[1]],thickness:30,endCaps:!0}),c.stepSegment({program:R,input:f,output:f,position1:[e[0],o.clientHeight-e[1]],position2:[t[0],o.clientHeight-t[1]],thickness:50,endCaps:!0})}else{var r=Math.random()*(Math.random()<.5?1:-1),n=Math.sqrt(1-r*r)*(Math.random()<.5?1:-1);P.setUniform("u_vector",[100*r,100*n]),P.setUniform("u_maxVelocity",200),c.stepCircle({program:P,input:l,output:l,position:[e[0],o.clientHeight-e[1]],diameter:60}),c.stepCircle({program:R,input:f,output:f,position:[e[0],o.clientHeight-e[1]],diameter:100})}}(t,r)}function x(e){delete F[e.pointerId]}o.addEventListener("pointerdown",w),o.addEventListener("pointermove",w),o.addEventListener("pointerup",x),o.addEventListener("pointerout",x),o.addEventListener("pointercancel",x),o.ontouchmove=function(e){e.preventDefault(),e.stopPropagation()}}();
